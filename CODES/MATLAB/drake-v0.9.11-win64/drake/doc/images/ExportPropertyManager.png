var __extends,AutoSuggest;(function(n){var t;(function(n){var t,i,r,u,f,e;(function(n){n.User="SRCHHPGUSR"})(t=n.CookieNames||(n.CookieNames={})),function(n){n.AutoSuggest="AS"}(i=n.CrumbNames||(n.CrumbNames={})),function(n){n.CursorPosition="cp";n.ConversationId="cvid";n.SuggestionCount="sc";n.PartialQuery="pq";n.SuggestionPosition="sp";n.SuggestionType="qs";n.PreviewPaneSuggestionType="qsc";n.SkipValue="sk";n.PreviewPaneSkipValue="skc";n.Ghosting="ghc";n.Css="css";n.Count="count";n.DataSet="ds";n.SessionId="sid";n.TimeStamp="qt";n.Query="q";n.ImpressionGuid="ig";n.QFQuery="qry";n.BaseQuery="bq";n.FormCode="form";n.HashedMuid="nclid";n.RequestElToken="elvr";n.AppId="appid";n.History="history";n.NoHistory="nohs";n.ApiTextDecoration="textdecorations";n.ClientId="clientid";n.Market="mkt";n.Scope="scope";n.CountryCode="cc";n.HomeGeographicRegion="hgr";n.SetLang="setlang"}(r=n.QueryParams||(n.QueryParams={})),function(n){n.ImpressionGuid="X-MSEdge-IG"}(u=n.Headers||(n.Headers={})),function(n){n.HitHighlighting="h";n.PopularNow="p";n.Local="l";n.Answers="a"}(f=n.Options||(n.Options={})),function(n){n.Id="id";n.Query="query";n.Url="url";n.Navigation="nav";n.Type="stype";n.Autocomplete="hc";n.InstData="h";n.AriaLabel="aria-label"}(e=n.SuggestionAttributes||(n.SuggestionAttributes={}))})(t=n.Service||(n.Service={}))})(AutoSuggest||(AutoSuggest={})),function(n){function gt(t,i){if(i){var r=d.exec(t);return r&&n.TopLevelDomains[r[1].toLowerCase()]==1}return d.test(t)}function ni(n){return bt.test(n)}function ti(t){for(var i,u=t.substr(1).split("%").map(function(n){return parseInt(n,16)}),r=0;r<u.length;++r)if((i=[u[r],u[r+1]||0,u[r+2]||0,u[r+3]||0],i[0]>=240&&++r&&i[3]<128)||i[0]>=224&&++r&&i[2]<128||i[0]>=192&&++r&&i[1]<128||i[0]<192&&i[0]>=128||i[0]<32||n.contains(nt,i[0]))return!1;return!0}function ii(n){return n.replace(/%25/g,"%2525").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.)?$/g,"%25$1").match(/[^%]+|(?:%..)*/g).map(function(n){return n.startsWith("%")&&!ti(n)?n.replace(/%/g,"%25"):n}).join("")}function s(t){var i=t;return t.includes("%")&&(t=n.safeExecute(function(){return ii(t)},"sanitizeUrlEncodings",i,i)),n.safeExecute(function(){return decodeURI(t)},"safeDecodeURI",i,i)}function u(n,t){var r,u,i;if(!n)return null;if(n=n.trim(),n.includes("%")&&h(n))if(n.includes("?")){var e=/([^?]*)(.*)/.exec(n),f=e[1],o=e[2];f=s(f);n=f+o}else n=s(n);return(r=yt.exec(n),!r)?null:(u=r[0].length,t&&u<n.length)?null:(i={length:u,type:0,protocol:r[1]||"",auth:r[2]||"",hostname:r[3]||"",port:r[4]||"",path:r[5]||"",parameters:r[6]||"",unparsedSegment:n.substr(u)},i.auth&&!i.auth.includes(":")&&!i.protocol&&!i.port&&!i.path&&!i.parameters)?null:i.protocol||i.path&&i.path.endsWith("/")?i:pt.test(i.hostname)||gt(i.hostname,t)||y.test(i.hostname)||w.test(i.hostname)?i:(i.type=i.path&&!ni(i.path)?1:2,i)}function ri(n,t){var r=new RegExp("[?&]{1}"+t+"=([^&]+)([\\/\\\\][^?#]*)?([?#].*)?"),i=n.match(r);return i?i[1]:null}function oi(n){return fi.some(function(t){return n.startsWith(t)})||ui.test(n)||n.toLocaleLowerCase().includes(ei)}function si(n,t,i){var e=0,o=0,s=0,r;(t.startsWith("read:")||t.startsWith("ftp:"))&&(t=t.replace(f,""));r=u(t,!0);r&&r.type==0&&(e=hi(i,r),o=ci(i,t,r),s=li(i,r));n.protocolMatchLength=e;n.domainMatchLength=o;n.pathMatchLength=s}function hi(n,t){var i=f.exec(n),r=i?i[1]:n.trim();return t.protocol.startsWith(r)?r.length:0}function ci(t,i,r){var u,f,o,e,s;return y.test(r.hostname)||w.test(r.hostname)?r.hostname.startsWith(t)||i.startsWith(t)?t.length:0:(u=r.hostname.split("."),u.length==1?f=HitHighlightingParser.addMarkers(u[0],t):(u=u.length>2&&n.SecondLevelDomains[u[u.length-2]]?u.splice(0,u.length-2):u.splice(0,u.length-1),o=u.join("."),f=HitHighlightingParser.addMarkers(o,t)),e=f.indexOf(HitHighlightingParser.startMarker),e==-1)?0:t.includes(".")?(t.endsWith("/")&&(t=t.substr(0,t.length-1)),r.hostname.includes(t)?t.length:0):(s=f.indexOf(HitHighlightingParser.endMarker),s-e-1)}function li(n,t){var i,r,u;return t.path?(i=HitHighlightingParser.addMarkers(t.path,n),r=i.indexOf(HitHighlightingParser.startMarker),r==-1)?0:(u=i.indexOf(HitHighlightingParser.endMarker),u-r-1):0}function ai(n){return n=it(n,!1),wt.test(n)}function tt(n){return f.test(n)}function vi(n){return l.test(n)}function h(n){return at.test(n)}function yi(n){return tt(n)&&!h(n)}function pi(n){var t;return t=typeof n=="string"?n:c(n,!0),t=bi(t),t.trim().replace(/^ht+p(s)?[:;]+[\\\/]*|^\/*/ig,function(n,t){return t?"https://":"http://"})}function it(n,t){return t?n.includes("/")||(n=n.replace(/\\/g,"/")):n.startsWith("//")||n.includes("\\")||(n=n.replace(/\//g,"\\")),n}function wi(n){return n=it(n,!0).replace(/\/+/g,"/"),(n.startsWith("/")?"file:/":"file:///")+n}function bi(n){if(!n||!n.includes("\\"))return n;var i=n.includes("?")?n.indexOf("?"):n.length,r=n.includes("#")?n.indexOf("#"):n.length,t=Math.min(i,r),u=n.substring(0,t),f=n.substr(t);return u.replace(/\\/g,"/")+f}function c(n,t){var i=n.protocol?n.protocol:"";return i+=!t&&n.auth?n.auth:"",i+=n.hostname,i+=n.port?n.port:"",i+=n.path?n.path:"",i+=n.parameters?n.parameters:"",i+(n.unparsedSegment?n.unparsedSegment:"")}function i(n,t){var i=n,r,f,e;return t&1&&(r=rt.exec(i),r&&(i=r[1])),t&2&&(r=ut.exec(i),r&&(i=r[1])),t&4&&(r=ft.exec(i),r&&(i=r[1])),t&8&&(r=l.exec(i),r&&(i=r[1])),t&16&&(r=ki.exec(i),r&&(i=r[1])),t&32&&(f=u(i,!1),f&&(f.protocol=f.protocol.toLocaleLowerCase(),f.hostname=f.hostname.toLocaleLowerCase(),e=c(f),i=i.replace(/^(\s*)(?:[^\s]*)(\s*)$/g,"$1"+e+"$2"))),t&64&&(i=s(i)),i}function di(n){return l.test(n)}function e(n){return ut.test(n)?1:rt.test(n)?2:ft.test(n)?3:0}function gi(n,t,r){var f,u,o,s,e;return t?t=="/"?n:(f=i(t,7),f!=t)?n:(u=i(n,r?7:6),!u)?n:(o=t.toLowerCase(),"https".startsWith(o)&&!u.startsWith(t))?n:(s=i(f,8),s!=f)?u:(e=i(u,8),!e)?u:"www".startsWith(o)&&!e.startsWith(t)?u:e:i(n,r?15:14)||n}function nr(n,t){var i=e(t);switch(e(n)){case 1:return i!=2;case 2:return i!=1;case 3:case 0:return!0}}function tr(t,r,u){if(i(r,127)!=i(u,127))return!1;var f=e(t.originalQuery);return n.contains([1,2],f)&&!nr(r,u)?!1:!0}function ot(n){var t=u(n,!0),i;return t?(i=st(t),i?t.path.toLocaleLowerCase():null):null}function st(n){var t=n.hostname.split(".");return n.hostname&&t.length>1?t[t.length-1]=="com"&&et.some(function(n){return t[t.length-2]==n}):!0}function ir(t){if(t=="https://www.bing.com/?form=EDGSTP&pc=MESP"||t=="https://www.bing.com/?form=EDGSTP&pc=MESPB")return!0;var i=ot(t);return!!i&&n.contains(n.WebSearchPaths,i)}function rr(n){var t=u(n.replace(/^ftp:/g,"http:"),!0);return(t?t.hostname:null)||""}function ur(t){var r=t.queryToFetch.toLocaleLowerCase(),f,u;return r?(f=["/","ht","htt","http","https","ww","www"],u=i(r,15),!u||n.contains(f,r)||u!=r&&"www".startsWith(i(r,7))):!1}function fr(n){var t,i;return lt.test(n)||f.test(n)?!0:(t=n.replace(kt,"/"),dt.test(t)?t=t.replace(g,"."):t.includes(".")&&(t=t.replace(g,"")),i=u(t,!0),i&&i.type==0)}var r="\\-\\s\\[\\]\\/\\\\!@#$%^&*()+={}:;~`\"'|<,>.。?",ht="(?:[^"+r+"]-*)*[^"+r+"](?:-*[^"+r+"])*",a="(?:[^"+r+"]-*)*[^"+r+"0-9](?:-*[^"+r+"])*",ct="(?:(?:"+ht+"[.。])*"+a+")[.。]?",v="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])",o="(?:(?:"+v+"\\.){3}"+v+")",y=new RegExp("^"+o+"$"),t="(?:[0-9a-fA-F]{1,4})",p="(?::(?:(?::"+t+"){1,7}|:)|(?:"+t+":){1,7}:|(?:"+t+":){7}"+t+"|(?:"+t+":){1,6}(?::"+t+"){1}|(?:"+t+":){1,5}(?::"+t+"){2}|(?:"+t+":){1,4}(?::"+t+"){3}|(?:"+t+":){1,3}(?::"+t+"){4}|(?:"+t+":){1,2}(?::"+t+"){5}|(?:"+t+":){1,1}(?::"+t+"){6}|fe80:(?::"+t+"){0,4}%[0-9]+|::ffff:"+o+"|)",w=new RegExp("^\\["+p+"\\]$","i"),b="ht+ps?[:;]+[\\\\/]*",lt=new RegExp(b,"i"),k=b+"|/+",at=new RegExp("^("+k+")","i"),vt=ct+"|"+o+"|\\["+p+"\\]",yt=new RegExp("^("+k+")?([^/@#?]*@)?("+vt+")(:(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{1,4}|[1-9][0-9]{0,3}))?([\\/\\\\][^?#]*)?([?#].*)?","i"),pt=/^localhost[.。]?$/,d=new RegExp("[.。]("+a+")[.。]?$","i"),wt=/((^[\\]{2}).+)|(^[a-z]:\\.*)/i,f=/^([a-z0-9\-]+):/i,bt=/\s/,g=/\s+/g,kt=/\s+\/(?!\/)/g,dt=/([^\/]|^)\/(?!\/)/,nt,et;n.WebSearchPaths=["/search","/entityexplore"];nt=[33,39,40,41,42,91,93];n.tryParseUrl=u;n.getQueryStringParam=ri;var ui=/file:\/\/\/[^:\/]+:\/[^\/]+\/[^\/]+\/AppData\//i,fi=["ms-appx:","ms-appx-web:","ms-browser-extension:",],ei="microsoft.microsoftedge_8wekyb3d8bbwe";n.isJunkUrl=oi;n.computeUrlMatchLengths=si;n.isUncOrLocalPath=ai;n.startsWithProtocol=tt;n.startsWithWww=vi;n.isHttpProtocol=h;n.isNonHttpProtocol=yi;n.cleanAndFixUrlProtocol=pi;n.cleanAndFixUncOrLocalPath=wi;n.parsedUrlToString=c;var rt=/^ht+ps:\/*(.*)/i,ut=/^ht+p:\/*(.*)/i,ft=/^\/{2,}(.*)/,l=/^www\.(.*)/i,ki=/^(.*[^:\/])\/+$/;n.normalizeUrl=i;n.hasWww=di;n.getProtocol=e;n.prettyPrintUrl=gi;n.isDuplicateUrl=tr;et=["bing","staging-bing-int","working-bing-int","bing-int","bing-exp"];n.tryGetBingPathLC=ot;n.isBingHost=st;n.isBingSearchUrl=ir;n.getDomain=rr;n.isEmptyUrlPrefix=ur;n.queryLooksLikeUrl=fr}(AutoSuggest||(AutoSuggest={})),function(n){var t,i;(function(n){function t(t,i,r,u,f,e){var o={T:n.QFPERFPING_EVENT_NAME,ST:r,CVID:u,OFFSETS:i,STATE:f,V:n.QFPERFPING_VERSION,RFC:e};return{ImpressionGuid:t,EventType:n.CLIENTINST_EVENT_TYPE,Data:o}}n.CLIENTINST_EVENT_TYPE="ClientInst";n.QFPERFPING_EVENT_NAME="QFPerfPing";n.CLICK_EVENT_TYPE="Click";n.QFPERFPING_VERSION="2";n.QFPERFPING_INVALID_MEASURE=-2;n.INVALID_SEQUENCE_NUMBER=-2;n.KVALUE_SUGGESTIONS_START=1e3;n.KVALUE_SUFFIX_START=1;n.KVALUE_NON_SUGGESTIONS_START=100;n.DEFAULT_APP_NAMESPACE="SmartSearch";n.DEFAULT_SERVICE_NAME="AutoSuggest";n.createPerfPingEvent=t})(t=n.InstrumentationCommon||(n.InstrumentationCommon={}));i=function(){function n(n,t){this._kValue=n;this._handOffType=t}return n.createInstrumentedItem=function(t){return new n(n.generateKValue(t))},n.getNonSuggestionInstrumentedItem=function(t,i,r){return new n(i[t],r)},n.prototype.getKValue=function(){return this._kValue},n.prototype.getAppNS=function(){return n.AppNS},n.prototype.getLayoutKValue=function(){return this._kValue+"."+n.Suffix},n.prototype.getHValue=function(){return"ID="+n.AppNS+","+this.getLayoutKValue()},n.prototype.getHandoffType=function(){return this._handOffType},n.resetKValues=function(n){delete this._keystrokesKValues[n]},n.generateKValue=function(n){var r=n,i=this._keystrokesKValues[r];return i>0||(i=t.KVALUE_SUGGESTIONS_START),this._keystrokesKValues[r]=++i,i},n.AppNS=t.DEFAULT_APP_NAMESPACE,n.Suffix=t.KVALUE_SUFFIX_START,n._keystrokesKValues={},n}();n.InstrumentedItem=i}(AutoSuggest||(AutoSuggest={})),function(n){function lt(){return matchMedia("screen and (-ms-high-contrast)").matches}function at(){return navigator.onLine}function vt(n){return!n.isAnswer&&(n.handoffType==0||n.handoffType==11)}function c(n){return n?n.replace(ut,"$1").replace(ft,"$1 "):n}function yt(n){return n?n.replace(/[-{}]/g,"").toLowerCase():null}function pt(n){return!n||Object.keys(n).length===0}function l(n,t,i,r){var u,e;n&&(n=n.slice(0,t)+f+n.slice(t,n.length));u=i(n);u&&(e=u.indexOf(f),t=e!=-1?e:t,u=u.replace(f,""));r(u,t)}function wt(n){if(!n)return SharedLogHelper.LogError("getInputType",null,new Error("event object is missing")),0;switch(n.pointerType){case"mouse":return 2;case"touch":return 3;case"pen":return 4;default:return 1}}function e(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];i.forEach(function(t){return delete n.enabledDataSources[t]})}function a(i){return i&&n.config.bingEnabledRegionsList&&n.config.bingEnabledRegionsList.length>0&&!t(n.config.bingEnabledRegionsList,i.toLowerCase())}function bt(t,i){var r=t.queryToFetch&&t.queryToFetch.length<n.config.minQueryLengthForWebProvider||a(i);return r&&(e(t,n.WebDataSource),e(t,n.WebRankingSignalDataSource),e(t,n.WsbTopKDataProvider)),r}function v(t){if(t){t=n.normalizeUrl(t,15);for(var i=1;i<t.length-1;++i)if(ot.includes(t[i]))return!0}return!1}function kt(t,i,r){var u,f;return l(t,i,function(n){return c(n)},function(n,t){u=n;f=t}),u&&(n.config&&n.config.doNotRemoveSpaceAfterIn&&u.toLocaleLowerCase().endsWith(" in ")||(u=u.trim()),f=Math.min(f,u.length)),{originalQuery:t,originalCursorPosition:i,queryToFetch:u,cursorPosition:f,enabledDataSources:{},equals:function(n){return(u?u.toLowerCase():u)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&r==n.topHitRestriction},isMultiWord:v(u),getCacheKey:function(){return u},topHitRestriction:r}}function y(i,r){return r&&!r.enabledDataSources[i]?!1:t(n.config.enabledDataSources,i)}function p(i,r,u,f){var e=f.enabledDataSources[i];return e?e.suggestionIsEnabled&&!e.suggestionIsEnabled(r,u)?!1:t(n.config.enabledDataSources,i):!1}function t(n,t){return n.indexOf(t)!=-1}function dt(n,t){var i=n.indexOf(t);return i!=-1?(n.splice(i,1),!0):!1}function gt(n,t){var i=n.findIndex(t);return i!=-1?n.splice(i,1)[0]:null}function ni(n,t,i){if(t<100)for(var r=n.length-1;n.length>t&&r>=0;--r)i(n[r])&&n.splice(r,1)}function ti(n,i){return n.filter(function(n){return!t(i,n)})}function ii(n,t){if(n.length!=t.length)return!1;for(var i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0}function ri(n,t){if(n===t)return!0;if(!n||!t||Object.keys(n).length!=Object.keys(t).length)return!1;for(var i in n)if(n[i]!=t[i])return!1;return!0}function w(){return n.getCurrentDate().getTime()}function r(n){var t=Math.abs(Math.floor(n));return(t<10?"0":"")+t}function ui(){var t=n.getCurrentDate(),i=-t.getTimezoneOffset(),u=i>=0?"+":"-";return t.getFullYear()+"-"+r(t.getMonth()+1)+"-"+r(t.getDate())+"T"+r(t.getHours())+":"+r(t.getMinutes())+":"+r(t.getSeconds())+"."+r(t.getMilliseconds())+u+r(i/60)+":"+r(i%60)}function fi(n,t){return n?n.replace(et,function(n,i){return t[i]}):n}function ei(n){var t=n?n.number:null,i=n?n.name:null;return t==-2147023673||i=="Canceled"}function u(n,t,i,r,u,f){try{return n()}catch(e){return f||SharedLogHelper.LogError(t,r,e),u&&u(),i}}function oi(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];u(function(){return sj_evt.fire.apply(sj_evt,[n].concat(i))},n)}function s(n,t){var i=[],r=!0,u=function(){for(var u=[],n=0;n<arguments.length;n++)u[n]=arguments[n];r?i.push(u):t.apply(null,u)};n(u);r=!1;i.forEach(function(n){return t.apply(null,n)})}function si(n,t){return o=n&&!a(t)}function hi(){return o}function li(n){return t(d,n)}function ai(n){return t(b,n)}function vi(n){return t(k,n)}function yi(n){return t(ci,n)}function pi(n,t,i){return i?n==93:n==121&&t}function wi(n,t){return n==8||n==46||n==88&&t.ctrlKey}function bi(){return _w.location.protocol}function ki(){return _w.location.host}function di(){return _d.activeElement}function g(t){return t&&+t!=n.WindowsApiDefaultDate&&!isNaN(t.getTime())&&t.getFullYear()!=1600}function nt(n){if(!g(n))return null;var t=n.getTime(),i=w();return Math.abs(i-t)/ct}function gi(n){var t=nt(n);return t!==null&&t>14}function nr(n){return n==="i"?13:n==="v"?14:0}function tr(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")}var f=String.fromCharCode(57346),ut=new RegExp("^\\s*("+f+")?\\s*"),ft=new RegExp("\\s*("+f+")?\\s+","g"),et=/{([0-9]+)}/g,ot=" -_/\\",st=-2147215328,ht=-2147023673,ct=864e5,i,o,h,tt,it,rt;n.DebugSourceName="AutoSuggest";SharedLogHelper.RegisterErrorFilter(function(n){var t=n?n.number:null,i=n?n.name:null;return t===ht||t===st||i==="Canceled"});n.isHighContrastEnabled=lt;n.isBrowserOnline=at;n.isWebSuggestion=vt;n.cleanQuery=c;n.cleanGuid=yt;n.isEmpty=pt;n.mantainCursorPositionIn=l;n.getInputType=wt;n.disableDataSources=e;n.disableWebDataSourceIfNeeded=bt;n.isMultiWord=v;n.parseQuery=kt;n.isDataSourceEnabled=y;n.isSuggestionTypeEnabled=p;n.contains=t;n.tryRemove=dt;n.removeFirstWhere=gt;n.trimList=ni;n.except=ti;n.sequenceEqual=ii;n.objEquals=ri;n.log=function(){};n.getCurrentDate=function(){return new Date};_w.ClientTestHooks&&(n.log=function(n,t){return ClientTestHooks.ClientLog("- "+n,t)},i=ClientTestHooks.getUrlValue("currentdate",null),i&&(i.includes("-")||i.length!=8||(i=i.substr(0,4)+"-"+i.substr(4,2)+"-"+i.substr(6,2)),n.getCurrentDate=function(){return new Date(i)}));n.getCurrentTime=w;n.getDateWithTimezone=ui;n.fetchWrapper=function(n,t,i){return i()};n.formatString=fi;n.isCancellation=ei;n.safeExecute=u;n.safeFireEvent=oi;n.ensureCallbackIsAsync=s;n.WebDataSource="Web";n.WebRankingSignalDataSource="WRS";n.MRUDataSource="MRU";n.WsbTopKDataProvider="TOPK";o=!0;n.refreshBingEnabledCache=si;n.isBingEnabled=hi;var b=[38,203,211,],k=[40,204,212,],d=b.concat(k),ci=d.concat(37,39,36,35);n.isUpOrDownKey=li;n.isUpKey=ai;n.isDownKey=vi;n.isMovingCursorKey=yi;n.isContextMenuKey=pi;n.isDeletionKey=wi;n.getWindowProtocol=bi;n.getWindowHost=ki;n.getCurrentActiveElement=di;n.WindowsApiDefaultDate=-116444736e5;n.isValidDate=g;n.getTimeDiffInDays=nt;n.olderThan2Weeks=gi;n.verticalToHandoffType=nr;h=function(){function n(){this._cancellations={};this._lastId=0}return n.prototype.register=function(n,t,i){var r=++this._lastId;return this._cancellations[r]={action:n,skipOnDismissAndLaunch:t,where:i},r},n.prototype.unregister=function(n){delete this._cancellations[n]},n.prototype.cancelAll=function(n){var t=function(t){var r=i._cancellations[t];r.skipOnDismissAndLaunch&&n||u(function(){return r.action()},r.where)},i=this;for(var r in this._cancellations)t(r);this._cancellations={}},n}();n.CancellationManager=h;tt=function(){function n(){}return n.prototype.getItem=function(n){try{return _w.localStorage?_w.localStorage.getItem(n):undefined}catch(t){return SharedLogHelper.LogError("localStorage",t,new Error("getItem")),undefined}},n.prototype.setItem=function(n,t){try{_w.localStorage&&_w.localStorage.setItem(n,t)}catch(i){SharedLogHelper.LogError("localStorage",i,new Error("setItem"))}},n.prototype.removeItem=function(n){try{return _w.localStorage.removeItem(n)}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("removeItem"))}},n}();n.LightweightStorage=tt;it=function(){function n(){this._sequenceNumber=0}return n.prototype.getSequenceNumber=function(){return this._sequenceNumber},n.prototype.incrementSequenceNumber=function(){this._sequenceNumber++},n}();n.SequenceNumberManager=it;rt=function(){function t(t,i,r,u,f,e,o,s,c){var l=this;this._host=t;this._suggestionsParsers=i;this._rootViewModel=r;this._suggestionsRenderingManager=u;this._webProviders=f;this._otherProviders=e;this._instrumentationHelper=o;this._ariaLogger=s;this._sequenceNumberManager=c;n.config.cancellationEnabled&&(this._cancellationManager=new h);t.bindShown(function(){l._lastQuery=null;l._currentQuery=null;l._isPaneDismissed=!1});t.bindDismissed(function(){l.clearFetchTimer();l.finishPreviousQuery(!0);l.finalizeKeystroke(!0);l._isPaneDismissed=!0});t.bindQueryChangedOrInitialized(function(t,i){return l.onQueryChanged(t,n.config.d,i)});t.bindOnSubmit(function(n,t,i){return l.onSubmit(n,t,i)});t.initializeEvents();sj_be(_d.body,"dragstart",function(n){return n.preventDefault(),n.stopPropagation(),!1});sj_b.addEventListener("click",function(n){n.shiftKey&&sj_pd(n)})}return t.prototype.clearFetchTimer=function(){this._fetchTimer&&(sb_ct(this._fetchTimer),this._fetchTimer=null)},t.prototype.finishPreviousQuery=function(n){this.cancelPreviousQuery(n);this._suggestionsRenderingManager.resetTimers()},t.prototype.finalizeKeystroke=function(n){var t=this._sequenceNumberManager.getSequenceNumber();t>0&&this._instrumentationHelper.finalizeKeystrokeLog(t);n||this._sequenceNumberManager.incrementSequenceNumber()},t.prototype.onQueryChanged=function(n,t,i){var r=this,f;this.clearFetchTimer();this._currentQuery=n;this._lastQuery&&(!this._lastQuery.equals(this._currentQuery)||i)&&this.cancelPreviousQuery(!1);t<=0?this.fetchForQueryChange(0,!1,i):(f=Date.now(),this._fetchTimer=sb_st(function(){r._fetchTimer=null;u(function(){return r.fetchForQueryChange(Date.now()-f,!1,i)},"fetchTimer")},t))},t.prototype.onSubmit=function(n,t,i){this._fetchTimer&&(this._currentQuery||(this._currentQuery=this._host.getQuery()),this.fetchForQueryChange(0,!0,!1));this._rootViewModel.submit(n,t,this._sequenceNumberManager.getSequenceNumber(),i,this._isPaneDismissed)},t.prototype.cancelPreviousQuery=function(n){this._cancellationManager&&this._cancellationManager.cancelAll(n)},t.prototype.fetchForQueryChange=function(t,i,r){var u=this,e,f,h;if(this.clearFetchTimer(),this._lastQuery&&this._lastQuery.equals(this._currentQuery)&&!r)this._rootViewModel.onQueryChanged(this._currentQuery,this._sequenceNumberManager.getSequenceNumber());else if(e=this._host.getQuery(),e.equals(this._currentQuery)){if(this.finishPreviousQuery(i),this.finalizeKeystroke(!1),this._lastQuery=this._currentQuery,f=this._sequenceNumberManager.getSequenceNumber(),this._instrumentationHelper.instrumentBeginRequest(f,this._currentQuery,t),h=!n.config.enabledDataSources.some(function(n){return y(n,u._currentQuery)}),h)this._rootViewModel.onQueryChanged(this._currentQuery,f);if(this._suggestionsRenderingManager.initiateSequenceNumber(f,this._currentQuery),!h){var o=function(){return!u._isPaneDismissed&&(n.config.d>0?e.equals(u._currentQuery):f==u._sequenceNumberManager.getSequenceNumber())},c=(new Date).getTime(),l=function(n,t,i,r,s){return u.onResponseReceived(e,f,n,t,i,o,r,s,c)},a=function(t){n.fetchWrapper(e,o,function(){u._webProviders.forEach(function(n){return u.fetchWeb(e,n,f,t,o)});u._otherProviders.forEach(function(n){return u.fetch(e,n,f,t,o)})});u._rootViewModel.onQueryChanged(u._currentQuery,f)};s(a,l)}}},t.prototype.fetchWeb=function(t,i,r,f,e){var c=this,s=n.Service.QueryParams,o=this._host.getCustomUrlParameters(t),h;this._host.shouldRequestEltoken()&&(o[s.RequestElToken]="1");o[s.CursorPosition]=t.cursorPosition.toString();o[s.ConversationId]=this._host.getConversationId();o[s.ImpressionGuid]=this._instrumentationHelper.getImpressionGuid(r);h=this._host.getCustomHeaders();u(function(){return i.fetch(t,f,r,c._cancellationManager,e,o,h)},"fetch "+i.getName())},t.prototype.fetch=function(n,t,i,r,f){var e=this;u(function(){return t.fetch(n,r,i,e._cancellationManager,f)},"fetch "+t.getName())},t.prototype.onResponseReceived=function(t,i,r,u,f,e,o,h,c){var l=this,y=n.getCurrentDate().getTime()-c,a,v;this._ariaLogger&&this._ariaLogger.logDataProviderLatency(r,y);e()&&(this._instrumentationHelper.instrumentResponseReceived(i,r,f,o,h),a=function(n,r,u){if(e())l.onSuggestionsParsed(t,i,n,f,r,u)},v=function(n){var f=l._suggestionsParsers[r];f?f.parse(t,i,r,u,e,n,l._cancellationManager):(SharedLogHelper.LogError("onResponseReceived",null,new Error("No parser for data source "+r)),n(r,[],null))},s(v,a))},t.prototype.onSuggestionsParsed=function(n,t,i,r,u,f){u=u.filter(function(t){return p(i,t.type,t.handoffType,n)});this._instrumentationHelper.instrumentDataSource(t,i,u,f);this._rootViewModel.onSuggestionsParsed(n,t,i,r,u,f);this._suggestionsRenderingManager.queueSuggestions(t,i,u,f)},t}();n.Core=rt;n.encodeQueryParameter=tr}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function u(u,f,e,o,s){var c=u.content,k=!u.cursorPos&&u.cursorPos!==0?c.length:u.cursorPos,d=c?c.replace(/^\?/,""):c,h=n.parseQuery(d,k,o),y,b;h.isZeroInput=!c;var a=1,v=c,p=u.isRegisteredProtocol,w=c&&p&&n.isNonHttpProtocol(c)&&!r.test(c),l=n.tryParseUrl(c,!0);return c&&!c.startsWith("?")&&(n.isUncOrLocalPath(c)?(a=0,v=n.cleanAndFixUncOrLocalPath(c)):w?a=0:l&&(l.type==0||f.domainJoined&&l.type==1)?(a=0,v=n.cleanAndFixUrlProtocol(l)):f.domainJoined&&l&&l.type==2&&(a=2,v=n.cleanAndFixUrlProtocol(l))),h.isZeroInput?(s=="AB"&&(i(e,f)&&(h.enabledDataSources[n.WebDataSource]={}),f.inPrivate||f.showFrequentTopSites===!1||(h.enabledDataSources.Local={})),f.showDocumentSuggestions!==!1&&t.config.zeroInputCloudDocs&&!f.inPrivate&&(h.enabledDataSources.SSUE={})):h.queryToFetch&&(h.queryToFetch=h.queryToFetch.toLowerCase(),t.config.enabledDataSources.forEach(function(n){return h.enabledDataSources[n]={}}),(f.searchPeople!==!1||t.config.substrateDocumentsEnabled&&f.searchDocuments!==!1)&&t.isOffice365TokenAvailable&&!f.inPrivate||n.disableDataSources(h,"SSUE")),t.config.enableUrlTrieSuggestion&&f.inPrivate?n.disableDataSources(h,"UAS"):t.config.filterUrlInProvider&&(h.queryToFetch.endsWith(".")||t.hasWWW(h)||t.hasProtocols(h)||(y=n.tryParseUrl(c,!1),y&&y.type!=2||n.disableDataSources(h,"UAS"))),(e||!t.isBingAtWorkTokenAvailable||f.inPrivate)&&n.disableDataSources(h,"BAW"),n.disableWebDataSourceIfNeeded(h,f.market)||(b=a==0&&w,(f.inPrivate||!f.searchSuggestionsOn||b)&&n.disableDataSources(h,n.WebDataSource)),h.originalQuery=c,h.fixedUrl=v,h.intent=a,h.hasRegisteredProtocol=p,h.parsedUrl=l,h.equals=function(n){return n.isZeroInput==h.isZeroInput&&n.queryToFetch==h.queryToFetch&&n.intent==h.intent&&n.topHitRestriction==h.topHitRestriction},h.getCacheKey=function(){return(h.isZeroInput?"1":"0")+h.queryToFetch},h}function i(n,i){return!n&&t.config.historySettingsPresent&&i.showSearchHistory!==!1}var r=/^(ftp):+\/*$/;t.isOffice365TokenAvailable=!1;t.isBingAtWorkTokenAvailable=!1;t.parseQuery=u;t.searchHistoryAllowed=i})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function r(t,i){n.log(i);t&&t.adjustHeight()}function e(n){_ge("ClientLog").innerHTML="";n&&n.adjustHeight()}function u(n,t){return n=n?n.replace(/[^\x00-\x7F]/g,""):n,n&&n.length>t?n.substr(0,t)+"…":n}function o(n){return new Date(c(h(n)))}function h(n){return(n-s)/1e4}function c(t){var i=n.getCurrentDate().getTimezoneOffset(),r=i*6e4;return t+r}function l(n){var t=n.handoffType==1?"1":"0",i=n.isAnswer?"1":"0";return t+"\t"+i+"\t"+n.query}function a(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){return{id:t,type:i,query:r,text:u,secondaryText:f,url:e,hc:h,icon:c,secondaryTextClass:n?"b_hide":o,classNames:s,handoffType:l,intent:a,instItem:v,sequenceNumber:y,isAnswer:w,htmlContent:b,selected:!1,getMruData:null,mayContainPII:p,features:[],additionalInfoText:n?f:undefined}}function f(n){return n.secondaryTextClass==t.CssClass_Title}function v(n){if(n.htmlContent)return null;var t=HitHighlightingParser.removeMarkers(n.text);return n.additionalInfoText&&(t+=", "+n.additionalInfoText),t+(f(n)?", "+HitHighlightingParser.removeMarkers(n.secondaryText):", "+n.secondaryText)}function y(n){switch(n.type){case"ML":return i.DeepLinks;case"HS":return i.SearchHistory;case"FQ":return i.FrequentSites;case"TIP":return i.CortanaTips;case"FA":return i.FrequentApps;case"RFL":return i.RecommendedDocuments;case"BFBBKS":return i.BingAtWork;case"PP":return i.Apps;case"PPL":return i.People;case"ME":return i.Messages;case"TD":return i.ToDo;case"FL":return i.Documents;case"ST":return i.SystemSettings;case"LST":return i.LauncherSettings}throw new Error("No group for suggestions of type "+n.type);}function p(n,t){return n==1&&t!="FQ"}function w(n){return n.type!="PPL"&&(n.handoffType==0||n.handoffType==11||n.handoffType==15||n.handoffType==14||n.handoffType==16||n.handoffType==1&&n.type=="BFBBKS")}function b(n){return n.type=="TU"||n.duplicates&&n.duplicates.some(function(n){return n.type=="TU"})}function k(t,i){var e,h,c;if(i.queryToFetch){if(t.handoffType==1){var o=t.url,s=o.indexOf(":"),r=s>0?o.slice(0,s+1):"http:",u=t;u.isHttpHttpsOrFtpProtocol=r=="http:"||r=="https:"||r=="ftp:";u.isReadProtocol=r=="read:";u.prefixStartsWithProtocol=s>0&&i.queryToFetch.startsWith(r);n.computeUrlMatchLengths(u,o,i.queryToFetch)}t.title&&(e=f(t)?t.secondaryText:t.text,h=e.indexOf(HitHighlightingParser.startMarker),h>=0&&(t.titleMatchFirstWordPos=e.split(" ").findIndex(function(n){return n.includes(HitHighlightingParser.startMarker)})+1,c=e.indexOf(HitHighlightingParser.endMarker),t.titleMatchLength=c-h-1))}}function d(n,i){if(!t.config.suppressWeakUrlMatches||!n.queryToFetch||n.isMultiWord)return!0;var r=i.type=="FV"||i.type=="BFBBKS",u=i.isHttpHttpsOrFtpProtocol||r&&i.isReadProtocol;return u?i.protocolMatchLength>0||i.domainMatchLength>0||i.pathMatchLength>=t.config.minLengthForPathMatch||i.titleMatchLength&&(r||i.titleMatchFirstWordPos==1||i.titleMatchLength>=t.config.minLengthForTitleMatch):r?i.titleMatchLength>0:i.prefixStartsWithProtocol}function g(n){return n&&n.type?n.type=="NWU"||n.type=="NWB"||n.type=="NWT"||n.type=="NWF":!1}function nt(n){var t=n.queryToFetch.toLocaleUpperCase();return t&&t.startsWith("WWW.")?!0:!1}function tt(n){var t=n.queryToFetch.toLocaleUpperCase();return t&&(t.startsWith("HTTP://")||t.startsWith("HTTPS://"))?!0:!1}function it(n){var i,r,u;if(!t.config.normalizeNumOfSuggestions||!n||n.length<1)return n;if(i=n.filter(function(n){return n.type=="MB"||n.htmlContent!=null}),i&&i.length>0&&n.length>=t.config.maxSuggestions){var f=i.length,e=[],o=n.length;for(r=o-1;r>=0;r--){if(u=n[r],u.type!="MB"&&!u.htmlContent&&f>0){f--;continue}e.push(u)}return e.reverse()}return n}var s=116444736000000000,i;(function(n){n[n.FrequentSites=0]="FrequentSites";n[n.SearchHistory=1]="SearchHistory";n[n.DeepLinks=2]="DeepLinks";n[n.CortanaTips=3]="CortanaTips";n[n.FrequentApps=4]="FrequentApps";n[n.RecommendedDocuments=5]="RecommendedDocuments";n[n.Apps=6]="Apps";n[n.People=7]="People";n[n.Messages=8]="Messages";n[n.Documents=9]="Documents";n[n.ToDo=10]="ToDo";n[n.SystemSettings=11]="SystemSettings";n[n.LauncherSettings=12]="LauncherSettings";n[n.BingAtWork=13]="BingAtWork"})(i=t.GroupType||(t.GroupType={}));t._resetClientLog=e;t.allSuggestionsTraceReset=t.config.th&&ClientTestHooks.isTesthookParamSet("allSuggestionsTrace")?e:null;t.autoCompleteTrace=t.config.th&&ClientTestHooks.isTesthookParamSet("autoCompleteTrace")?r:null;t.localSuggestionsTraceRaw=t.config.th&&(ClientTestHooks.isTesthookParamSet("localSuggestionsTrace")||ClientTestHooks.isTesthookParamSet("allSuggestionsTrace"))?r:null;t.localSuggestionsTrace=t.config.th&&ClientTestHooks.isTesthookParamSet("localSuggestionsTrace")?function(t,i,f){return f===void 0&&(f=""),r(t,(f?"["+f+"] ":f)+[i.type,i.visitCount,n.getTimeDiffInDays(o(i.lastAccessed)),u(i.title,50),u(i.url,75),i.email,i.phone,i.content,i.receivedDate,i.alarmDate,i.isStarred,i.location].filter(function(n){return!!n}).join(" | "))}:null;t.allSuggestionsTrace=t.config.th&&ClientTestHooks.isTesthookParamSet("allSuggestionsTrace")?function(n,t,i){return i===void 0&&(i=""),r(n,(i?"["+i+"] ":i)+[t.type,t.rankingScore,t.fbcScore,u(t.text,50)].map(function(n){return!n?"null":n}).join(" | "))}:null;t.parseServiceUiDate=o;t.AnswerHeight=104;t.GroupHeight=33;t.SmallerSuggestionHeight=28;t.DefaultSuggestionHeight=33;t.WideSuggestionHeight=40;t.SuggestionHeight=t.DefaultSuggestionHeight;t.Suggestion2LinesHeight=58;t.MRUDatabaseName="EDGE_MRU";t.CssClass_Title="title";t.CssClass_Annotation="annotation";t.CssClass_AnnotationForced=t.CssClass_Annotation+" always";t.BingSearchProvider="Bing";t.getSuggestionKey=l;t.createSuggestion=a;t.secondaryTextIsTitle=f;t.getSuggestionNarratorText=v;t.SyntheticQSCodesKValues=function(){var n={};return n.PF=101,n.PWE=102,n.TK=103,n.N=104,n.MSH=105,n}();t.GroupHeaderQSCodes=function(){var n={};return n[i.SearchHistory]="MSH",n}();t.getGroupType=y;t.displayAsUrl=p;t.hasReverseHighlighting=w;t.considerAsTypedURL=b;t.computeMatchProperties=k;t.isRelevantUrlSuggestionForThisQuery=d;t.isNextWord=g;t.hasWWW=nt;t.hasProtocols=tt;t.normalizeSuggestions=it})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t,i,r;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];r=function(){function r(n,t,i){i===void 0&&(i=Date.now);this._autoSuggestHost=n;this._instrumentationHelper=t;this.getNowTimestamp=i;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}return r.prototype.instrumentSuperFreshUpdate=function(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()},r.prototype.registerSuperFresh=function(){this._superFreshEnabled=!0},r.prototype.subscribeForEvents=function(){var n=this;i.forEach(function(t,i){return sj_be(n._appCache,t,function(){return n.handleAppCacheEvent(t,i)})})},r.prototype.handleAppCacheEvent=function(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogError("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}},r.prototype.sendAppCacheEvents=function(){var f=_G.ServerIG,t,r,u,i;if(!f){SharedLogHelper.LogError("sendAppCacheEvents","Could not instrument as server IG not known",new Error("Could not instrument app cache event"));return}(t=this._appCacheTimeline,t)&&(r=t.AppCacheEvents,u=[{I:t.EventIndex,E:r,S:t.SuperFreshUpdateData,ABT:this._instrumentationHelper.getConversationStartTimestamp()}],r[2]&&(u[0].OL=navigator.onLine),i=n.InstrumentationCommon.createPerfPingEvent(f,u,"AppCache",this._autoSuggestHost.getConversationId()),Log2.LogEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null),this._appCacheTimeline=this.createAppCacheTimelineObject())},r.prototype.createAppCacheTimelineObject=function(){var n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n},r}();n.AppCacheInstrumentationHelper=r}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i="MUID",r=function(){function r(n){var t=this;this._host=n;this._isAadTokenAvailable=!1;n.bindAccessTokenAvailable(function(){t._isAadTokenAvailable=!0});n.bindDismissed(function(){t._muidCache=undefined})}return r.prototype.logProfilerMarker=function(){},r.prototype.getSuggestionsPageName=function(){return"Page.SpartanOneBox.AS.Suggestions"},r.prototype.getApplicationName=function(){return"SpartanOneBox"},r.prototype.getRankerModelId=function(){return t.config.mainRankerId},r.prototype.createNonSuggestionDataSourceObject=function(n,t){return{T:"D.Url",K:t.getKValue(),Val:n,Ho:t.getHandoffType(),NR:1}},r.prototype.createDataSourceObject=function(n){var i=n.mayContainPII||this._host.getMachineState().inPrivate,t={T:"D.Url",K:n.instItem.getKValue(),Q:i?undefined:n.query,Val:n.type,Ho:n.handoffType,Ans:n.isAnswer?1:undefined,AC:n.autoCompleteType?n.autoCompleteType:undefined,HCMS:n.highConfidenceMetaSuggestionScore,HCS:n.highConfidenceSuggestionScore,LM:n.suggestionLogMeta,F:n.features.length>0?n.features.join(","):undefined,PRF:n.prefetchRequested?1:undefined,NR:n.notAResult?1:undefined};return t.RankerSignals=this.buildRankerOutputDataSource(n),t},r.prototype.buildRankerOutputDataSource=function(n){if(!n.featureStore)return undefined;return{featureStore:n.featureStore,rankingScore:n.rankingScore,fbcScore:n.fbcScore,prefetch:n.isAbovePrefetchThreshold?1:undefined,prefetchScore:n.prefetchScore}},r.prototype.logMasterPageImpression=function(t,i){var r=this;Log2.LogMasterPageImpression(t);t.pageName===this.getSuggestionsPageName()&&n.safeExecute(function(){return r.sendSuggestionsRenderedReply(t.impressionGuid,i)},"sendSuggestionsRenderedReply")},r.prototype.getEnrichedClientInfo=function(){var n={},i=this._host.getMachineState(),r;return n.searchProvider=i.searchProvider,n.domainJoined=i.domainJoined?1:0,n.EnableRegulatoryPsm=i.enableRegulatoryPsm?1:0,n.EnableCPsm=i.enableCPsm?1:0,n.pageType=this._host.getPageType(),n.ZeroInput=this._host.getQuery().isZeroInput?1:undefined,this._host.isClientLocationAvailable()&&(n.clientLocationAvailable=1),n.IsTouch=t.isTouchDevice()?"true":"false",n.InitInputType=this._host.getInitialInputType(),n.CortanaOptIn=i.cortana?"true":"false",i.cortanaCapabilities&&(n.CortanaCapabilities=i.cortanaCapabilities),r=0,this._host.isSignedInWithMSA()?r=2:this._isAadTokenAvailable&&(r=1),r!=0&&(n.windowsAccount=r),n},r.prototype.logDataSourceTimeout=function(){},r.prototype.sendSuggestionsRenderedReply=function(n,i){n||SharedLogHelper.LogError("sendSuggestionsRenderedReply",null,new Error("Missing impressionGuid"));i||SharedLogHelper.LogError("sendSuggestionsRenderedReply",null,new Error("Missing cvid"));var r={impressionGuid:n?this.formatAsGuid(n):null,conversationGuid:i?this.formatAsGuid(i):null,clientGuid:this.getMuidCookie()};t.postFrameMessage("resultsRendered",r)},r.prototype.getMuidCookie=function(){if(!this._muidCache){var n=sj_cook.get(i);n&&(n=n.substr(i.length+1),this._muidCache=this.formatAsGuid(n))}return this._muidCache},r.prototype.formatAsGuid=function(n){return"{"+[n.substring(0,8),n.substring(8,12),n.substring(12,16),n.substring(16,20),n.substring(20,32)].join("-")+"}"},r.prototype.onItemClick=function(){},r}();t.OneBoxInstrumentationProvider=r})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var i="/QF_KEYSTROKE_VIRTUAL_URL?",r="autosuggest",t,u=function(){function u(i,r){var u=this,f;this._host=i;this._clientInstrumentationProvider=r;this._conversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;this._keystrokesPerfPingData={};this._keystrokesInstrumentationData={};ClientInstConfig.queueDumpInterval=n.config.logQueueDumpInterval;_w.ClTrCo.SharedClickSuppressed=!0;i.bindConversationStart(function(){return u.onConversationStart()});n.config.th&&(ClientTestHooks.isTesthookParamSet("perfTrace")&&(t=!0),f=n.log,n.log=function(n,t){t||u.instrumentDebugEvent(n);f(n,t)})}return u.prototype.getImpressionGuid=function(n){var t=this._keystrokesInstrumentationData[n];if(t&&t.ImpressionGuid)return t.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;},u.prototype.instrumentItemClick=function(t,i,r,u,f,e,o,s,h){this.logCustomGPing(t,f,i.getHValue(),o,e,s,h);var l=this._keystrokesInstrumentationData[r],c=this._keystrokesInstrumentationData[r];c?(l.RenderingStarted||this.updatePageIG(r),_G.IG!=c.ImpressionGuid&&SharedLogHelper.LogError("instrumentItemClick","IG ("+c.ImpressionGuid+") for sequenceNumber "+r+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)"))):SharedLogHelper.LogError("instrumentItemClick","sequenceNumber: "+r+" ConversationID: "+this._host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));this.finalizeKeystrokeLog(r,1);u&&u();this._clientInstrumentationProvider.onItemClick();n.config.forceLogFlush?Log2.ForceFlush():Log2.FlushMainQueueDontForce();_w.clickFlushedTime=sb_gt()},u.prototype.logCustomGPing=function(t,i,r,u,f,e,o){var s={},h;u&&(s.cm=u);switch(i){case 1:s.i="k";s.mk=this.getModifierKeyCodes(f);break;case 3:s.i="t";break;case 4:s.i="p";break;case 5:s.i="n";break;case 6:s.i="b";break;case 0:s.i="x";s.mk=this.getModifierKeyCodes(f);break;default:s.mk=this.getModifierKeyCodes(f)}e&&(s.pp=e,o&&(s.ppit=o));h=r;n.isEmpty(s)||(h+="&PR="+JSON.stringify(s));n.safeExecute(function(){return _w.si_T(h,null,null,0,t)},"logCustomGPing")},u.prototype.getModifierKeyCodes=function(n){if(n){var t=n.altKey?"A":"";if(t+=n.ctrlKey?"C":"",t+=n.shiftKey?"S":"",t)return t}return undefined},u.prototype.logClientInstEvent=function(n,t,i,r){var f=null,u;i&&(u=this._keystrokesInstrumentationData[i],u&&(f=u.ImpressionGuid));Log2.LogEvent(n,r,t,null,null,f,null,null)},u.prototype.safeInstrument=function(n,t,i,r){var u=this._keystrokesInstrumentationData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},u.prototype.safeInstrumentPerf=function(n,t,i,r){var u=this._keystrokesPerfPingData[n];u?t(u):SharedLogHelper.LogError(i,(r?r+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"))},u.prototype.instrumentRenderingStarted=function(n){var t=this;this.safeInstrument(n,function(i){i.RenderingStarted=!0;t.updatePageIG(n)},"instrumentRenderingStarted")},u.prototype.instrumentBeginRequest=function(t,i,r){var u;delete this._keystrokesInstrumentationData[t-1];n.InstrumentedItem.resetKValues(t);u=this._keystrokesPerfPingData[t];u&&SharedLogHelper.LogError("instrumentBeginRequest","sequenceNumber: "+t,new Error("Duplicate BeginRequest for sequenceNumber"));var f=this._host.getConversationId(),e=this._host.getRawImpressionGuid(),o=n.cleanGuid(e),s=n.getCurrentTime()-r,h={ImpressionGuid:o,ConversationId:f,Query:i,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{},OriginalTimestamp:s},c={RawImpressionGuid:e,ImpressionGuid:o,ConversationId:f,PrefixLength:i.queryToFetch?i.queryToFetch.length:0,RequestBegin:this.getOffsetedNow(s),ResponseReceived:{},DataSourcesState:this._searchServiceStatus?{Indexer:this._searchServiceStatus}:undefined,RenderFinished:{},AllDataSourcesProcessed:!1,PendingIcons:0,TopResultRendered:[],IconsRetrieved:{},ResponseFromCache:{}};this._keystrokesInstrumentationData[t]=h;this._keystrokesPerfPingData[t]=c},u.prototype.setSearchServiceStatus=function(n){this._searchServiceStatus=n},u.prototype.instrumentResponseReceived=function(n,i,r,u,f){var e=this;this.safeInstrumentPerf(n,function(n){if(!f){var o=e.getOffsetedNow();n.ResponseReceived[i]=o;t&&e.logProfilerMarker(0,0,i,n)}r&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[i]=r);u&&(n.ResponseFromCache[i]=u)},"instrumentResponseReceived",i)},u.prototype.instrumentTopResultRendered=function(t,i){var r=this;this.safeInstrumentPerf(t,function(u){var f=r.getOffsetedNow();r.logProfilerMarker(1,0,"topResultRendered",u);u.TopResultRendered.push({V:f,T:i.join(",")});r.tryInstrumentRenderStopped(t,u);n.config.th&&n.safeFireEvent("TopResultRendered")},"instrumentTopResultRendered")},u.prototype.instrumentRenderedLocalSuggestion=function(n,t){var r=this._keystrokesInstrumentationData[n],u,f,i;if(r){for(u={},f={},i=0;i<t.length;i++)t[i].type=="FV"?u[i]="TBD":t[i].type=="HU"&&(f[i]="TBD");r.FvSug=u;r.HuSug=f}},u.prototype.instrumentAggregatorCall=function(t,i){var r=this;this.safeInstrument(t,function(t){var e={fastRankModelId:r._clientInstrumentationProvider.getRankerModelId()},f,u;for(f in t.RankerExtraInfo)e[f]=t.RankerExtraInfo[f];t.RankerExtraInfo={};u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:e};n.config.counterFactualLoggingOn&&(u.counterFactualDiff=u.counterFactualDiff||i);t.DataSources.aggregator=u},"instrumentAggregatorCall")},u.prototype.addDuplicatesDataSource=function(t){var i=Object.keys(t.DuplicateDS).map(function(n){return t.DuplicateDS[n]});i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})},u.prototype.instrumentDuplicate=function(t,i,r){this.safeInstrument(t,function(t){var u=t.DuplicateDS[i.instItem.getHValue()],f;u||(u={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:i.instItem.getKValue()}]},i.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(u.DS[0].AppNS=i.instItem.getAppNS()),t.DuplicateDS[i.instItem.getHValue()]=u);f={T:"D.DSRef",KRef:r.instItem.getKValue()};r.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=r.instItem.getAppNS());u.DS.push(f);i.duplicates=i.duplicates||[];i.duplicates.push(r)},"instrumentDuplicate")},u.prototype.renderingStopped=function(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed},u.prototype.notifyAllDataSourcesProcessed=function(n){var t=this;this.safeInstrumentPerf(n,function(i){i.AllDataSourcesProcessed=!0;t.tryInstrumentRenderStopped(n,i)},"notifyAllDataSourcesProcessed")},u.prototype.notifyIconPending=function(t,i,r,u){var f=this;this.safeInstrumentPerf(t,function(t){var e=r+(i?"T":"S");t.IconsRetrieved[e]||(t.IconsRetrieved[e]={B:f.getOffsetedNow(),E:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,T:u},t.PendingIcons++)},"notifyIconPending",i?"TR":"SUG")},u.prototype.notifyIconReady=function(n,t,i){var r=this;this.safeInstrumentPerf(n,function(n){var u=i+(t?"T":"S");n.IconsRetrieved[u]?n.IconsRetrieved[u].E=r.getOffsetedNow():SharedLogHelper.LogError("notifyIconReady",null,new Error("Instrumenting unseen icon"));n.PendingIcons--},"notifyIconReady",t?"TR":"SUG")},u.prototype.tryInstrumentRenderStopped=function(t,i){this.renderingStopped(i)&&(this.finalizeKeystrokeLog(t,2),n.config.th&&n.safeFireEvent("RenderStopped"))},u.prototype.isLayoutLogged=function(n){return this._keystrokesInstrumentationData[n].MasterPageImpressionCreated},u.prototype.finalizeKeystrokeLog=function(n,t){var i,r;t===void 0&&(t=0);i=this._keystrokesInstrumentationData[n];i&&this.logKeystrokeData(i,n);t!=1&&(r=this._keystrokesPerfPingData[n],r&&(this.logPerfPingEvent(this.createKeystrokePerfPingEvent(n,r)),delete this._keystrokesPerfPingData[n]))},u.prototype.instrumentRenderFinished=function(i,r){var u=this;this.safeInstrumentPerf(i,function(f){var e=u.getOffsetedNow();r.forEach(function(n){return f.RenderFinished[n]=e});t&&(u.logProfilerMarker(0,0,"groupsRendered",f),n.log(r.toString()));u.tryInstrumentRenderStopped(i,f)},"instrumentRenderFinished",r.join(","))},u.prototype.instrumentSyntheticInstrumentedItem=function(n,t,i){var r=this._keystrokesInstrumentationData[n];r?r.PendingInstrumentedItems[t]=i:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",t,new Error("keystrokesInstrumentationData not found"))},u.prototype.instrumentSyntheticSuggestion=function(n,t){var i=this._keystrokesInstrumentationData[n];i?i.PendingSyntheticSuggestions[t.type]=t:SharedLogHelper.LogError("instrumentSyntheticSuggestion",t.type,new Error("Instrumentation synthetic suggestion after flush"))},u.prototype.getInstrumentedSyntheticSuggestion=function(n,t){return this._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[t]},u.prototype.instrumentDataSource=function(n,t,i,r){this.safeInstrument(n,function(n){var u,f,e;if(r&&r.rankerExtraInfo)for(u in r.rankerExtraInfo)n.RankerExtraInfo[u]=r.rankerExtraInfo[u];f=i||[];e=n.PendingDataSources[t];n.PendingDataSources[t]=e?e.concat(f):f},"instrumentDataSource",t)},u.prototype.processPendingDataSources=function(t){var i,f,r,u,e,o;for(i in t.PendingDataSources)if(f=t.PendingDataSources[i],f.length>0){for(r=[],u=0,e=f;u<e.length;u++)o=e[u],r.push(this._clientInstrumentationProvider.createDataSourceObject(o));i=="Web"&&(i="WebAS");r.length>0&&(t.DataSources[i]={T:"D."+i,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:i,SC:r.length,DS:r})}t.PendingDataSources={}},u.prototype.instrumentSnRProviderFetchUrl=function(n,t){this.safeInstrument(n,function(n){n.SnRProviderFetchUrl=t},"instrumentSnRProviderFetchUrl")},u.prototype.onConversationStart=function(){this._conversationStartTimestamp=n.getCurrentTime();this._searchServiceStatus=null},u.prototype.getConversationStartTimestamp=function(){return this._conversationStartTimestamp},u.prototype.logDataSourceTimeout=function(i,r){t&&n.log("timeout");this._clientInstrumentationProvider.logDataSourceTimeout(i,r)},u.prototype.logProfilerMarker=function(i,r,u,f,e){if(t&&r!=2){var o=this.getOffsetedNow();n.log(u+" "+(o-f.RequestBegin))}this._clientInstrumentationProvider.logProfilerMarker(i,r,u,f.RawImpressionGuid,e)},u.prototype.createKeystrokePerfPingEvent=function(t,i){var u={I:t,PL:i.PrefixLength,K:i.RequestBegin,RRT:i.ResponseReceived,RFT:i.RenderFinished,TRR:i.TopResultRendered,RS:undefined,IRT:i.IconsRetrieved},r,f,e,o,s;if(this.renderingStopped(i)){for(r=0,f=0,e=u.TRR;f<e.length;f++)o=e[f],r=Math.max(r,o.V);for(s in u.RFT)r=Math.max(r,u.RFT[s]);r&&(u.RS=r)}return n.InstrumentationCommon.createPerfPingEvent(i.ImpressionGuid,[u],"Keystroke",i.ConversationId,i.DataSourcesState,i.ResponseFromCache)},u.prototype.updatePageIG=function(n){_G.IG=this.getImpressionGuid(n)},u.prototype.createMasterPageImpression=function(t,i,u,f,e){var c=this,h={dataSources:e||[],layoutNodes:[],pageName:t,rawQuery:f?f.queryToFetch:"",isQuery:!1,impressionUrl:this.createVirtualImpressionURL(i,u),appName:this._clientInstrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:r,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:u?1:0}},o=n.safeExecute(function(){return c._clientInstrumentationProvider.getEnrichedClientInfo(f)},"getEnrichedClientInfo"),s;if(o)for(s in o)h.enrichedClientInfo[s]=o[s];return h},u.prototype.logKeystrokeData=function(t){var u,f,r;(this.processPendingDataSources(t),n.config.th&&this.addDuplicatesDataSource(t),u=Object.keys(t.DataSources).map(function(n){return t.DataSources[n]}).concat(this.createNonSuggestionsDataSource(t.PendingInstrumentedItems,t.PendingSyntheticSuggestions)),t.DataSources={},t.PendingSyntheticSuggestions={},t.PendingInstrumentedItems={},u.length==0&&t.MasterPageImpressionCreated)||(t.RenderingStarted&&(f=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,t.MasterPageImpressionCreated)),t.MasterPageImpressionCreated?Log2.LogEvent("ClientInst",null,null,u,f,t.ImpressionGuid,null,null):(r=this.createMasterPageImpression(this._clientInstrumentationProvider.getSuggestionsPageName(),i,t.SnRProviderFetchUrl?t.SnRProviderFetchUrl.substring(t.SnRProviderFetchUrl.indexOf("?")+1):"",t.Query,u),f&&(r.layoutNodes=f),t.FvSug&&Object.keys(t.FvSug).length>0&&(r.enrichedClientInfo.FvSug=t.FvSug),t.HuSug&&Object.keys(t.HuSug).length>0&&(r.enrichedClientInfo.HuSug=t.HuSug),r.clientTimestamp=t.OriginalTimestamp,this.logMasterPageImpression(t.ImpressionGuid,r),t.MasterPageImpressionCreated=!0))},u.prototype.logPerfPingEvent=function(t){Log2.LogEvent(t.EventType,t.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,t.ImpressionGuid,null,null);n.config.th&&ClientTestHooks.ClientApiLogNoConsole("perfPingEvent",[t])},u.prototype.logMasterPageImpression=function(t,i){if(i){if(!t){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}i.impressionGuid=t;this._clientInstrumentationProvider.logMasterPageImpression(i,this._host.getConversationId());n.config.th&&ClientTestHooks.ClientApiLogNoConsole("masterPageImpression",i,t)}},u.prototype.instrumentInitializationFinish=function(t){var u=_G.ServerIG,i,r;if(!u){SharedLogHelper.LogError("instrumentInitializationFinish","Could not instrument as server IG not known",new Error("Could not instrument initilization finish"));return}if(i=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,r=_w.performance,r&&r.timing&&(i=r.timing.navigationStart),!(i<=0)){var f=t.getTime()-i,e=n.getCurrentTime()-i,o=[{BLT:f,ILT:e}],s=n.InstrumentationCommon.createPerfPingEvent(u,o,"Load");this.logPerfPingEvent(s)}},u.prototype.getOffsetedNow=function(t){return t===void 0&&(t=n.getCurrentTime()),t-this._conversationStartTimestamp},u.prototype.createNonSuggestionsDataSource=function(t,i){var r=[],u,f;for(u in t)r.push(this._clientInstrumentationProvider.createNonSuggestionDataSourceObject(u,t[u]));for(u in i)r.push(this._clientInstrumentationProvider.createDataSourceObject(i[u]));return r.length?(f={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:r.length,DS:r},[f]):[]},u.prototype.createVirtualImpressionURL=function(t,i){var r=n.getWindowProtocol()+"//"+n.getWindowHost()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(this._host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r},u.prototype.instrumentDebugEvent=function(t){var r=_G.ServerIG,i=n.InstrumentationCommon.createPerfPingEvent(r,undefined,"Debug");i.Data.Message=t;this.logPerfPingEvent(i)},u}();n.InstrumentationHelper=u}(AutoSuggest||(AutoSuggest={})),function(n){var t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c="&ao=",l=function(){function l(t,i,r,u){if(r===void 0&&(r=Date.now),u===void 0&&(u=n.getWindowProtocol()+"//"+n.getWindowHost()),this._host=t,this._searchPreCacheHandler=i,this.getNowTimestamp=r,this._baseUrl=u,n.config.overrideHost){var f=n.getWindowHost();f.startsWith("www.")&&(this._baseUrl=n.getWindowProtocol()+"//"+n.config.overrideHost+f.substring(3))}}return l.prototype.getSearchUrl=function(t,i,r,u,e,o,s,h,l){var p=e===13?"images":e===14?"videos":"",a,v,y;return u||(u=(p?"/"+p:"")+"/search?q="+n.encodeQueryParameter(i)),a=this._baseUrl+u,a+="&form="+n.encodeQueryParameter(o||this._host.getFormCode()),l&&(a+=c+"1"),a=this.enrichUrlWithSuggestionType(a,h?"P":r),a=this.enrichUrlWithCvid(a),n.config.suppressPqParameter||(a+="&pq="+n.encodeQueryParameter(t)),v=this._host.getMSNRefIg(),v&&(a+="&refig="+v),a=this.enrichUrlWithMarketInfo(a),a=this.enrichUrlWithDeviceInfo(a),s||(a=this.enrichUrlWithMuidInfo(a),y=this._host.getElToken(),y&&this._baseUrl.startsWith("https:")&&(a+=f+n.encodeQueryParameter(y)),a=this.enrichUrlWithSafeSearchInfo(a),this._searchPreCacheHandler&&(a=this._searchPreCacheHandler.attempPreCacheAndEnrichUrl(a))),a},l.prototype.enrichUrlWithDeviceInfo=function(n){this._host.isEducationEnvironment()&&(n+="&DAF0=1");this._host.isWindowsS()&&(n+="&DAF1=1");var t=this._host.getPartnerSearchCode();return t&&(n+="&PC="+t),n},l.prototype.enrichUrlWithMarketInfo=function(n){return n+e+this._host.getRegion()+o+this._host.getLanguage()},l.prototype.enrichUrlWithSafeSearchInfo=function(n){return this._host.getSafeSearchSetting()=="Strict"?n+"&adlt=strict":n},l.prototype.enrichUrlWithMuidInfo=function(f){var e,o,s;return _G.nclid&&(f+=t+n.encodeQueryParameter(_G.nclid),e=this.getNowTimestamp().toString(),f+=i+n.encodeQueryParameter(e),o=e.substring(0,e.length-3),f+=r+n.encodeQueryParameter(o),s=e.substring(e.length-3),f+=u+n.encodeQueryParameter(s)),f},l.prototype.enrichUrlWithCvid=function(t){return t+(s+n.encodeQueryParameter(this._host.getConversationId()))},l.prototype.enrichUrlWithSuggestionType=function(t,i){return t+(h+n.encodeQueryParameter(i))},l}();n.NavigationHelper=l}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(t,i){var r=this;this.host=t;this._selectableItemsContainer=i;t.bindKeyDown(function(t,u,f){n.isUpOrDownKey(t)&&r.selectNextItem(n.isUpKey(t));i.onAfterKeyDown(t,u,f)})}return t.prototype.selectNextItem=function(t){var r=this._selectableItemsContainer.getSelectableItems(),e;if(r.length!=0){var u=this._selectableItemsContainer.getSelectedItem(),i=u?r.indexOf(u):-1,f=t?i<=0:i==r.length-1;if(f&&n.config.allowKeyboardNavOffCanvas){this._selectableItemsContainer.select(null,!0);return}(!f||n.config.allowKeyboardNavCycling)&&(i=t?i<=0?r.length-1:i-1:(i+1)%r.length,e=r[i],this._selectableItemsContainer.select(e,!0))}},t}();n.KeyboardEvtHandler=t}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r,u){this._host=n;this._instrumentationHelper=t;this._ariaLogger=i;this._aggregator=r;this._rootViewModel=u;this._lastUsedId=-1;this._sequenceNumber=-1;this._suggestionsQueue={}}return t.prototype.initiateSequenceNumber=function(t,i){var o=this,u,f,r,s,e;if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}for(this.resetStateForNewQuery(t,i),this._highPriorityDataSources=[],this._normalPriorityDataSources=[],this._lowPriorityDataSources=[],u=0,f=n.config.enabledDataSources;u<f.length;u++)r=f[u],s=i.enabledDataSources[r],s&&(n.config.lowPriorityDataSources[r]?this._lowPriorityDataSources.push(r):n.config.highPriorityDataSources[r]?this._highPriorityDataSources.push(r):this._normalPriorityDataSources.push(r));this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0?this.processSuggestions(!1):(e=this.getLatencyTimeout(),e>0&&(this._bufferingTimer=sb_st(function(){return n.safeExecute(function(){o._bufferingTimer=null;o.processSuggestions(!0)},"processSuggestionsBuffering")},e)))},t.prototype.getLatencyTimeout=function(){return this._partialQuery.queryToFetch?n.config.latencyTimeout:n.config.latencyTimeoutForZeroInput},t.prototype.queueSuggestions=function(t,i,r,u){if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._suggestionsQueue[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error("Duplicate data source response"));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._suggestionsQueue[i]={suggestions:r,updated:!1};u&&(this._extraSignalsMap[i]=u);this._arrivedDataSources.push(i);this._allDataSourcesArrived=this._arrivedDataSources.length==this._highPriorityDataSources.length+this._normalPriorityDataSources.length+this._lowPriorityDataSources.length;this._processingStopped||this._instrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber):this.processSuggestions(!1)}},t.prototype.resetTimers=function(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null)},t.prototype.resetStateForNewQuery=function(t,i){this._arrivedDataSources=[];this._allProcessedDataSources=[];this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._extraSignalsMap={};this._renderedThisSequenceNumber=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()},t.prototype.getDependencies=function(t){var i=this;return this._host.dataSourceDependencies(t).filter(function(t){return n.isDataSourceEnabled(t,i._partialQuery)})},t.prototype.haveAllDataSources=function(n){var t=this;return n.every(function(n){return!!t._suggestionsQueue[n]})},t.prototype.processSuggestions=function(t){var i=this,u=[],s=[],r,l=this.getLatencyTimeout()>0&&this._bufferingTimer==null,a=this.haveAllDataSources(this._normalPriorityDataSources),e=this.haveAllDataSources(this._highPriorityDataSources),v=e||l,h=e&&a,c;t&&(this._instrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery),this._ariaLogger&&this._ariaLogger.logDataProviderFailure(Object.keys(this._suggestionsQueue),this._partialQuery.originalQuery));var f=t&&!this._renderedThisSequenceNumber,y=function(t,e){var o;if(!t.updated&&i.getDependencies(e).every(function(t){return n.contains(i._arrivedDataSources,t)})){if(s.push(e),i._allProcessedDataSources.push(e),t.suggestions.length>0&&(o=i.canHaveSuppressions(e)?t.suggestions.filter(function(n){return!i.isSuppressed(e,n,t.suggestions)}):t.suggestions,o.length>0)){r||(r=i._renderedThisSequenceNumber?i._rootViewModel.getSuggestions(!0):[]);var h=i.removeDuplicatesAndAssignIds(o,r,u,e),c=h[0],l=h[1];u=u.concat(c);l&&(f=!0)}t.updated=!0}},o=function(n){var u,t,r;for(u in n)t=n[u],r=i._suggestionsQueue[t],r&&y(r,t)};v&&o(this._highPriorityDataSources);this._bufferingTimer&&h&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);c=this.getLatencyTimeout()>0?this._bufferingTimer==null:e;c&&(o(this._normalPriorityDataSources),o(this._lowPriorityDataSources));this._waitingForMoreResults&&h&&(this._waitingForMoreResults=!1,(!this._renderedThisSequenceNumber||this._rootViewModel.mayNeedFlush()||(r||this._rootViewModel.getSuggestions(!0)).length==0)&&(f=!0));this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(f=!0);(u.length>0||f)&&(r||(r=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(r,u,s,f));this._allDataSourcesArrived&&this._instrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)},t.prototype.getAggregatorResult=function(t,i,r){var e=this.waitingForWebProvider(this._allProcessedDataSources),f=null,u,o;return n.config.counterFactualLoggingOn&&(f=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,e,!0)),u=this._aggregator.rank(i,r,this._extraSignalsMap,this._partialQuery,t,this._sequenceNumber,e,!1),o=n.config.counterFactualLoggingOn&&(!this.isSuggestionOrderTheSame(u.topResults,f.topResults)||!this.isSuggestionOrderTheSame(u.suggestionsToAdd,f.suggestionsToAdd)),[u,o]},t.prototype.waitingForWebProvider=function(t){var i=this;return n.isBrowserOnline()&&[n.WebDataSource].concat(this.getDependencies(n.WebDataSource)).some(function(r){return n.isDataSourceEnabled(r,i._partialQuery)&&!n.contains(t,r)})},t.prototype.isSuggestionOrderTheSame=function(n,t){var r=function(n){return n.query+"\t"+n.type},i;if(n.length!=t.length)return!1;for(i=0;i<n.length;i++)if(r(n[i])!=r(t[i]))return!1;return!0},t.prototype.addSuggestions=function(t,i,r,u){var e=this,o=this._renderedThisSequenceNumber?this._rootViewModel.getCurrentTopResults():[],v=n.safeExecute(function(){return e.getAggregatorResult(o,t,i)},"getAggregatorResults",[null,!1]),f=v[0],p=v[1],s,h,l,c,a,y;for(f||(f={topResults:o,suggestionsToAdd:i,suggestionsToRemove:[],groupOrder:[]}),this._instrumentationHelper.instrumentAggregatorCall(this._sequenceNumber,p),i=f.suggestionsToAdd,s=f.suggestionsToRemove,h=0,l=f.topResults;h<l.length;h++)c=l[h],n.contains(t,c)&&!n.contains(o,c)&&s.push(c);(u||i.length!=0||s.length!=0||!n.sequenceEqual(o,f.topResults))&&(a=!this._renderedThisSequenceNumber,a&&(this._renderedThisSequenceNumber=!0,this._instrumentationHelper.instrumentRenderingStarted(this._sequenceNumber)),y=n.safeExecute(function(){return e._rootViewModel.update(a,f.topResults,e._waitingForMoreResults,e._sequenceNumber,i,s,r,f.groupOrder,e._allDataSourcesArrived,e._extraSignalsMap)},"rootViewModel.update",0,null,function(){return e._host.reloadWebView(!0)}),y==0&&(this._processingStopped=!0,this.resetTimers()))},t.prototype.removeDuplicatesAndAssignIds=function(n,t,i,r){var f=this,h=function(n){n.id||(n.id="id_"+ ++f._lastUsedId)},s=!1,o;if(this._aggregator.canHaveDuplicates(r,this._partialQuery)){var e=[],c=function(o){var l=n[o],a=t.findIndex(function(n){return f._aggregator.isDuplicate(f._partialQuery,n,l)}),c;if(a>=0)return c=t[a],c.needsRefreshAfterDeduping&&(s=!0),u._aggregator.copyMruSignals(r,c,l),u._instrumentationHelper.instrumentDuplicate(u._sequenceNumber,c,l),"continue";if(a=i.findIndex(function(n){return f._aggregator.isDuplicate(f._partialQuery,n,l)}),a>=0)return c=i[a],c.needsRefreshAfterDeduping&&(c.needsRefreshAfterDeduping=!1),u._aggregator.copyMruSignals(r,c,l),u._instrumentationHelper.instrumentDuplicate(u._sequenceNumber,c,l),"continue";if(u._aggregator.canHaveDuplicatesWithinDataSource(r,u._partialQuery)&&(a=e.findIndex(function(n){return f._aggregator.isDuplicate(f._partialQuery,n,l)}),a>=0))return c=e[a],c.needsRefreshAfterDeduping&&(c.needsRefreshAfterDeduping=!1),u._aggregator.copyMruSignals(r,c,l),u._instrumentationHelper.instrumentDuplicate(u._sequenceNumber,e[a],l),"continue";h(l);e.push(l)},u=this;for(o=0;o<n.length;++o)c(o);return[e,s]}return n.forEach(function(n){return h(n)}),[n,s]},t.prototype.canHaveSuppressions=function(t){return n.config.suppressDataSources[t]||n.config.dataSourcesWithSuppressedTypes[t]},t.prototype.isSuppressed=function(t,i){return n.config.suppressDataSources[t]||n.config.suppressTypes[i.type]},t}();n.SuggestionsRenderingManager=t}(AutoSuggest||(AutoSuggest={})),function(n){function a(n){return n.handoffType==1?n.query:HitHighlightingParser.removeMarkers(n.text)}function f(n){var t,i;if(n.length==0)return 0;for(t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function t(n,t){var u,i,r;if(!n)return t.length;if(!t)return n.length;for(u=[],i=0;i<=t.length;i++)u[i]=[i];for(r=0;r<=n.length;r++)u[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=n.length;r++)u[i][r]=t.charAt(i-1)==n.charAt(r-1)?u[i-1][r-1]:Math.min(u[i-1][r-1]+1,Math.min(u[i][r-1]+1,u[i-1][r]+1));return u[t.length][n.length]}function v(n,i){return n&&(n=n.toLocaleLowerCase()),i&&(i=i.toLocaleLowerCase()),t(n,i)}function o(n,t,i){var r=0,u;return(t>0||i>0)&&(t>0&&i>0?(i>t&&(u=t,t=i,i=u),r=n/(t-n+i)):r=Number.MAX_VALUE),r}function y(n,t){return!n||!t?0:n.length+1<=t.length&&t[n.length]==" "?1:n.length==t.length?1:0}function p(n){var r=0,i=1,t;if(n&&n.length>1)for(t=1;t<n.length;t++)n.charAt(t)==n.charAt(t-1)?i++:i=1,i>r&&(r=i);else if(n)return 1;return r}function w(n){return n&&n.length>0?n.trim().split(" ").length:0}function b(n){var t=new RegExp("^[0-9a-zA-Z ]+$");return n&&t.test(n)?1:0}function k(n){return n&&n.length>0&&n.charAt(n.length-1)==" "?1:0}function d(n){return n&&n.length>0&&(n.includes("http://")||n.includes("https://")||n.includes("."))?1:0}function g(t,i,r,u){var o,e,s,h;t.includes("?")&&(r[117]=1,ut(t)&&(r[127]=1));t.replace("///","").replace("//","").includes("/")&&(r[118]=1);t.includes(".")&&(r[119]=1);o=u.cvid+u.privacyNumber+t;r[120]=f(o);e=t.toLocaleLowerCase();(e.startsWith("www.")||e.startsWith("http://www.")||e.startsWith("https://www."))&&(r[122]=1);e.startsWith("www.")||e.startsWith("http://")?r[123]=1:e.startsWith("https://")?r[124]=1:e.startsWith("ftp://")?r[125]=1:r[126]=1;i&&(s=n.normalizeUrl(e,15),h=n.normalizeUrl(i,15).toLocaleLowerCase(),s.startsWith(h)&&(r[187]=1))}function nt(n,i,r,u,e){if(e){r[128]=t(e,i);r[129]=e.length;var o=u.cvid+u.privacyNumber+e;r[130]=f(o)}}function tt(n,i,r){var e=n.toLocaleLowerCase(),s,u,f,h,c;if(r[140]=n.length,s=e.split(" "),r[144]=s.length,i)for(r[141]=t(n,i),r[142]=Math.min(100,o(r[141],i.length,n.length)),u=i.toLocaleLowerCase(),e.includes(u)&&(r[143]=1),e.startsWith(u)&&(r[188]=1),f=0,h=s;f<h.length;f++)if(c=h[f],c==u){r[145]=1;break}}function ut(n){var t=rt.find(function(t){return n.startsWith(t)});return n=t?n.substr(t.length):n,it.some(function(t){return n.startsWith(t)})}function ft(n){var i=0,r,t;if(n)for(r in n)t=n[r],t&&t.prefixLaunchCount&&(i+=t.prefixLaunchCount);return i}function et(t,i,r,u){if(r){var f=r[t];f&&(i[47]=f.prefixLaunchCount,i[49]=f.lastLaunchTime,i[101]=u,u>0&&(i[100]=f.prefixLaunchCount/u),f.previewPaneLaunchCount&&f.lastPreviewPaneLaunchTime&&(i[301]=f.previewPaneLaunchCount,f.lastPreviewPaneLaunchTime==f.lastLaunchTime&&(i[302]=1),i[303]=n.getCurrentTime()-f.lastPreviewPaneLaunchTime))}}function ot(n,t,i){if(i){var r=i[n];r&&(t[281]=r.probability,t[282]=r.weight)}}function st(n,t,r,u,f,e){if(t){var s=i(u,r),o=t[s];o&&(f?(n[153]=o.ProbSugClickGivenPref,n[152]=o.ClicksOnSugGivenPref):e?(n[161]=o.Loglikelihood,n[162]=o.ProbSugClickGivenBackground,n[163]=o.ClicksOnSugGivenPref,n[164]=o.ProbSugClickGivenPref,n[165]=o.CCR,n[166]=o.EventCount,n[293]=o.ProbSugClickGivenPrefTime,n[168]=o.CCRTime,n[294]=o.ProbSugClickGivenBackgroundTime,n[295]=o.LoglikelihoodTime):(n[6]=o.Loglikelihood,n[3]=o.ProbSugClickGivenBackground,n[151]=o.ClicksOnSugGivenPref,n[0]=o.ProbSugClickGivenPref,n[94]=o.CCR,n[95]=o.EventCount,n[290]=o.ProbSugClickGivenPrefTime,n[155]=o.CCRTime,n[291]=o.ProbSugClickGivenBackgroundTime,n[292]=o.LoglikelihoodTime))}}function ht(n,t,i){if(t){var r=t[i];r&&(n[256]=r.PSGPCR,n[257]=r.PSGCCR,n[258]=r.PSGSTR,n[286]=r.PSGSATCCR,n[287]=r.PSGSATPCR)}}function i(n,t){return(n+"\t"+t).toLocaleLowerCase()}function r(t,i,r){i==11..toString()&&i==0..toString();switch(n.config.athenaKeyType){case 0:return t||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),t;case 1:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),i;case 2:return r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key suggestion type is empty")),i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),r+"_"+i;default:return SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group type is not set")),""}}function u(t,i,r){switch(n.config.athenaKeyType){case 0:return i==t;case 1:return r==t;case 2:return r==t;default:return!1}}function ct(t){var i={};return t?(n.config.athenaKeyType==2?vt(t,i):(lt(t,i),at(t,i)),i):i}function lt(t,f){var y=t.Suggestions?t.Suggestions.split("\t"):[],p=t.ProbSugClickGivenPrefs?t.ProbSugClickGivenPrefs.split("\t"):[],w=t.ClicksOnSugGivenPrefs?t.ClicksOnSugGivenPrefs.split("\t"):[],b=t.ProbSugClickGivenBackground?t.ProbSugClickGivenBackground.split("\t"):[],k=t.Loglikelihoods?t.Loglikelihoods.split("\t"):[],a=t.SuggestionGroups?t.SuggestionGroups.split("\t"):[],d=t.ProbSugClickGivenPrefWeeks?t.ProbSugClickGivenPrefWeeks.split("\t"):[],v=t.ProbSugClickGivenPrefWeekends?t.ProbSugClickGivenPrefWeekends.split("\t"):[],g=t.ProbSugClickGivenBackgroundWeeks?t.ProbSugClickGivenBackgroundWeeks.split("\t"):[],it=t.ProbSugClickGivenBackgroundWeekends?t.ProbSugClickGivenBackgroundWeekends.split("\t"):[],nt=t.LoglikelihoodWeeks?t.LoglikelihoodWeeks.split("\t"):[],tt=t.LoglikelihoodWeekends?t.LoglikelihoodWeekends.split("\t"):[],c=n.config.athenaKeyType==0||!t.SuggestionHandOffTypes?[]:t.SuggestionHandOffTypes.split("\t"),s=y.length,l=e(),o;if(u(s,a.length,c.length))for(o=0;o<s;o++){var rt=a&&a.length>o?a[o]:"",ut=c&&c.length>o?c[o]:"",ft=r(rt,ut,""),h=i(y[o],ft);f[h]={SuggestionGroup:+a[o]};b.length==s&&(f[h].ProbSugClickGivenBackground=Number(b[o]));p.length==s&&(f[h].ProbSugClickGivenPref=Number(p[o]));w.length==s&&(f[h].ClicksOnSugGivenPref=Number(w[o]));k.length==s&&(f[h].Loglikelihood=Number(k[o]));n.config.athenaKeyType!=0&&c.length==s&&(f[h].SuggestionHandOffType=Number(c[o]));d.length!=s||l?v.length==s&&l&&(f[h].ProbSugClickGivenPrefTime=Number(v[o])):f[h].ProbSugClickGivenPrefTime=Number(d[o]);g.length!=s||l?v.length==s&&l&&(f[h].ProbSugClickGivenBackgroundTime=Number(it[o])):f[h].ProbSugClickGivenBackgroundTime=Number(g[o]);nt.length!=s||l?tt.length==s&&l&&(f[h].LoglikelihoodTime=Number(tt[o])):f[h].LoglikelihoodTime=Number(nt[o])}else SharedLogHelper.LogError("parseLLSignals",null,new Error("Length doesn't match"))}function at(t,f){var a=t.CCRSuggestions?t.CCRSuggestions.split("\t"):[],l=t.CCRSuggestionGroups?t.CCRSuggestionGroups.split("\t"):[],v=t.CCRs?t.CCRs.split("\t"):[],y=t.EventCounts?t.EventCounts.split("\t"):[],c=n.config.athenaKeyType==0||!t.CCRSuggestionHandOffTypes?[]:t.CCRSuggestionHandOffTypes.split("\t"),p=t.CCRsWeek?t.CCRsWeek.split("\t"):[],w=t.CCRsWeekend?t.CCRsWeekend.split("\t"):[],s=a.length,b=e(),o;if(u(s,l.length,c.length))for(o=0;o<s;o++){var k=l&&l.length>o?l[o]:"",d=c&&c.length>o?c[o]:"",g=r(k,d,""),h=i(a[o],g);f[h]||(f[h]={SuggestionGroup:Number(l[o])});v.length==s&&(f[h].CCR=Number(v[o]));y.length==s&&(f[h].EventCount=Number(y[o]));n.config.athenaKeyType!=0&&c.length==s&&(f[h].CCRSuggestionHandOffType=Number(c[o]));p.length!=s||b?w.length==s&&b&&(f[h].CCRTime=Number(w[o])):f[h].CCRTime=Number(p[o])}else SharedLogHelper.LogError("parseCCRSignals",null,new Error("Length doesn't match"))}function vt(n,t){var o=n.SugTypes?n.SugTypes.split("\t"):[],s=n.HandOffTypes?n.HandOffTypes.split("\t"):[],h=n.PSGPCRs?n.PSGPCRs.split("\t"):[],c=n.PSGCCRs?n.PSGCCRs.split("\t"):[],l=n.PSGSTRs?n.PSGSTRs.split("\t"):[],a=n.PSGSATCCRs?n.PSGSATCCRs.split("\t"):[],v=n.PSGSATPCRs?n.PSGSATPCRs.split("\t"):[],f=o.length,i;if(u(f,0,s.length))for(i=0;i<f;i++){var y=o[i],p=s[i],e=r("",p,y);t[e]={};h.length==f&&(t[e].PSGPCR=Number(h[i]));c.length==f&&(t[e].PSGCCR=Number(c[i]));l.length==f&&(t[e].PSGSTR=Number(l[i]));a.length==f&&(t[e].PSGSATCCR=Number(a[i]));v.length==f&&(t[e].PSGSATPCR=Number(v[i]))}else SharedLogHelper.LogError("parseGroupEngagementSignals",null,new Error("Length doesn't match"))}function yt(n,t){var r={},f,l,o,i;if(t){var a=0,v=0,u={};for(f=0,l=t;f<l.length;f++){var y=l[f],e=y.key,p=y.value;u[e]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};v+=s(u,e,n);o=c(p);u[e].groupClickCounts=o.groupLaunches;for(i in u[e].groupClickCounts)r[i]||(r[i]={probability:0,weight:0}),r[i].probability+=o.groupHits[i],a+=o.groupHits[i]}h(r,u,v,a)}return r}function pt(n,t){var r={},f,o,i;if(t){var l=0,a=0,u={};for(f=0,o=t;f<o.length;f++){var v=o[f],c=v.key,e=v.value;u[c]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};a+=s(u,c,n);for(i in e)e[i]&&e[i].prefixLaunchCount&&(r[i]||(r[i]={probability:0,weight:0}),u[c].groupClickCounts[i]=e[i].prefixLaunchCount,r[i].probability++,l++)}h(r,u,a,l)}return r}function s(n,t,i){var r=t.length-i.length,u=r/t.length;return n[t].lexicalSimilarity=1-u,n[t].lexicalSimilarity}function h(n,t,i,r){var o=0,s,e,f,u;for(e in t){f=t[e];f.lexicalSimilarity/=i;for(u in f.groupClickCounts)s=f.groupClickCounts[u],f.groupWeight[u]=s*f.lexicalSimilarity,o+=f.groupWeight[u]}for(u in n)n[u].probability/=r;for(e in t){f=t[e];for(u in f.groupClickCounts)n[u]||(n[u]={probability:0,weight:0}),f.groupWeight[u]/=o,n[u].weight+=f.groupWeight[u]}}function c(n){var u=function(n,t,i){return n[t]=n[t]?n[t]+i:i},r={groupLaunches:{},groupHits:{},otherGroupLaunches:0},f,t,i;for(f in n)(t=n[f],t&&t.prefixLaunchCount)&&(i=t.groupType,i||i===0?(u(r.groupLaunches,i,t.prefixLaunchCount),u(r.groupHits,i,1)):r.otherGroupLaunches+=t.prefixLaunchCount);return r}function wt(n,t,i,r){if(r){var f=i(t),u=r[f];u&&(n[266]=u.probability,n[267]=u.weight)}}function e(t){var i=t?t.getDay():n.getCurrentDate().getDay(),r=i==6||i==0;return n.config.invertIsWeekend?!r:r}function bt(n){for(var t in n)n[t]?n[t]=l(Number(n[t])):delete n[t]}function l(n){return Number(n.toFixed(5))}function kt(n,t){n.featureStore||(n.featureStore={});n.featureStore[t]=1}n.getTextForLexicalFeatures=a;n.stringHashCode=f;n.getEditDistance=t;n.getEditDistanceIgnoreCase=v;n.computeEditDistanceRatio=o;n.isWordBoundary=y;n.countMaxContiguousRepeatedChars=p;n.getNumberOfWords=w;n.containsOnlyDigitsLettersOrSpaces=b;n.endsWithSpace=k;n.prefixIsLikeUrl=d;n.computeUrlFeatures=g;n.computeDomainFeatures=nt;n.computeTitleFeatures=tt;var it=["www.bing.","cn.bing.","www.google.","www.yandex.","www.baidu.","www.yahoo.",],rt=["http://","https://",];n.getSumMruLaunches=ft;n.setMRUSignal=et;n.setMRUBackPropSignal=ot;n.setEngagementSignals=st;n.setSuggestionGroupEngagementSignals=ht;n.getEngagementSignalKey=i;n.getAthenaGroupKey=r;n.checkAthenaGroupLength=u;n.parseWebEngagementSignals=ct;n.computeGroupBackpropagatedClicks=yt;n.computeSuggestionBackpropagatedClicks=pt;n.evaluateGroupLaunches=c;n.setMRUGroupBackpropClicks=wt;n.isWeekend=e;n.removeUndefinedAndZeroAndTrimValues=bt;n.trimFeatureStoreValue=l;n.setFlagInFeatureStore=kt}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i;(function(i){i.suggestionRankingModels={};var r=function(){function r(n){this._autoComplete=n}return r.prototype.rank=function(n,i,r,u,f,e,o,s,h){var l,a,v,c;if(this.addFeatureStoreToSuggestions(n,i,r,u,f,e,o,s,h),(n.queryToFetch||t.config.rerankZeroInput)&&(l=i.filter(function(n){return n.type=="MB"}),i.sort(function(n,t){return t.rankingScore-n.rankingScore}),t.config.maxNumOfHistoryFavoriteSugToAddOffset&&t.config.historyFavoriteRankingScoreOffset&&(a=t.config.maxNumOfHistoryFavoriteSugToAddOffset,n.queryToFetch.length>=t.config.minNumOfPrefixToApplyOffset&&i.forEach(function(n){a>0&&n.handoffType==1&&n.type!="UAS"&&(n.rankingScore+=t.config.historyFavoriteRankingScoreOffset,a--)}),i.sort(function(n,t){return t.rankingScore-n.rankingScore})),l.length>1))for(v=i.map(function(n,t){return n.type=="MB"?t:undefined}).filter(function(n){return typeof n=="number"}),c=0;c<l.length;++c)i[v[c]]=l[c];return this.createRankerResponse(n,i)},r.prototype.addFeatureStoreToSuggestions=function(r,u,f,e,o,s,h,c,l){var b=this,p=n.safeExecute(function(){return b.createFeatureStore(r,u,f,e,o,s,h,c)},"createFeatureStore"),a,v,w,y;for(p=p||u.map(function(){return{}}),v=l?t.config.counterFactualRankerId:t.config.mainRankerId,v?(a=n.safeExecute(function(){return i.suggestionRankingModels[v]},"getRanker"),a||(SharedLogHelper.LogError("getRanker",v,new Error("Ranker not found")),l||Object.keys(i.suggestionRankingModels).length!=1||(a=i.suggestionRankingModels[Object.keys(i.suggestionRankingModels)[0]]))):SharedLogHelper.LogError("getRanker",v,new Error(l?"CounterFactualRankerId not defined ":"MainRankerId not defined")),w=function(t){var i=p[t];a&&(u[t].rankingScore=n.trimFeatureStoreValue(n.safeExecute(function(){return a(i)},"calculateRankingScore")));i[289]=u[t].rankingScore;u[t].featureStore=i},y=0;y<u.length;y++)w(y)},r.prototype.createRankerResponse=function(i,r){var e=[],u,f;if(i.queryToFetch&&(u=this.getTopHitCandidate(i,r),u&&n.isWebSuggestion(u)&&(u.fbcScore=u.type!="PF"?this.getFallbackClassifierScore(u):0,u=u.fbcScore>=t.config.fallbackClassifierThreshold?u:null),u&&(e.push(u),n.tryRemove(r,u),u.type=="MB")))for(f=r.length;f--;)r[f].type=="MB"&&r[f]!=u&&(e.push(r[f]),r.splice(f,1));return e},r.prototype.getFallbackClassifierScore=function(r){var u=n.safeExecute(function(){return i.suggestionRankingModels[t.config.fallbackClassifierId]},"getFallbackClassifier"),f=u?n.safeExecute(function(){return u(r.featureStore)},"calculateFallbackClassifierScore"):0;return n.trimFeatureStoreValue(f)},r.prototype.getPrefetchClassifierScore=function(r){var u=n.safeExecute(function(){return i.suggestionRankingModels[t.config.prefetchClassifierId]},"getPrefetchClassifier"),f=u?n.safeExecute(function(){return u(r.featureStore)},"calculatePrefetchClassifierScore"):0;return n.trimFeatureStoreValue(f)},r.prototype.getTopHitCandidate=function(n,i){var o=this,r=i.filter(function(n){return n.type!="ELA"}),u,f,e;if(t.config.forceTypedUrlsToTopHit)for(u=0;u<r.length;++u)if(f=r[u],f.hc&&t.considerAsTypedURL(f)){i.splice(u,1);r.unshift(f);break}return e=r.filter(function(t){return o._autoComplete.canAutoComplete(t,n)}),e[0]||r[0]},r.prototype.createFeatureStore=function(i,r,u,f,e,o,s,h){for(var l,a=this,k=n.getSumMruLaunches(f),y=n.computeGroupBackpropagatedClicks(i.queryToFetch,e),d=n.computeSuggestionBackpropagatedClicks(i.queryToFetch,e),c=i.queryToFetch,g=c.length,nt=n.countMaxContiguousRepeatedChars(c),tt=n.getNumberOfWords(c),it=n.containsOnlyDigitsLettersOrSpaces(c),rt=n.endsWithSpace(c),ut=n.prefixIsLikeUrl(c),ft=i.parsedUrl&&i.parsedUrl.type==0,p=0,w=0,v=0,b=r;v<b.length;v++)l=b[v],l.handoffType==0||l.handoffType==11?++p:l.handoffType==1&&++w;return r.map(function(r){var e={},l;return(u&&u.WebSignalsAvailable||o)&&(e[93]=1),h&&(e[149]=1),e[288]=u?u.NormalizedEntropy:t.config.prefetchClassifierId?.8:0,e[298]=u?u.Events:0,e[299]=u?u.ClickProbGivenP:0,e[300]=u?u.WebClickProbGivenP:0,e[304]=p,e[305]=w,e[306]=u?u.UrlIntentModelScore:0,e[10]=g,e[105]=nt,e[106]=tt,e[110]=it,ft&&(e[109]=1),ut&&(e[160]=1),e[114]=rt,i.isMultiWord&&(e[276]=1),a._autoComplete.canAutoComplete(r,i,e)&&(e[254]=1),l=a._autoComplete.getPrevAutoCompletedSuggestion(),l&&r.query==l.query&&(e[253]=1),t.config.forceTypedUrlsToTopHit&&r.hc&&t.considerAsTypedURL(r)&&(e[1e3]=1),n.setMRUBackPropSignal(t.getSuggestionKey(r),e,d),y&&n.setMRUGroupBackpropClicks(e,r,function(n){return n.handoffType},y),a.populateSuggestionFeatures(e,c,r,s,o,f,k),n.removeUndefinedAndZeroAndTrimValues(e),e})},r.prototype.populateSuggestionFeatures=function(i,r,u,f,e,o,s){var l,v,h,c,a,y;this.setTypeSignal(u,i);this.setLexicalFeatures(n.getTextForLexicalFeatures(u),r,i);i[255]=this.getSuggestionGroupCcr(u);i[285]=this.getSuggestionGroupPcr(u);i[156]=u.webResponsePosition||100;u.hc&&(i[189]=1);i[111]=1;u.handoffType==1&&(n.computeUrlFeatures(u.url,r,i,f),l=n.getDomain(u.url),n.computeDomainFeatures(u,r,i,f,l,e),l&&t.config.athenaKeyType==1&&(v=n.getAthenaGroupKey("",String(u.handoffType),""),n.setEngagementSignals(i,e,v,l,!0)));n.setMRUSignal(t.getSuggestionKey(u),i,o,s);u.handoffType==1||u.handoffType==2?(h=u,i[138]=h.visitCount,h.timeSinceLastAccessInDays?i[9]=h.timeSinceLastAccessInDays:i[19]=1,i[280]=h.titleMatchLength,i[279]=h.titleMatchFirstWordPos,u.title?n.computeTitleFeatures(u.title,r,i):i[139]=1,u.handoffType==1&&(c=h,c.isReadProtocol&&(i[274]=1),c.prefixStartsWithProtocol&&(i[275]=1),i[277]=c.domainMatchLength,i[278]=c.pathMatchLength)):(i[19]=1,i[139]=1);a=n.getAthenaGroupKey("",String(u.handoffType),u.type);t.config.athenaKeyType==2&&n.setSuggestionGroupEngagementSignals(i,e,a);t.config.athenaKeyType==1?(y=u.handoffType==1&&u.url?u.url:u.query,n.setEngagementSignals(i,e,a,y,!1)):n.setEngagementSignals(i,e,String(u.handoffType),u.query,!1)},r.prototype.setTypeSignal=function(n,i){n.isAnswer&&(i[116]=1);switch(n.type){case"PF":i[107]=1;break;case"PWE":i[108]=1;break;case"ML":case"MD":i[21]=1;break;case"HS":i[297]=1;break;case"HU":i[112]=1;break;case"FV":i[113]=1}t.considerAsTypedURL(n)&&(i[104]=1)},r.prototype.setLexicalFeatures=function(t,i,r){if(t){if(r[137]=t.length,r[136]=n.isWordBoundary(i,t),r[134]=n.getEditDistanceIgnoreCase(i,t),r[135]=Math.min(100,n.computeEditDistanceRatio(r[134],i.length,t.length)),i){var f=t.toLocaleLowerCase(),u=i.toLocaleLowerCase();f==u&&(r[133]=1);f.includes(u)&&(r[115]=1);r[284]=Math.abs(t.length-u.length)}}else r[132]=1,r[137]=i?i.length:0},r.prototype.getSuggestionGroupCcr=function(n){if(t.considerAsTypedURL(n))return t.config.refreshGroupCCRFeatures?.821:.898;switch(n.type){case"PF":return t.config.refreshGroupCCRFeatures?.185:.19;case"HU":return t.config.refreshGroupCCRFeatures?.44:.308;case"AS":return t.config.refreshGroupCCRFeatures?.141:.169;case"LS":return t.config.refreshGroupCCRFeatures?.109:.152;case"PWE":return t.config.refreshGroupCCRFeatures?.675:.77;case"FQ":return t.config.refreshGroupCCRFeatures?.932:.995;case"MB":return t.config.refreshGroupCCRFeatures?.519:.442;case"TK":return t.config.refreshGroupCCRFeatures?.636:.724;case"OS":return t.config.refreshGroupCCRFeatures?.109:.137;case"MD":return t.config.refreshGroupCCRFeatures?.621:.568;case"SC":return t.config.refreshGroupCCRFeatures?.282:.287;case"FV":return t.config.refreshGroupCCRFeatures?.169:.166;case"LC":return t.config.refreshGroupCCRFeatures?.044:.078;case"RI":return t.config.refreshGroupCCRFeatures?.083:.091;case"DA":return t.config.refreshGroupCCRFeatures?.55:.685;case"HS":return t.config.refreshGroupCCRFeatures?.261:.116;case"TPP":return t.config.refreshGroupCCRFeatures?.631:.612;case"SP":return t.config.refreshGroupCCRFeatures?.109:.359;case"WA":return t.config.refreshGroupCCRFeatures?.446:.398;case"FTD":return t.config.refreshGroupCCRFeatures?.035:.228;default:return t.config.refreshGroupCCRFeatures?.109:.228}},r.prototype.getSuggestionGroupPcr=function(n){if(t.considerAsTypedURL(n))return.205;switch(n.type){case"PF":return.165;case"HU":return.205;case"AS":return.076;case"LS":return.054;case"PWE":return.064;case"FQ":return.055;case"MB":return.036;case"TK":return.028;case"MD":return.022;case"SC":return.028;case"FV":return.013;case"LC":return.004;case"RI":return.002;case"DA":return.0004;case"HS":return.035;case"TPP":return.0002;case"WA":return.0002;case"FTD":return.0005;default:return 3e-5}},r}();i.FastRankRanker=r})(i=t.Ranking||(t.Ranking={}))})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function f(n,i,r,u){if(u&&n.isThirdPartySearchProvider())return"answer";switch(i){case"HS":return n.isBingThirdPartySearchProvider()?"answer":t.config.useHistoryIconForSearch&&t.config.serverIntentDetection>=2?"historySearch":"search";case"HU":case"TU":case"FQ":return"history";case"FV":return t.config.favoriteIconSupported?"favorite":"history";default:switch(r){case 1:case 8:return"directNav";case 2:return"device";case 5:case 10:return"cortana";default:return n.isBingThirdPartySearchProvider()?"answer":"search"}}}function c(n,i){switch(n){case"HS":return t.config.useHistoryIconForSearch?"&#xe81c":"&#xe721";case"HU":case"TU":case"FQ":return"&#xe81c";case"FV":return t.config.favoriteIconSupported?"&#xe734":"&#xe81c";case"PPL":return"&#xe77b";case"ME":return"&#xe8bd";case"TD":return"&#xe73a";case"FL":return"&#xe7c3";case"ST":case"LST":return"&#xe713";case"TIP":return"&#xea80"}return i==1?"&#xe774":"&#xe721"}function e(n,i,r,u){return u&&t.config.enableCortanaIcon&&!!r&&t.config.smallerAnswersType&&n!="MB"?{type:3}:{content:c(n,i),type:1}}function o(n,i,r,u){var f,e;switch(i){case 1:return n.getLocString("Website");case 15:return f=n.getLocString("ProviderShoppingSearch",t.BingSearchProvider),n.isThirdPartySearchProvider()?n.getMachineState().searchProvider:f;case 14:return f=n.getLocString("ProviderVideoSearch",t.BingSearchProvider),n.isThirdPartySearchProvider()?n.getMachineState().searchProvider:f;case 16:return f=n.getLocString("ProviderNewsSearch",t.BingSearchProvider),n.isThirdPartySearchProvider()?n.getMachineState().searchProvider:f;case 0:case 11:return f=n.getLocString("ProviderSearch",""),e=u||!n.isThirdPartySearchProvider()?t.BingSearchProvider:n.getMachineState().searchProvider,e.toLocaleLowerCase().endsWith(f.toLocaleLowerCase())?e:n.getLocString("ProviderSearch",e);case 5:case 10:return"";default:throw new Error("Unexpected handoff type: "+r);}}function l(n){if(n.handoffType!=1)return!1;switch(n.type){case"PWE":case"FQ":case"TK":return!1;default:return!0}}function u(r,u,h,c,l,a,v,y,p,w){p===void 0&&(p=null);var k=r.renderTallUx(),b=t.createSuggestion(k,p,u,c,l,o(r,h,u,!1),a,t.CssClass_Annotation,[],!0,e(w||u,h),h,f(r,w||u,h,!1),t.SyntheticQSCodesKValues[u]?n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,t.SyntheticQSCodesKValues):n.InstrumentedItem.createInstrumentedItem(v),v,y,!1);return s(b,k)&&(b.secondaryActions=[i],t.config.hideProviderText&&(b.additionalInfoText=undefined)),b.narratorText=t.getSuggestionNarratorText(b),b}function s(t,r){return r&&i&&!t.isAnswer&&n.contains([0,11],t.handoffType)}function r(i,r){var o=n.normalizeUrl(i,64),f=o,e=n.tryParseUrl(i,!0),u=0;return e&&e.path&&e.path!=="/"||(u|=16),t.config.doNotShowProtocol&&!n.startsWithProtocol(r)&&(u|=7,t.config.doNotShowWww&&!n.startsWithWww(r)&&(u|=8)),u&&(f=n.normalizeUrl(i,u)),r&&(f=HitHighlightingParser.addMarkers(f,r)),{query:o,text:f}}var i,h=function(){function h(n){this._host=n;switch(t.config.queryBuilderType){case 1:i={type:"QueryBuilder",icon:{content:"&#xe742",type:1}};break;case 2:i={type:"QueryBuilder",icon:{content:"&#xe109",type:1}}}}return h.prototype.parse=function(t,i,r,u,f,e){switch(r){case n.WebDataSource:this.parseOnlineResponse(t,u,e,i);break;case n.MRUDataSource:this.parseMRUResponse(u,e);break;default:this.parseLocalResponse(t,u,r,e,i)}},h.prototype.parseMRUResponse=function(t,i){i(n.MRUDataSource,[],t)},h.prototype.parseOnlineResponse=function(i,r,u,f){var l=this,e,h,c,o,s;r&&r.ELToken&&this._host.shouldRequestEltoken()&&this._host.setElToken(r.ELToken);e=r?r.Suggestions.map(function(n,t){return l.parseOnlineResponseSuggestion(i,f,r.Resources,n,t)}).filter(function(n){return!!n}):[];h=null;r&&r.RankingSignals&&(h=n.safeExecute(function(){return n.parseWebEngagementSignals(r.RankingSignals)},"parseWebEngagementSignals"));c=r?{engagementSignals:h,rankingSignals:r.RankingSignals}:null;o=t.config.maxWebSuggestions;o&&e&&e.length>=o&&(s=e.filter(function(n){return n.query!=i.queryToFetch||n.type=="MB"||n.htmlContent}),s&&(e=s.length>=o-1?s.slice(0,o-1):s));u(n.WebDataSource,e,c)},h.prototype.parseOnlineResponseSuggestion=function(u,h,c,l,a){var y=l.Attributes,k=y.stype,b,tt,it,et,ut,ft,st;if(!u.queryToFetch&&k!="HS")return null;var g=l.InstantAnswer,nt=g&&g.Content?g.Content.HTML:null,p=k!="THH"&&!!(nt||y.secondaryIconUrl||y.additionalInfoText),w;if(w=n.contains(["MD","ML","THH"],k)?1:n.verticalToHandoffType(y.vertical),w!==1&&t.config.suppressWebWhenPrefixStartsWithProtocol&&n.startsWithProtocol(u.queryToFetch))return null;if(w==0&&!p){if(n.queryLooksLikeUrl(y.query))return null;this._host.isThirdPartySearchProvider()&&(w=11)}b=l.SecondaryText;b&&(b=b.trim());b?(tt=b.includes(HitHighlightingParser.startMarker)?b:HitHighlightingParser.addMarkers(b,u.queryToFetch),it=t.CssClass_Title):(et=p&&this._host.isThirdPartySearchProvider(),tt=o(this._host,w,k,p),it=t.config.hideProviderText&&p?"b_hide":et?t.CssClass_AnnotationForced:t.CssClass_Annotation);var ht=p?["answer"]:[],rt=y.query||y.url,d=l.Text;w!=1||nt||d&&d.includes(HitHighlightingParser.startMarker)||(ut=r(rt,u.queryToFetch),rt=ut.query,d=ut.text);var ct=n.InstrumentedItem.createInstrumentedItem(h),lt=y.hc==="1",ot=!p&&this._host.renderTallUx(),v=t.createSuggestion(ot,null,k,rt,u.isZeroInput?HitHighlightingParser.addMarkers(d):d,tt,y.url,it,ht,lt,n.getIconFromOnlineResponse(l)||e(k,w,nt,this._host.getMachineState().cortana),w,f(this._host,k,w,p),ct,h,!1,p,nt);return v.title=b,t.config.removeSuggUrl&&v.type=="HS"?v.secondaryActions=[{type:"RemoveHistory",icon:{content:"&#xe711",type:1}}]:s(v,ot)&&(v.secondaryActions=[i]),v.highConfidenceMetaSuggestionScore=l.HighConfidenceMetaSuggestionScore,v.highConfidenceSuggestionScore=+y.hcs,v.suggestionLogMeta=y.lm,v.prefetchConfidenceScore=l.PrefetchConfidenceScore,v.webResponsePosition=a+1,v.htmlContent&&(ft=JsonInject.GetResourceKeys([g]),ft&&(v.executeScript=function(){return JsonInject.WriteAfterContentResources(JsonInject.FilterResources(c,ft))})),v.additionalInfoText=y.additionalInfoText,y.secondaryIconUrl&&(v.secondaryIcon={content:y.secondaryIconUrl,type:0}),p&&(v.text.includes(HitHighlightingParser.startMarker)||(v.text=HitHighlightingParser.addMarkers(v.text,u.queryToFetch))),v.narratorText=t.getSuggestionNarratorText(v),v.handoffType==1&&(st=v,t.computeMatchProperties(st,u)),v},h.prototype.parseLocalResponse=function(u,h,c,l,a){var k,w,st,ft,y,ht,yt,ct,tt,lt,at,ut,bt,p;if(!h){l(c,[],null);return}for(k={},k[h.types.TYPE_FAVORITE]="FV",k[h.types.TYPE_HISTORY]="HU",k[h.types.TYPE_TYPEDURL]="TU",k[h.types.TYPE_FREQUENT]="FQ",h.types.TYPE_APP&&(k[h.types.TYPE_APP]=u.isZeroInput?"FA":"PP"),h.types.TYPE_PERSON&&(k[h.types.TYPE_PERSON]="PPL"),h.types.TYPE_MESSAGE&&(k[h.types.TYPE_MESSAGE]="ME"),h.types.TYPE_TODO&&(k[h.types.TYPE_TODO]="TD"),h.types.TYPE_DOCUMENT&&(k[h.types.TYPE_DOCUMENT]="FL"),h.types.TYPE_SYSTEMSETTING&&(k[h.types.TYPE_SYSTEMSETTING]="ST"),h.types.TYPE_LAUNCHERSETTING&&(k[h.types.TYPE_LAUNCHERSETTING]="LST"),h.types.TYPE_CORTANATIP&&(k[h.types.TYPE_CORTANATIP]="TIP"),w={},w.FQ={count:0,maxSuggestions:t.config.maxFrequents,isEnabled:u.isZeroInput},w.FV={count:0,maxSuggestions:t.config.maxFavorites,isEnabled:!!u.queryToFetch},w.HU={count:0,maxSuggestions:t.config.maxHistory,isEnabled:!!u.queryToFetch},w.TU={count:0,maxSuggestions:t.config.maxTypedUrls,isEnabled:!!u.queryToFetch},w.TIP={count:0,maxSuggestions:2,isEnabled:u.isZeroInput,handoffType:5},w.FA={count:0,maxSuggestions:t.config.maxFrequents,isEnabled:u.isZeroInput,handoffType:2},w.PP={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.PPL={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.ME={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.TD={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.FL={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.ST={count:0,isEnabled:!!u.queryToFetch,handoffType:2},w.LST={count:0,isEnabled:!!u.queryToFetch,handoffType:2},st=[],ft=0;ft<h.results.length;++ft){var v=h.results[ft],b=k[v.type],nt=w[b];if(!nt.isEnabled||nt.maxSuggestions&&nt.count>=nt.maxSuggestions){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"max "+nt.maxSuggestions);continue}var g=nt.handoffType||1,vt=f(this._host,b,g,!1),d=v.url;if(!d&&vt!="cortana"){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"missing data");continue}if(y=v.title,y&&(t.config.suppressHistoryPathTitle&&d.endsWith(y)?d.length==y.length?y=null:(ht=d.charAt(d.length-y.length-1),(ht=="/"||ht=="?")&&(y=null)):y=y.trim()),yt=b=="TU"&&(!v.autoComplete||t.config.serverIntentDetection||u.topHitRestriction!=0),ct=b=="FV"||b=="HU"||yt,ct){if(n.isJunkUrl(d)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"isJunkUrl");continue}if(b!="FV"&&n.isBingSearchUrl(d)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"isBingSearchUrl");continue}if(b=="FV"&&!n.startsWithProtocol(d))if(tt=n.tryParseUrl(d,!1),tt&&tt.unparsedSegment&&(tt=null),tt&&/[./]/.test(d))tt.protocol="http://",d=n.parsedUrlToString(tt);else{t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"isNonNavigational");continue}}var pt=g==1?r(d,u.queryToFetch):null,wt=t.displayAsUrl(g,b),kt=wt?pt.text:u.isZeroInput?y:HitHighlightingParser.addMarkers(y,u.queryToFetch),it=void 0,et=void 0,rt=v.iconUri?{content:"data:image/png;base64,"+v.iconUri,type:0}:e(b,g),ot=this._host.renderTallUx();if(wt&&y?(it=HitHighlightingParser.addMarkers(y,u.queryToFetch),et=t.CssClass_Title):g==2?(b=="PPL"?(it=HitHighlightingParser.addMarkers(v.email,u.queryToFetch)||v.phone,t.getPersonIcon&&rt.type!=0&&(rt=t.getPersonIcon(y,ot))):b=="FL"?(it=v.location||t.getPathAnnotation(d),v.application&&t.ApplicationToIconMap&&(lt=t.ApplicationToIconMap[v.application],lt&&(rt={content:"data:image/png;base64,"+lt,type:0}))):b=="TD"?(at=v.alarmDate,at&&(ut=at.split(",").map(Number),bt=new Date(ut[0],ut[1],ut[2],ut[3],ut[4]),it=bt.toLocaleString(this._host.getLanguage(),{weekday:"short",day:"numeric",month:"short",hour:"numeric",minute:"numeric"}))):b=="ME"&&(it=HitHighlightingParser.addMarkers(v.content,u.queryToFetch),t.getPersonIcon&&rt.type!=0&&(rt=t.getPersonIcon(y,ot))),et=t.CssClass_Annotation):(it=o(this._host,g,b,!1),et=t.CssClass_Annotation),p=t.createSuggestion(ot,null,b,g==2||g==5?y:pt.query,kt,it,d,et,[],v.autoComplete,rt,g,vt,n.InstrumentedItem.createInstrumentedItem(a),a,!0,!1),!p.query||!p.text){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"missing data");continue}if(s(p,ot)?p.secondaryActions=[i]:(v.phone&&(p.secondaryActions=[{type:"PhoneCall",icon:{content:"&#xe717",type:1},url:"tel:"+v.phone},{type:"SendMessage",icon:{content:"&#xe8bd",type:1},url:"sms:"+v.phone}]),v.email&&(p.secondaryActions=p.secondaryActions||[],p.secondaryActions.push({type:"SendEmail",icon:{content:"&#xe715",type:1},url:"mailto:"+v.email}))),p.title=y,p.timeSinceLastAccessInDays=n.getTimeDiffInDays(t.parseServiceUiDate(v.lastAccessed)),p.visitCount=v.visitCount,p.narratorText=t.getSuggestionNarratorText(p),t.computeMatchProperties(p,u),ct&&!t.isRelevantUrlSuggestionForThisQuery(u,p)){t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v,"suppressUrl");continue}t.localSuggestionsTrace&&t.localSuggestionsTrace(this._host,v);++nt.count;st.push(p)}l(c,st,null)},h.createAutocompletedSuggestion=function(i,r,u){var f=Object.assign({},r),o=f.text?HitHighlightingParser.removeMarkers(f.text):f.query,e;return f.text=HitHighlightingParser.addMarkers(o,i.queryToFetch),f.secondaryText&&t.secondaryTextIsTitle(f)&&(e=HitHighlightingParser.removeMarkers(f.secondaryText),f.secondaryText=HitHighlightingParser.addMarkers(e,i.queryToFetch)),f.hc=!0,f.instItem=t.SyntheticQSCodesKValues[f.type]?n.InstrumentedItem.getNonSuggestionInstrumentedItem(f.type,t.SyntheticQSCodesKValues):n.InstrumentedItem.createInstrumentedItem(u),f.sequenceNumber=u,f.narratorText=t.getSuggestionNarratorText(f),f.autoCompleteType=3,f},h.createWebsiteTokenizedSuggestion=function(t,i,f,e){var c,v,h;if(!l(f))return null;var a=["/","?","#"],w=function(n,t,i){var r=t.map(function(t){return n.indexOf(t,i)}).filter(function(n){return n>=0});return r.length<=0?-1:r.reduce(function(n,t){return Math.min(n,t)},Infinity)},o=f.url.toLocaleLowerCase();if(!o.startsWith("http")||(c=n.normalizeUrl(i.fixedUrl,15),!c||a.some(function(n){return c.includes(n)}))||(v=o.indexOf(n.normalizeUrl(o,31)),h=w(o,a,v),h<=0||h==o.length-1))return null;var y=f.url.substring(0,h)+"/",p=r(y,i.queryToFetch),s=u(t,"TK",1,p.query,p.text,y,e,f.mayContainPII,f.id+"_t","HU");return f.type=="MD"&&(s.icon=f.icon,s.intent=f.intent,s.secondaryText=f.secondaryText,s.secondaryTextClass=f.secondaryTextClass),s},h.createPartialQuery=function(t,i,r){var f=u(t,"PF",t.isThirdPartySearchProvider()?11:0,i.queryToFetch,HitHighlightingParser.addMarkers(i.queryToFetch),"/search?q="+n.encodeQueryParameter(i.queryToFetch),r,!1,"tpq");return f.notAResult=!0,f},h.createPartialWebsite=function(n,t,i){var f=r(t.fixedUrl,t.queryToFetch),e=u(n,"PWE",1,f.query,f.text,t.fixedUrl,i,!1,"tpw");return e.notAResult=!0,e},h.createSyntheticQuery=function(n,t,i,r,f,e){var o=u(n,i,n.isThirdPartySearchProvider()?11:r,f,f,e,t,!1,i.toLocaleLowerCase());return o.notAResult=!0,o},h.parseClientAutoComplete=function(n,t,i,f){var e=r(t,i),o=u(n,"TU",1,e.query,e.text,t,f,!0);return o.autoCompleteType=4,o},h}();t.SuggestionsParser=h;t.getIntent=f;t.getSuggestionIcon=e;t.getDisplayUrl=r})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n,i,r){var u=this;this._host=n;this._navigationHelper=i;t.config.serverIntentDetection&&n.bindClientAutoComplete(function(n,t,i){return u.onClientAutoComplete(n,t,i,r.getSequenceNumber())});n.bindQueryChangedOrInitialized(function(n){u._previousAutoCompleteState=u._autoCompleteState;!n.queryToFetch&&u._autoCompleteState&&u.clearAutoComplete()})}return i.prototype.getAutocompletedSuggestion=function(n){return this._autoCompleteState&&(!n||this._autoCompleteState.forCurrentQuery)?this._autoCompleteState.suggestion:null},i.prototype.getPrevAutoCompletedSuggestion=function(){return this._previousAutoCompleteState?this._previousAutoCompleteState.suggestion:null},i.prototype.getAutocompletedQuery=function(){return this._autoCompleteState?this._autoCompleteState.prefix:null},i.prototype.isForcedAutoComplete=function(){return this._autoCompleteState?this._autoCompleteState.forCurrentQuery:!1},i.prototype.isConsideredValidAutoComplete=function(n,t,i){var r=this.checkIfIsValidAutoCompleteByClient(n,t.originalQuery);return r?!i||!r.isExactMatch:!1},i.prototype.canAutoComplete=function(t,i,r){var f,u,o;if(!i.originalQuery||!this.isConsideredValidAutoComplete(t,i,!1))return r&&i.originalQuery&&(r[1005]=1),!1;if(t.handoffType==1)return!0;if(i.intent==0)return r&&(r[1006]=1),!1;if(f=t.query.toLocaleLowerCase(),u=i.originalQuery.toLocaleLowerCase(),n.isNonHttpProtocol(f))return o=n.isNonHttpProtocol(u)&&!i.hasRegisteredProtocol,r&&!o&&(r[1007]=1),o;var s=f.indexOf(u),h=f.substring(s),e=n.tryParseUrl(h,!1);return!e||e.type!=0?!0:(r&&u.length<=e.length&&(r[1008]=1),u.length>e.length)},i.prototype.onQueryChanged=function(n,i){if(n.originalQuery&&(this.evaluatePreviousAutocompletion(n,i),!this.isForcedAutoComplete())){var u=!1,r;this._autoCompleteState?(r=this._autoCompleteState.suggestion,u=t.config.serverIntentDetection>=2):r=n.intent==0?t.SuggestionsParser.createPartialWebsite(this._host,n,i):t.SuggestionsParser.createPartialQuery(this._host,n,i);this.setAddressBarContentWithBuildUrl(n,r,!1,u,!1)}},i.prototype.evaluatePreviousAutocompletion=function(n,i){var r,u,f;if(this._autoCompleteState){if(r=!this._autoCompleteState.prefix,!r&&n.originalQuery.length<=this._autoCompleteState.prefix.length&&!this._autoCompleteState.prefix.toLocaleLowerCase().startsWith(n.originalQuery.toLocaleLowerCase())){this.clearAutoComplete();return}if(n.topHitRestriction!=0&&!r){this.clearAutoComplete();return}if(u=this.checkIfIsValidAutoCompleteByClient(this._autoCompleteState.suggestion,n.originalQuery),!u){this.clearAutoComplete();return}r?this.storeAutoComplete(n.originalQuery,this._autoCompleteState.suggestion,u.isExactMatch):(f=this.getAutocompletedSuggestion(!1),this._autoCompleteState.suggestion=t.SuggestionsParser.createAutocompletedSuggestion(n,f,i),this._autoCompleteState.isExactMatch=u.isExactMatch,t.config.serverIntentDetection&&(this._autoCompleteState.forCurrentQuery=!1));this._autoCompleteState.suggestion.selected=!1}},i.prototype.setAddressBarContent=function(n,t,i,r){var u,f,e;n&&t&&(u=t,f=!1,i||r||(e=this.checkIfIsValidAutoCompleteByClient(u,n.originalQuery),f=!!e&&!e.isExactMatch),f?(this.storeAutoComplete(n.originalQuery,u,!1),u.autoCompleteType||(u.autoCompleteType=1)):this.clearAutoComplete(),this.setAddressBarContentWithBuildUrl(n,u,i,f,r))},i.prototype.onClientAutoComplete=function(n,i,r,u){var f=t.SuggestionsParser.parseClientAutoComplete(this._host,i,n,u);this.storeAutoComplete(r?null:n,f,!1);this._host.setAddressBarContentAction(f.query,f.intent,f.url,!1,!0,!1,!1)},i.prototype.setAddressBarContentWithBuildUrl=function(n,t,i,r,u){var f=!u&&t.handoffType==0&&this._host.verifyPrefetchSupported()&&!this._host.isInPrivate()&&!this._host.isThirdPartySearchProvider()&&this._host.getPageType()!="AB"&&(t.isAbovePrefetchThreshold||this._host.isPrefetchCurrentlyLoaded()),e;f&&(e=this.buildNavigateUrl(n,t,r,!0));f&&this._host.verifyPrefetchSupported(e)||(f=!1,e=this.buildNavigateUrl(n,t,r,!1));t.prefetchRequested=f;this._host.setAddressBarContentAction(t.query,t.intent,e,i,r,f,!1)},i.prototype.buildNavigateUrl=function(n,i,r,u){var e,s,h;switch(i.handoffType){case 1:case 8:case 2:return i.url;case 11:case 5:case 10:return""}e=null;t.config.bawPeopleEnabled&&t.config.bfbfrmcde&&i.type&&i.type=="BFBPPL"&&(e=t.config.bfbfrmcde);var o=this._navigationHelper.getSearchUrl(n.queryToFetch,i.query,i.type,i.url,null,e,!1,u),f=this._host.getMachineState(),c=f.partnerSearchCode;return c&&(i.intent=="answer"||f.formFactor=="Mobile")&&(o+="&PC="+encodeURIComponent(c)),t.config.sendPreloadExperiment&&f.experiments&&f.experiments.features&&(s=f.experiments.features.find(function(n){return n.id==14876518}),h=0,s&&(h=s.variant),o+="&plvar="+h),o},i.prototype.clearAutoComplete=function(){this._autoCompleteState=null},i.prototype.storeAutoComplete=function(n,t,i){this._autoCompleteState={suggestion:t,prefix:n,forCurrentQuery:!0,isExactMatch:i}},i.prototype.isCompatibleProtocolForAutocompletion=function(n,t){switch(n){case 1:return t==1;case 2:return t==2;case 3:return t!=0;case 0:return!0}},i.prototype._canAutocomplete=function(n,t){return n&&t&&n.startsWith(t)?{isExactMatch:n.length==t.length}:null},i.prototype.checkIfIsValidAutoCompleteByClient=function(i,r){var u,o,e,a,s,h,f,c,l,v;return i.type=="PF"?null:(u=i.query,i.handoffType!=1)?(o=u.toLocaleLowerCase(),e=r.toLocaleLowerCase(),e&&o==e.trim())?{isExactMatch:u.length==r.length}:this._canAutocomplete(o,e):(!t.config.serverIntentDetection||t.config.serverIntentDetection<2)&&(a=n.normalizeUrl(r,15),!a)?null:(s=n.getProtocol(r),h=n.getProtocol(u),/^\/{2,}$/.test(r)&&h!=0)?{isExactMatch:!1}:this.isCompatibleProtocolForAutocompletion(s,h)?t.config.serverIntentDetection>=2&&(f=this._canAutocomplete(u,r),f)?f:(c=t.config.serverIntentDetection>=2?39:35,u=n.normalizeUrl(u,c),r=n.normalizeUrl(r,c),t.config.serverIntentDetection>=2&&(f=this._canAutocomplete(u,r),f))?f:(l=n.hasWww(r),v=n.hasWww(u),v?l?this._canAutocomplete(u,r):s!=0?null:(u=n.normalizeUrl(u,8),t.config.serverIntentDetection>=2&&(f=this._canAutocomplete("."+u,r),f))?f:this._canAutocomplete(u,r):l?null:this._canAutocomplete(u,r)):null},i}();t.OneBoxAutoComplete=i})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function i(n){return n.type=="PF"||n.type=="PWE"}function r(n,t){return n.query.toLocaleLowerCase()==t.queryToFetch.toLocaleLowerCase()}var u=function(){function u(n,t,i,r){this._host=n;this._instrumentationHelper=t;this._autoComplete=i;this._ranker=r}return u.prototype.getOrCreatePartialWebsite=function(n,i){return this._instrumentationHelper.getInstrumentedSyntheticSuggestion(i,"PWE")||t.SuggestionsParser.createPartialWebsite(this._host,n,i)},u.prototype.getOrCreatePartialQuery=function(n,i){return this._instrumentationHelper.getInstrumentedSyntheticSuggestion(i,"PF")||t.SuggestionsParser.createPartialQuery(this._host,n,i)},u.prototype.createSyntheticSuggestions=function(n,t){var r=[],u,i;return n.queryToFetch&&(n.intent==0&&(i=this.getOrCreatePartialWebsite(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,i),r.push(i)),u=this.getOrCreatePartialQuery(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,u),r.push(u),n.intent==2&&(i=this.getOrCreatePartialWebsite(n,t),this._instrumentationHelper.instrumentSyntheticSuggestion(t,i),r.push(i))),r},u.prototype.canHaveDuplicates=function(t){switch(t){case n.WebDataSource:case"Local":case"TypedUrls":case"BAW":case"UAS":return!0;case n.MRUDataSource:case"SSUE":return!1}throw new Error("New data source "+t+" needs to be explicity classified as needed deduping with other data sources or not");},u.prototype.canHaveDuplicatesWithinDataSource=function(n,t){return n=="Local"&&!t.isZeroInput},u.prototype.isDuplicate=function(t,i,r){return i.handoffType!=r.handoffType?!1:i.isAnswer!=r.isAnswer?!1:n.isDuplicateUrl(t,i.url,r.url)?(i.handoffType==1&&this.updateUrlSuggestionMetaData(i,r),!0):!1},u.prototype.isDuplicateOfEntity=function(n,t){return t.type=="MB"&&!n.isAnswer&&n.handoffType==t.handoffType&&n.query.toLocaleLowerCase()==t.query.toLocaleLowerCase()},u.prototype.updateUrlSuggestionMetaData=function(n,i){t.secondaryTextIsTitle(n)||(n.title=i.title,n.secondaryText=i.secondaryText,n.secondaryTextClass=i.secondaryTextClass,n.narratorText=t.getSuggestionNarratorText(n),n.intent=i.intent,n.needsRefreshAfterDeduping=!0);i.visitCount&&(n.visitCount=(n.visitCount||0)+i.visitCount);i.timeSinceLastAccessInDays&&(!n.timeSinceLastAccessInDays||n.timeSinceLastAccessInDays>i.timeSinceLastAccessInDays)&&(n.timeSinceLastAccessInDays=i.timeSinceLastAccessInDays);i.type=="TU"&&i.hc&&(n.hc=i.hc)},u.prototype.copyMruSignals=function(){},u.prototype.rank=function(u,f,e,o,s,h,c,l){var v=this,ii=!o.queryToFetch,nt=e[n.WebDataSource],k=null,y,d,g,a,pt,wt,ft,tt,et,bt,kt,it,ri,ui,p,fi,ei,b,ni,ot,rt,st,ti;nt&&nt.rankingSignals&&(k=nt.rankingSignals);k&&(k.WebSignalsAvailable=!0);var ht={cvid:this._host.getConversationId(),privacyNumber:this._host.getPrivacyNumber()},ct=nt?nt.engagementSignals:null,ut=e[n.MRUDataSource],lt=ut?ut.SuggestionEngagementData:null,at=ut?ut.LookupCompletions:null,vt=this._host.getMachineState(),yt=vt.domainJoined,w=this.createSyntheticSuggestions(o,h);for(t.config.rerankPartialQuery||this._ranker.addFeatureStoreToSuggestions(o,w,k,lt,at,ct,ht,yt,l),t.config.requirePreciseLocalTriggering&&!this._host.isClientLocationAvailable()&&(f=f.filter(function(n){return n.type!="ELA"})),y=f.concat(u.filter(function(n){return!i(n)})),t.config.rerankPartialQuery&&(y=y.concat(w)),d=this.separateRankableSuggestions(y),y=d.rankableSuggestions,g=[],g=g.concat(d.nonRankableWebSuggestions).concat(d.nonRankableUrlSuggestions),a=this._ranker.rank(o,y,k,lt,at,ct,ht,yt,l),this._ranker.addFeatureStoreToSuggestions(o,g,k,lt,at,ct,ht,yt,l),g.forEach(function(t){return n.setFlagInFeatureStore(t,1012)}),t.allSuggestionsTrace&&(t.allSuggestionsTraceReset(this._host),w.forEach(function(n){return t.allSuggestionsTrace(v._host,n,"Synthetic")}),a.forEach(function(n){n.duplicates&&n.duplicates.forEach(function(n){return t.allSuggestionsTrace(v._host,n,"DupTopResults")});t.allSuggestionsTrace(v._host,n,"TopResults")}),y.forEach(function(n){return t.allSuggestionsTrace(v._host,n,"AllOtherResults")}),g.forEach(function(n){return t.allSuggestionsTrace(v._host,n,"NonRankable")})),t.config.enableRankerScoreSuppression&&!ii&&(k||t.config.enableSuppressionsWithoutWeb)&&(pt=function(i){return i.handoffType==1&&i.type!="PWE"&&i.rankingScore<t.config.rankerScoreSuppressionThreshold&&!n.contains(u,i)},a=a.filter(function(n){return!pt(n)}),y=y.filter(function(n){return!pt(n)})),s.length>0&&a.length>0&&this.isDuplicateOfEntity(s[0],a[0])&&(s=s.slice(1)),a.length!=0&&this.allowOnTopHit(o,a[0])?t.config.rerankPartialQuery?(wt=w.find(function(n){return n.type=="PF"}),(a.some(function(n){return v.isDuplicate(o,n,wt)})||f.some(function(n){return v.isDuplicate(o,n,wt)}))&&n.removeFirstWhere(y,function(n){return n.type=="PF"}),o.intent==2&&a[0].handoffType==1&&n.removeFirstWhere(y,function(n){return n.type=="PWE"})):(ft=w.filter(function(n){return!a.some(function(t){return v.isDuplicate(o,t,n)})&&!f.some(function(t){return v.isDuplicate(o,t,n)})}),o.intent==2&&a[0].handoffType==1&&(ft=ft.filter(function(n){return n.type!="PWE"})),a=a.concat(ft)):(a=w.slice(0,1).concat(a.filter(function(n){return!w.some(function(t){return v.isDuplicate(o,n,t)})})),!t.config.rerankPartialQuery&&w.length>1&&(a=a.concat(w.slice(1)))),tt=this.getAutocompletedSuggestion(a[0],o),tt&&(a=a.filter(function(n){return!v.isDuplicate(o,n,tt)}),a.unshift(tt),n.setFlagInFeatureStore(a[0],1004),this._instrumentationHelper.instrumentSyntheticSuggestion(h,tt)),this.tokenizeTopResult(o,a,h),et=0,bt=a;et<bt.length;et++)kt=bt[et],i(kt)||(kt.pinned=!0);if(it=[],this._urlIntent=2,it=this.insertNotRankedSuggestions(y,d.nonRankableWebSuggestions,a),t.config.enableUrlTrieSuggestion&&d.nonRankableUrlSuggestions.length>0&&(ri=this.getFilteredNotRankedURLSuggestions(o,d.nonRankableUrlSuggestions,a),it=this.insertNotRankedUrlSuggestions(it,ri)),ui=u.filter(function(t){return!n.contains(s,t)}),p=it.filter(function(t){return v.allowedInGroups(t)&&!n.contains(ui,t)&&!a.some(function(n){return v.isDuplicate(o,n,t)})}),t.config.bawInGroup&&(fi=a.filter(this.isBawSuggestion),p=fi.concat(p)),ii)n.trimList(p,t.config.maxSuggestionsForZeroInput-u.length,function(){return!0});else{if(a=a.concat(p),p=p.filter(function(n){return v.alwaysDisplayInGroup(n)}),p.length&&(a=a.filter(function(t){return!n.contains(p,t)})),t.config.enableUrlTrieSuggestion&&this._urlIntent!=2){ei=function(n,t){return n.type=="UAS"&&(t.type=="MD"||t.type=="TU"||t.type=="FV"||t.type=="HU")?n.text.toLocaleLowerCase()==t.text.toLocaleLowerCase()||n.url.toLocaleLowerCase()==t.url.toLocaleLowerCase():!1};a=a.filter(function(n){return!a.some(function(t){return ei(n,t)})});var dt=[],oi=a.filter(function(n){return n.type!="UAS"}).length,si=this._urlIntent==0?t.config.highUrlIntentNumUrlSuggestions:t.config.defaultNumUrlTrieSuggestions,hi=si>t.config.maxSuggestions-oi?si:t.config.maxSuggestions-oi;for(b=0;b<a.length;b++)a[b].type!="UAS"?dt.push(a[b]):(a[b].type=="PF"||b<t.config.maxSuggestions&&a[b].handoffType!=0)&&hi>0&&(dt.push(a[b]),hi--);a=dt}var ci=t.config.minUrls||0,yi=ci?a.filter(function(n){return n.handoffType==1&&n.type!="PWE"}).length+s.filter(function(t){return t.handoffType==1&&t.type!="PWE"&&!n.contains(a,t)}).length:999,pi=yi-ci,li=0,ai=0,vi=0,gt=0;n.trimList(a,t.config.maxSuggestions,function(u){var f=u.type!="THH"&&!i(u)&&!r(u,o)&&(!n.contains(s,u)||t.config.enableUrlTrieSuggestion&&v._urlIntent!=2&&n.contains(s,u)&&u.handoffType==0);return f||u.type!="BFBPPL"||gt++,t.config.bfbpplexpl&&f&&u.type=="BFBPPL"&&gt<t.config.bfbexplcnt&&(f=!1,gt++),(u.handoffType==1||u.handoffType==2)&&(f?pi-->0?++ai:(++li,f=!1):++vi),f});t.localSuggestionsTraceRaw&&t.localSuggestionsTraceRaw(this._host,"('"+o.queryToFetch+"', minURLs="+t.config.minUrls+") - URL kept= "+li+", removed = "+ai+", forced = "+vi)}if(this._host.isThirdPartySearchProvider()||(ni=function(n,i){return n.isAnswer&&!i.isAnswer&&(n.query.toLocaleLowerCase()==i.query.toLocaleLowerCase()||t.config.noSecondaryIcon&&n.text.toLocaleLowerCase()==i.text.toLocaleLowerCase())?!!n.htmlContent||t.config.dedupEntitiesWithPartialQuery&&n.type=="MB"&&(t.config.noSecondaryIcon?n.text.toLocaleLowerCase()==i.text.toLocaleLowerCase():!0):!1},ot=a.filter(function(n){return!a.some(function(t){return ni(t,n)})}),a.length!=ot.length&&(a=this.allowOnTopHit(o,ot[0])?ot:a.filter(function(n){return!a.some(function(t){return ni(n,t)})}))),t.config.promoPosition!=0&&(rt=a.filter(function(n){return n.type=="THH"})[0],rt)){a=a.filter(function(n){return n.type!="THH"});switch(t.config.promoPosition){case 1:a.unshift(rt);break;case 2:a.splice(1,0,rt);break;case 3:a.push(rt)}}if(t.config.bawPosition!=0&&(st=a.filter(this.isBawSuggestion),st&&st.length>0)){a=a.filter(function(n){return!v.isBawSuggestion(n)});switch(t.config.bawPosition){case 2:a=a.concat(st)}}return this.setPrefetchSignal(a,o),ti=o.queryToFetch?[]:[t.GroupType.FrequentSites,t.GroupType.SearchHistory],vt.groupOrder&&(ti=vt.groupOrder.split(",").map(function(n){return t.GroupType[n]}).filter(function(n){return!!n})),a=t.normalizeSuggestions(a),{topResults:a,suggestionsToAdd:p,suggestionsToRemove:[],groupOrder:ti}},u.prototype.alwaysDisplayInGroup=function(n){return n.handoffType==2||n.handoffType==8||t.config.bawInGroup&&this.isBawSuggestion(n)},u.prototype.allowOnTopHit=function(i,r){return t.config.alwaysTopHitAnswersInThirdPartySearchProviders&&r.isAnswer&&this._host.isThirdPartySearchProvider()?!0:i.topHitRestriction==1&&r.query.toLocaleLowerCase()!=i.queryToFetch.toLocaleLowerCase()?(n.setFlagInFeatureStore(r,1009),!1):this._autoComplete.canAutoComplete(r,i)},u.prototype.allowedInGroups=function(n){return!this._host.isThirdPartySearchProvider()&&(t.config.allowAnswersOutsideTopHit||t.config.allowEntitiesOutsideTopHit&&n.type=="MB"||t.config.bawInGroup&&this.isBawSuggestion(n))?!0:!n.isAnswer||n.type=="ELA"},u.prototype.separateRankableSuggestions=function(n){for(var i,r=[],u=[],e=[],o=!0,f=0,s=n;f<s.length;f++)i=s[f],this.shouldNotBeRanked(i)?t.config.nextWordEnabled&&t.isNextWord(i)?u.push(i):i.type=="UAS"?e.push(i):o||n[0].type=="MB"&&i.type=="MB"?(r.push(i),o=!1):u.push(i):r.push(i);return{rankableSuggestions:r,nonRankableWebSuggestions:u,nonRankableUrlSuggestions:e}},u.prototype.insertNotRankedSuggestions=function(n,i,r){var h=this,u;if(n.length==0)return i;if(i.length==0)return n;if(t.config.breakFirstWebSuggestion){if(i.length>0){var f=0,e=0,o=!1,s=!1;for(u=0;u<n.length;u++)!o&&this.shouldNotBeRanked(n[u])?(f=u,o=!0):!s&&n[u].handoffType==1&&n[u].rankingScore<i[0].rankingScore&&(e=u,s=!0);if(f<e)return n.slice(0,e).concat(i).concat(n.slice(e));if(f>e)return n.slice(0,f+1).concat(i).concat(n.slice(f+1))}}else{if(r.some(function(n){return h.shouldNotBeRanked(n)}))return i.concat(n);for(u=0;u<n.length;u++)if(this.shouldNotBeRanked(n[u]))return n.slice(0,u+1).concat(i).concat(n.slice(u+1))}return n.concat(i)},u.prototype.insertNotRankedUrlSuggestions=function(n,t){var i,r;if(n.length==0)return t;if(t.length==0)return n;for(i=0,r=0;r<n.length;r++)if(i==0&&this.shouldNotBeRanked(n[r])&&t[0].rankingScore>=n[r].rankingScore){i=r;break}return i==0?t.concat(n):i>0?n.slice(0,i).concat(t).concat(n.slice(i)):n.concat(t)},u.prototype.getFilteredNotRankedURLSuggestions=function(i,r,u){var f,e;return t.config.filterUrlInProvider||i.queryToFetch.endsWith(".")||i.intent==0||t.hasWWW(i)||t.hasProtocols(i)?(this._urlIntent=0,r):(f=this._autoComplete.getAutocompletedSuggestion(!1),f&&f.handoffType==1&&i.intent!=0)?(e=n.tryParseUrl(f.url,!0),e&&e.hostname)?(this._urlIntent=i.queryToFetch.includes(".")?0:1,r.filter(function(n){return n.domain==e.hostname})):(this._urlIntent=1,r):u.some(function(n){return n.handoffType==1&&n.type!="PWE"})?(this._urlIntent=1,r):[]},u.prototype.isBawSuggestion=function(n){return n.handoffType==1&&n.type=="BFBBKS"},u.prototype.shouldNotBeRanked=function(n){return(n.handoffType==0||n.handoffType==11||t.config.bawRankOff&&this.isBawSuggestion(n)||n.type=="UAS")&&n.type!="PF"},u.prototype.setPrefetchSignal=function(n,i){var r=n.length>0&&n[0].handoffType==0?n[0]:null,u=t.config.prefetchSerpThreshold;t.config.prefetchClassifierId&&u&&r&&i.queryToFetch&&i.queryToFetch.length>=t.config.prefetchSerpMinPrfxLenThreshold&&(r.prefetchScore=this._ranker.getPrefetchClassifierScore(r),r.prefetchScore>u&&(r.isAbovePrefetchThreshold=!0))},u.prototype.getAutocompletedSuggestion=function(n,t){var i=this._autoComplete.getAutocompletedSuggestion(!0);return(i||n&&n.type!="PF"&&this._autoComplete.isConsideredValidAutoComplete(n,t,!0)||(i=this._autoComplete.getAutocompletedSuggestion(!1)),!i||!n||n.type=="PF")?i:i.query.length==t.originalQuery.length&&this._autoComplete.isConsideredValidAutoComplete(n,t,!1)?null:n.url==i.url?null:i},u.prototype.tokenizeTopResult=function(i,r,u){var e=r[0],f;e&&e.type!="UAS"&&(t.config.serverIntentDetection||!t.considerAsTypedURL(e))&&(this._autoComplete.isForcedAutoComplete()||(f=t.SuggestionsParser.createWebsiteTokenizedSuggestion(this._host,i,r[0],u),f&&(e.type=="MD"?r[0]=f:r.unshift(f),n.removeFirstWhere(r,function(t){return t.type!="TK"&&n.isDuplicateUrl(i,t.url,f.url)}),this._instrumentationHelper.instrumentSyntheticSuggestion(u,f))))},u}();t.Aggregator=u})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=function(){function t(n,t,i,r){var u=this;this._instrumentationHelper=t;this._sequenceNumberReader=i;this._page=r;this._itemLaunchEventHandlers=[];this.groups=[];this.topResults=[];this._lastUpdatedSequenceNumber=-1;this._topResultsRenderingDisabled=!1;this._groupRenderingDisabled=!1;n.bindDismissed(function(){u.topResults=[];u.renderTopResults();u.groups=[];u.renderGroups();u._partialQuery=null;u._lastUpdatedSequenceNumber=-1});n.bindShown(function(){u._selectedItem=null})}return t.prototype.bindItemLaunch=function(n){this._itemLaunchEventHandlers.push(n)},t.prototype.onSuggestionLaunch=function(n,t,i){this._itemLaunchEventHandlers.forEach(function(r){return r(n,t,i)})},t.prototype.onQueryChanged=function(n){this._partialQuery=n},t.prototype.getCurrentTopResults=function(){return this.topResults.slice(0)},t.prototype.getTopResultsWhichFitInCanvas=function(n){return n},t.prototype.resetAriaSelected=function(n){n&&this._page.render(function(){var t=_ge(n.id);t&&(t.setAttribute("aria-selected","false"),t.setAttribute("aria-selected","true"))})},t.prototype.updateTopResults=function(t,i,r,u,f,e){var s=this,a,o,h,y;t!=(u!=this._lastUpdatedSequenceNumber)&&SharedLogHelper.LogError("updateTopResult",t+" != (sequenceNumber "+u+" != lastUpdateSequenceNumber "+this._lastUpdatedSequenceNumber+")",new Error("Precondition failed"));this._lastUpdatedSequenceNumber=u;t&&(this.groups=[],this.onGroupsCleared());a=this._selectedItem;o=this.topResults;i=this.getTopResultsWhichFitInCanvas(i);h=!n.sequenceEqual(i,o)||o.some(function(n){return n.needsRefreshAfterDeduping});h&&(this.topResults=i.slice(0));var c=!1,l=h?i.length:0,v=function(){c&&l==0&&(n.config.enableLocalInstrumentation&&s._instrumentationHelper.instrumentRenderedLocalSuggestion(u,i),s._instrumentationHelper.instrumentTopResultRendered(u,i.map(function(n){return n.type})),c=!1)};return h?(this.renderTopResultsAfter(function(){for(var i,t=0,h=s.topResults;t<h.length;t++)i=h[t],i.needsRefreshAfterDeduping=!1,n.contains(o,i)?l-=1:s.setupIcon(u,i,!0,function(){l-=1;v()});s.onBeforeRenderTopResults(o,f,r,e)}),c=!0):(y=this.onBeforeRenderTopResults(o,f,r,e),y==0&&(this.renderTopResults(),c=!0)),this._selectedItem&&(a!=this._selectedItem||t)&&n.contains(this.topResults,this._selectedItem)&&this.resetAriaSelected(this._selectedItem),[h,v]},t.prototype.setupIcon=function(n,t,i,r){r()},t.prototype.renderGroups=function(){this._groupRenderingDisabled||this._page.updateGroupsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups})},t.prototype.renderGroupsAfter=function(n){var t=this._groupRenderingDisabled;this._groupRenderingDisabled=!0;try{n()}finally{this._groupRenderingDisabled=t;this.renderGroups()}},t.prototype.renderTopResults=function(){this._topResultsRenderingDisabled||this._page.updateTopResultsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups})},t.prototype.renderTopResultsAfter=function(n){var u=this._topResultsRenderingDisabled,t,i,r;this._topResultsRenderingDisabled=!0;try{n()}finally{for(this._topResultsRenderingDisabled=u,this.renderTopResults(),t=0,i=this.topResults;t<i.length;t++)r=i[t],r.executeScript&&r.executeScript()}},t}();n.BaseRootViewModel=t}(AutoSuggest||(AutoSuggest={})),function(n){var t="aria-selected",i=function(){function i(i){var r=this,u;this._host=i;this._renderingInProgress=!1;this._narratorLaunchHandlers=[];this._viewData={};this._targetElemCache={};u=new MutationObserver(function(n){var i,o,u,f,s,e;if(!r._renderingInProgress){for(i=[],u=0,f=n;u<f.length;u++)s=f[u],e=s.target,o=e.id,i.push(e.getAttribute(t)=="true"?1:0);(i.length==1&&i[0]==0||i.length==2&&i[0]^i[1])&&r._narratorLaunchHandlers.forEach(function(n){return n(o)})}});u.observe(document,{subtree:!0,attributes:!0,attributeFilter:[t]});n.View.getLocString=function(n){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return i.getLocString.apply(i,[n].concat(r))};this.addViewData("TestHooksEnabled",n.config.th)}return i.prototype.adjustHeightAsync=function(){var n=this;sb_st(function(){return n._host.adjustHeight()},0)},i.prototype.bindOnNarratorLaunch=function(n){this._narratorLaunchHandlers.push(n)},i.prototype.render=function(t){var i=this;this._renderingTimer&&sb_ct(this._renderingTimer);this._renderingInProgress=!0;try{n.View.ViewData=this.getViewData();t()}finally{this._renderingTimer=sb_st(function(){i._renderingTimer=null;i._renderingInProgress=!1},0)}},i.prototype.renderReactView=function(n,t,i){var f=this,r=this._targetElemCache[n],u;r||(this._targetElemCache[n]=r=_ge(n));u=i;u.adjustHeight||(u.adjustHeight=function(){return f.adjustHeightAsync()});this.render(function(){return _w.ReactDOM.render(React.createElement(t,i),r)},n)},i.prototype.addViewData=function(n,t){this._viewData[n]=t},i.prototype.getViewData=function(){return this._viewData},i}();n.BasePage=i}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i=function(i){function r(n){var r=i.call(this,n)||this;return r._root=_ge("root"),n.bindAppVisible(function(){r._root||(r._root=_ge("root"));r.setConditionalCss("google_blue",t.config.enableGoogleBlueLinks);r.setConditionalCss("edge_blue",t.config.enableEdgeBlueLinks);r.setConditionalCss("universal_blue",t.config.enableUniversalBlueLinks);r.setConditionalCss("darkgrey_select",t.config.enableDarkGreySelect);r.setConditionalCss("lightgrey_select",t.config.enableLightGreySelect);r.setConditionalCss("blue_select",t.config.enableBlueSelect);r.setConditionalCss("leftPageTitle",t.config.enableLeftPageTitle)}),r}return __extends(r,i),r.prototype.setConditionalCss=function(n,t){t?this._root.classList.add(n):this._root.classList.remove(n)},r.prototype.setSuggestionClickHandler=function(n){this._suggestionClickHandler=n},r.prototype.setSecondaryActionClickHandler=function(n){this._secondaryActionClickHandler=n},r.prototype.setFeedbackClickHandler=function(n){this._feedbackClickHandler=n},r.prototype.updateGroupsView=function(i){this.renderReactView("groups",n.View.OneBoxGroups,{groups:i.groups,clickHandler:this._suggestionClickHandler,secondaryActionClickHandler:this._secondaryActionClickHandler,inlineAdditionalInfoTypes:t.config.inlineAdditionalInfoTypes})},r.prototype.updateTopResultsView=function(i){t.config.enableFeedback&&_ge("fbpgdg")&&sj_evt.fire("feedbackformcloserequested");this.renderReactView("topResults",n.View.OneBoxTopResults,{suggestions:i.topResults,clickHandler:this._suggestionClickHandler,secondaryActionClickHandler:this._secondaryActionClickHandler,wrapsToTwoLines:this._host.shouldWrapAnswersToTwoLines(),smallerAnswers:!!t.config.smallerAnswersType,inlineAdditionalInfoTypes:t.config.inlineAdditionalInfoTypes,inlineInfoNoGlyph:t.config.inlineInfoNoGlyph,noSecondaryIcon:t.config.noSecondaryIcon,enableFeedback:t.config.enableFeedback&&!this._host.getQuery().isZeroInput,feedbackClickHandler:this._feedbackClickHandler})},r}(n.BasePage);t.Page=i})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function i(n,t){sj_be(_w,n,t)}function r(t){var i=_w[a],r;return i?(r=i.getCachedFrameMessage(t),n.safeExecute(function(){return JSON.parse(r)},"getCachedFrameMessage "+t)):null}function f(n,t){var i,r;t&&(i=_w[a],i&&(r=JSON.stringify(t),i.postFrameMessage(n,r)))}function ut(){return Math.floor(Math.random()*Number.MAX_VALUE)}function e(){return nt?!0:_w.ClientTestHooks&&ClientTestHooks.getUrlValue("touchDevice",undefined)!==undefined?ClientTestHooks.isTesthookParamSet("touchDevice"):t.TestHooks&&t.TestHooks.inBrowser?!1:navigator.maxTouchPoints>0}var k=34,o=12,d=16,a="ServiceUIFrameContext",s="smallSuggestionRow",h="tallUx",g="rs5UX",c="alwaysTall",nt=navigator.userAgent.includes("Holographic"),tt="9ea1ad79-fdb6-4f9a-8bc3-2b70f96e34c7",v="https://outlook.office.com/autosuggest",y=10,p=894,it=.8,l,rt=["ar","dv","fa","he","ku-arab","pa-arab","prs","ps","sd-arab","syr","ug","ur","qps-plocm"],u,w,b;(function(n){n.DHP={WithContent:{Default:"EDGHPC",OnTop:"EDGHPT",FromFocusRedirect:"ESPFR1"}};n.NTP={WithContent:{Default:"EDGNTC",OnTop:"EDGTCT",FromFocusRedirect:"ENTFR1"},NoContent:{Default:"EDGENT",OnTop:"EDGNTT",FromFocusRedirect:"ENTFR3"}};n.RegularTab="EDGEAR"})(u||(u={}));w=function(){function a(u,f){var e=this,o;this._seqNumberManager=u;this._tokenStores=f;this._pageType="AB";this._appVisibleEventHandlers=[];this._shownEventHandlers=[];this._clientAutoCompleteEventHandlers=[];this._conversationStartEventHandlers=[];this._dismissedEventHandlers=[];this._appHiddenEventHandlers=[];this._onSubmitHandlers=[];this._queryChangedHandlers=[];this._keyDownHandlers=[];this._accessTokenAvailableHandlers=[];this._topHitRestriction=0;this._sequenceNumber=n.InstrumentationCommon.INVALID_SEQUENCE_NUMBER;this._lastKeyWasEnter=!1;this._pendingClientAutocomplete=!1;this._currentPaneHeight=0;this._root=_ge("root");this._paneCloseCount=0;this._accessTokenRequestId=0;this._pendingTokenResponses={};this.bindKeyDown(function(t,i){var r=t==13,u;r&&!e._lastKeyWasEnter&&(u=n.getCurrentTime(),e._onSubmitHandlers.forEach(function(t){return n.safeExecute(function(){return t(u,!1,i)},"onSubmit handlers")}));e._lastKeyWasEnter=r});i("addressbarchanged",function(){if(!e._machineState){t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event ignored* addressbarchanged (sq="+e._sequenceNumber+")");return}var i=e._seqNumberManager.getSequenceNumber();i>e._sequenceNumber&&(e._topHitRestriction=0,e._sequenceNumber=i);t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* addressbarchanged (sq="+i+")");n.safeExecute(function(){return e.callQueryChangedHandlers(!1)},"addressbarchanged")});i("keydown",function(i){var r,u;e._lastKeyCode=i.keyCode;e._lastModifierKeys={shiftKey:i.shiftKey,ctrlKey:i.ctrlKey,altKey:i.altKey};e._sequenceNumber=e._seqNumberManager.getSequenceNumber();e._topHitRestriction=n.isDeletionKey(e._lastKeyCode,e._lastModifierKeys)?1:0;t.autoCompleteTrace&&(r=i.shiftKey?"SHIFT+":"",r+=i.ctrlKey?"CTRL+":"",r+=i.altKey?"ALT+":"",u="keydown "+r+e._lastKeyCode+" (sq="+e._sequenceNumber+")",t.autoCompleteTrace(e,u));e._keyDownHandlers.forEach(function(t){return n.safeExecute(function(){return t(i.keyCode,{shiftKey:i.shiftKey,ctrlKey:i.ctrlKey,altKey:i.altKey})},"keydown")})});i("locationavailable",function(){return n.safeExecute(function(){return e.tryRetrieveUserLocation()},"locationavailable")});i("serviceuidismissed",function(){e._paneCloseCount+=1;t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* serviceuidismissed");e._dismissedEventHandlers.forEach(function(t){return n.safeExecute(function(){return t()},"serviceuidismissed")});e._appHiddenEventHandlers.forEach(function(t){return n.safeExecute(function(){return t()},"apphidden")})});i("rpstokenavailable",function(){t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* rpstokenavailable");n.safeExecute(function(){return e.tryRetrieveRpsToken()},"rpstokenavailable")});i("serviceuiopened",function(){t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* serviceuiopened");e.initializeConversation(!1)});i("clientautocomplete",function(){e._machineState?n.safeExecute(function(){return e.onClientAutocomplete()},"clientautocomplete"):e._pendingClientAutocomplete=!0});i("pagetypechanged",function(){return n.safeExecute(function(){var n=r("pagetypechanged");t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* pagetypechanged: "+JSON.stringify(n));n&&n.pageType&&(e._pageType=n.pageType.toUpperCase())},"pagetypechanged")});i("preLoadDenied",function(n){e._currentPrefetchedUrl=null;e._prefetchDiscardedInConversation=!0;var i=n&&n.data?JSON.parse(n.data):null,r=i?b[i.preLoadDeniedReason]:null;t.autoCompleteTrace&&t.autoCompleteTrace(e,"*event* preLoadDenied: "+r);SharedLogHelper.LogError("preLoadDenied",r,new Error("preLoadDenied"))});t.config.th&&(o=_ge("ClientLog"),sj_be(o,"click",function(){t._resetClientLog(e)}));i("tokenresponseavailable",function(){return n.safeExecute(function(){var i=r("tokenResponse"),u,o,h,s,c,l,f;i&&(u=e._pendingTokenResponses[i.RequestId],u&&(o=i.Username||i.propertyMap&&i.propertyMap.UPN,i.Token&&i.Type=="AAD"&&o?(h={Token:i.Token,ExpireDateTime:i.propertyMap&&i.propertyMap.exp?parseInt(i.propertyMap.exp)*1e3:null,RoutingHint:o,UserName:o},s=e._tokenStores[u],u=="SSUE"?(t.isOffice365TokenAvailable=!0,s.setToken(h,u),c=s.findAccount(u),e._accessTokenAvailableHandlers.forEach(function(t){return n.safeExecute(function(){return t(c,u)},"substrateAccessTokenAvailable")})):u=="BAW"&&s.setToken(h,u,function(i){i&&(t.isBingAtWorkTokenAvailable=!0,e._accessTokenAvailableHandlers.forEach(function(t){return n.safeExecute(function(){return t(i,u)},"bawAccessTokenAvailable")}))})):i.ErrorMessage&&u=="SSUE"&&(l=_ge("verifyLink"),l||(f=_d.createElement("div"),f.setAttribute("id","verifyLink"),f.innerText="Verify your account",f.onclick=function(){e.requestAccessToken("SSUE",v,!1);e._root.removeChild(f)},e._root.appendChild(f)))))},"tokenresponseavailable")});t.config.enableFeedback&&(Feedback.Bootstrap.InitializeFeedback({page:!0},"sb_feedback",!1,!0,!1),sj_evt.bind("ajax.feedback.initialized",sj_dm(this,this.registerFeedbackDebugCallback),!0),sj_evt.bind("onFeedbackClosing",sj_dm(this,this.onFeedbackClosing),!0))}return a.prototype.initializeEvents=function(){var i=this;t.autoCompleteTrace&&t.autoCompleteTrace(this,"initialize");this.initializeConversation(!0);this.bindConversationStart(function(){i._pendingClientAutocomplete&&n.safeExecute(function(){return i.onClientAutocomplete()},"pendingClientAutocomplete")});this.bindShown(function(){i._baseQuery||(i._baseQuery=i.getBaseQuery());i._lastKeyWasEnter=!1});this.bindDismissed(function(){i._machineState=null;i._userLocation=null;i._shouldRequestEltoken=!1;i._currentPaneHeight=0;i._currentPrefetchedUrl=null;i._prefetchDiscardedInConversation=!1;i._pendingTokenResponses={};i._wrapsToTwoLineAnswer=undefined;t.isOffice365TokenAvailable=!1;t.isBingAtWorkTokenAvailable=!1;i._baseQuery=null;i._lastKeyWasEnter=!1})},a.prototype.initializeConversation=function(i){var e=this,u=r("serviceUIConversation"),f;u&&(f=this._currentCVID,this._currentCVID=n.cleanGuid(u.conversationGuid),this._pageType=u.type.toUpperCase(),t.autoCompleteTrace&&t.autoCompleteTrace(this,"cvid = "+this._currentCVID+", type = "+this._pageType),this.tryRetrieveUserLocation(),this.tryRetrieveRpsToken(),this._lastInputType=u.lastInputType,this.getMachineState(),f!=this._currentCVID)&&(this._randomPrivacyNumber=ut(),this._appVisibleEventHandlers.forEach(function(n){return n()}),this._shownEventHandlers.forEach(function(n){return n()}),this._conversationStartEventHandlers.forEach(function(n){return n()}),i&&n.safeExecute(function(){return e.callQueryChangedHandlers(!0)},"initializeConversation"),this._machineState.inPrivate||(!this.isThirdPartySearchProvider()&&n.isDataSourceEnabled("BAW",null)&&this.requestAccessToken("BAW",tt,!0),n.isDataSourceEnabled("SSUE",null)&&this.requestAccessToken("SSUE",v,!0)))},a.prototype.bindOnSubmit=function(n){this._onSubmitHandlers.push(n)},a.prototype.bindQueryChangedOrInitialized=function(n){this._queryChangedHandlers.push(n)},a.prototype.bindKeyDown=function(n){this._keyDownHandlers.push(n)},a.prototype.bindAppVisible=function(n){this._appVisibleEventHandlers.push(n)},a.prototype.bindShown=function(n){this._shownEventHandlers.push(n)},a.prototype.bindConversationStart=function(n){this._conversationStartEventHandlers.push(n)},a.prototype.bindDismissed=function(n){this._dismissedEventHandlers.push(n)},a.prototype.bindAppHidden=function(n){this._appHiddenEventHandlers.push(n)},a.prototype.bindClearMRURequested=function(){},a.prototype.bindClientAutoComplete=function(n){this._clientAutoCompleteEventHandlers.push(n)},a.prototype.getLocString=function(t){for(var i,u=[],r=1;r<arguments.length;r++)u[r-1]=arguments[r];return this._locStrings?(i=this._locStrings[t],i&&u.length>0&&(i=n.formatString(i,u)),i):(SharedLogHelper.LogError("getLocString",t+(this._machineState?" [machineState available]":" [machineState not available]"),new Error("No locStrings")),"")},a.prototype.getRawImpressionGuid=function(){return this._currentRawImpressionGuid},a.prototype.getConversationId=function(){return this._currentCVID},a.prototype.getPrivacyNumber=function(){return this._randomPrivacyNumber},a.prototype.getQuery=function(){return this._lastQuery||this.refreshQuery(),this._lastQuery},a.prototype.getBaseQuery=function(){var r,u,f,i;return t.config.enableBaseQuery&&(r=this.getTabContext(),u=this.getMachineState(),r&&r.results&&u.showContextCardsDefault&&u.diagnosticsLevel&&u.diagnosticsLevel>2&&(f=r.results.find(function(n){return n.isActive}),f&&f.url&&(i=n.tryParseUrl(f.url,!0),i&&i.parameters&&n.isBingHost(i))))?n.getQueryStringParam(i.parameters,"q"):null},a.prototype.shouldWrapAnswersToTwoLines=function(){if(!t.config.smallerAnswersType)return!1;if(t.config.smallerAnswersType==2)return!0;if(t.config.smallerAnswersType==1)return!1;if(typeof this._wrapsToTwoLineAnswer=="boolean")return this._wrapsToTwoLineAnswer;var n=this.getPanelWidth();return n<y?!0:(this._wrapsToTwoLineAnswer=n<p,this._wrapsToTwoLineAnswer)},a.prototype.setAddressBarContentAction=function(n,i,r,u,e,o,s){var h=this.generateAddressBarContentMsg(this._currentRawImpressionGuid,n,r,i,u,e,o,s);t.autoCompleteTrace&&t.autoCompleteTrace(this,"setAddressBarContent "+JSON.stringify(h));h&&(f("setAddressBarContent",h),this._wasLastQueryAutocompleted=e);o?this._currentPrefetchedUrl=r:this._currentPrefetchedUrl&&(this._currentPrefetchedUrl=null,this._prefetchDiscardedInConversation=!0)},a.prototype.setClientAutocompleteDelayWindow=function(n){t.config.serverIntentDetection>=2?f("setClientAutocompleteDelayWindow",{delayWindow:n}):t.config.serverIntentDetection&&f("setScriptOverrideWindow",{overrideWindow:n})},a.prototype.adjustHeightWithoffset=function(n){this.adjustHeight(!0,n)},a.prototype.adjustHeight=function(n,i,r){var e=this,c,o,u,s,h;this._pendingAdjustHeightTimer&&(sb_ct(this._pendingAdjustHeightTimer),this._pendingAdjustHeightTimer=null);t.config.th&&ClientTestHooks.isTesthookParamSet("searchbox")&&(this._root.style.height="");c=this._root.offsetWidth;o=!n&&c<y;o&&this._root.classList.add("absoluteForMeasuring");u=this._root.offsetHeight;o&&this._root.classList.remove("absoluteForMeasuring");this._topResults===undefined&&(this._topResults=_ge("topResults").children[0]);this._topResults&&this._topResults.children.length>0&&(s=this._topResults.children[0],s.classList.contains("rich")&&s.offsetHeight==0&&(u+=t.AnswerHeight));i&&u<i?u=i:!r&&u!=0&&t.config.enableFeedback&&_ge("fbpgdg")&&u<t.config.feedbackBackgroundMinimumHeight&&(u=t.config.feedbackBackgroundMinimumHeight);h=function(){u!=e._currentPaneHeight&&f("adjustHeight",{height:u,duration:t.config.animationDuration});e._currentPaneHeight=u;e._pendingAdjustHeightTimer=null;o&&(e._pendingAdjustHeightTimer=sb_st(function(){e._pendingAdjustHeightTimer=null;e.adjustHeight(!0)},1))};!t.config.paneResizeDelay||u>=this._currentPaneHeight?h():this._pendingAdjustHeightTimer=sb_st(h,t.config.paneResizeDelay)},a.prototype.shouldRequestEltoken=function(){return this._shouldRequestEltoken},a.prototype.getElToken=function(){return this._elToken},a.prototype.setElToken=function(n){this._elToken=n;this._shouldRequestEltoken=!1},a.prototype.getPageType=function(){return this._pageType},a.prototype.getFormCode=function(){if(this._pageType!="DHP"&&this._pageType!="NTP")return u.RegularTab;var t=this.getMachineState(),n=u.DHP.WithContent;return this._pageType=="NTP"&&(n=typeof t.newTabPageDisplayOption!="undefined"&&t.newTabPageDisplayOption==0?u.NTP.WithContent:u.NTP.NoContent),this.isOneBoxInMiddleOfPage()?n.Default:t.searchIsFromHtmlAddressBox?n.FromFocusRedirect:n.OnTop},a.prototype.onFeedbackClosing=function(){this.adjustHeight(!0,undefined,!0)},a.prototype.registerFeedbackDebugCallback=function(n){var t=this,i=n[1].debugCollector;i.registerCollectionCallback(function(){return t.collectDebugInfo()})},a.prototype.collectDebugInfo=function(){var n={},r=this._lastQuery,t,i;return r&&(n.query=r.originalQuery),n.conversationId=this._currentCVID,n.entryPoint="AutoSuggest_OneBox",t=this._root.clientWidth,t&&(n.width=t.toString()),i=this._root.clientHeight,i&&(n.height=i.toString()),n},a.prototype.refreshQuery=function(){var n=this.getAddressbarContent(),i,r;n&&this._topHitRestriction==0&&(i=this._lastQuery?this._lastQuery.originalQuery.length:0,r=n.content.length,r>=i+10&&(this._topHitRestriction=1));this._lastQuery=t.config.enableContextualZeroInput?n?t.parseQueryContextual(n,this.getMachineState(),this.getTabContext(),this.isThirdPartySearchProvider(),this._topHitRestriction,this._pageType):null:n?t.parseQuery(n,this.getMachineState(),this.isThirdPartySearchProvider(),this._topHitRestriction,this._pageType):null;t.config.enableBaseQuery&&n&&(this._lastQuery.baseQuery=this._baseQuery)},a.prototype.callQueryChangedHandlers=function(n){var t=this,i=n?this.tryRetrieveClientAutoComplete(!0):null;if(this.refreshQuery(),!this._lastQuery){n||SharedLogHelper.LogError("callQueryChangedHandlers",null,new Error("address bar content is null"));return}n&&this.fireClientAutoCompleteEventHandlers(i,!0);this._queryChangedHandlers.forEach(function(n){return n(t._lastQuery,t._wasLastQueryAutocompleted)})},a.prototype.fireClientAutoCompleteEventHandlers=function(n,t){if(n&&n.content){var i=this._lastQuery?this._lastQuery.originalQuery:n.typedContent;this._clientAutoCompleteEventHandlers.forEach(function(r){return r(i,n.content,t)})}},a.prototype.onClientAutocomplete=function(){this._pendingClientAutocomplete=!1;var n=this.tryRetrieveClientAutoComplete(!1);this.fireClientAutoCompleteEventHandlers(n,!1)},a.prototype.tryRetrieveClientAutoComplete=function(n){var f=this,i=r("clientAutoComplete"),u=function(r){if(t.autoCompleteTrace){var u=r?" ignored":"",e=n?"[cached"+u+"]":"*event"+u+"*";t.autoCompleteTrace(f,e+" clientAutoComplete "+JSON.stringify(i))}};if(i){if(i.preventAutocomplete!=undefined)return i.preventAutocomplete&&(this._topHitRestriction=1),u(!1),null;if(i.content)return u(!1),i}return u(!0),null},a.prototype.tryRetrieveUserLocation=function(){var n=r("location");n&&(this._userLocation=n.location,this._shouldRequestEltoken=!0)},a.prototype.tryRetrieveRpsToken=function(){var n=r("rpsToken");n&&(this._rpsToken=n.rpsToken)},a.prototype.getAddressbarContent=function(){l=null;var n=r("addressBarContent");return n&&(this._currentRawImpressionGuid=n.addressbar.impressionGuid,t.autoCompleteTrace&&t.autoCompleteTrace(this,"getAddressbarContent "+JSON.stringify(n))),n?n.addressbar:null},a.prototype.applyAccentColor=function(i){var f,u,e,r;i=i.replace(",alpha","");f="accentColor";u=_d.getElementById(f);u||(u=sj_ce("style"),u.id=f,u.type="text/css",_d.head.appendChild(u));e=this._root.parentElement.parentElement.classList;e.remove("darkThemeOverride");this._machineState.isLightTheme===!1&&e.add("darkThemeOverride");r=".cortanaIcon svg{fill:{0}}.accentColor{color:{0}}.sa_hv{border-left-color:{0}}";n.isHighContrastEnabled()||(this._machineState.isLightTheme===!1?(r+=".sa_hv .simpleContainer, .sa_hv .actionIcon, .groupHeader.selectable.sa_hv {background-color:{1}}",r+=".sa_hv .richContainer {background-color:{2}}"):(r+=".sa_hv,.selectable.sa_hv:hover,.suggestion.sa_hv:hover{background-color:{1}}",r+=".suggestion.rich.sa_hv,.suggestion.rich.richAnnotated.sa_hv:hover{background-color:{2}}",r+=".suggestion.rich.sa_hv .simpleContainer,.suggestion.rich.richAnnotated.sa_hv:hover .simpleContainer{background-color:{3}}"));u.innerHTML=this._machineState.isLightTheme===!1?n.formatString(r,[i,this.addTransparency(i,.4),this.addTransparency(i,.2)]):t.config.enableColoredLinks?n.formatString(r,[i]):n.formatString(r,[i,this.addTransparency(i,.3),this.addTransparency(i,.19),this.addTransparency(i,.13)])},a.prototype.addTransparency=function(n,t){return n.replace("rgb","rgba").replace(")",","+t+")")},a.prototype.applyRowHeight=function(){var n=this.useSmallSuggestionRow();this._smallSuggestionRow!=n&&(n?(t.SuggestionHeight=t.SmallerSuggestionHeight,this._root.classList.remove(h,c),this._root.classList.add(s)):t.config.doubleLineSuggestions?(t.SuggestionHeight=t.WideSuggestionHeight,this._root.classList.remove(s),this._root.classList.add(h),t.config.doubleLineMixedRowHeights||this._root.classList.add(c)):(t.SuggestionHeight=t.DefaultSuggestionHeight,this._root.classList.remove(s,h,c)),this._smallSuggestionRow=n)},a.prototype.applyUXBasedonOS=function(){t.config.rs5UX&&this._root.classList.add(g)},a.prototype.useSmallSuggestionRow=function(){switch(t.config.suggestionHeightType){case 0:return!0;case 1:return!e();case 2:return!1;case 3:return!e()||this._lastInputType==1||this._lastInputType==4;default:throw new Error("Unsupported suggestion height type: "+t.config.suggestionHeightType);}},a.prototype.renderTallUx=function(){return t.config.doubleLineSuggestions&&!this.useSmallSuggestionRow()},a.prototype.getCustomUrlParameters=function(t){var i={},r=this.getMachineState();return i[n.Service.QueryParams.CountryCode]=r.market,i[n.Service.QueryParams.SetLang]=r.lang,t.queryToFetch&&r.showSearchHistory===!1&&(i[n.Service.QueryParams.NoHistory]="1"),this._lastQuery.baseQuery&&(i[n.Service.QueryParams.BaseQuery]=this._lastQuery.baseQuery),i},a.prototype.getPanelWidth=function(){return this._root.offsetWidth},a.prototype.getAnswerSize=function(){var f=this.getMachineState().cortana,e=this.getPanelWidth(),n=Math.max(this.getPanelWidth(),320)-2*o,i,r,u;return t.config.smallerAnswersType?t.config.smallerAnswersType==2||t.config.smallerAnswersType==3&&e<p?n:(r=n-(d+o),u=r*it,u):(i=f?o+k:0,n-i)},a.prototype.getCustomHeaders=function(){var n={},r=this.getMachineState(),i;return this._userLocation&&(n["X-Search-Location"]=this._userLocation),r.cortana||(n["X-Device-isOptin"]="false"),r.cortanaCapabilities&&(n["X-Search-CortanaAvailableCapabilities"]=r.cortanaCapabilities),this.isThirdPartySearchProvider()&&(n["X-Search-ThirdParty"]="true"),e()&&(n["X-Device-Touch"]="true"),n["X-Autosuggest-ContentWidth"]=this.getAnswerSize().toString(),n["X-Search-RPSToken"]=this._rpsToken?this._rpsToken:"NA",n.Authorization="Bearer NA",i=[],t.config.smallerAnswersType&&i.push("SmallerAnswers"),t.config.requirePreciseLocalTriggering&&!this.isClientLocationAvailable()&&i.push("DisableELA"),i.length>0&&(n["X-BM-ClientFeatures"]=i.join()),n},a.prototype.getMachineState=function(){return this._machineState||this.initializeMachineState(),this._machineState},a.prototype.getTabContext=function(){return r("tabContext")},a.prototype.isSignedInWithMSA=function(){return!!this._rpsToken},a.prototype.canHaveSearchHistory=function(){return t.config.enableContextualZeroInput?t.searchHistoryAllowedContextual(this.isThirdPartySearchProvider(),this.getMachineState()):t.searchHistoryAllowed(this.isThirdPartySearchProvider(),this.getMachineState())},a.prototype.verifyPrefetchSupported=function(n){return!this.getMachineState().isPreLoadCapable||this._prefetchDiscardedInConversation?!1:!this._currentPrefetchedUrl||!n?!0:this._currentPrefetchedUrl==n},a.prototype.isPrefetchCurrentlyLoaded=function(){return!!this._currentPrefetchedUrl},a.prototype.reloadWebView=function(){location.reload()},a.prototype.initializeMachineState=function(){var n=r("machineState");this._machineState=n;this.applyAccentColor(n.accentColor);this.checkCortanaStatus(n.cortana,n.market);this.applyLanguage(n.lang);this.applyInstrumentation(n.inPrivate,n.searchSuggestionsOn);this.applyRowHeight();this.applyUXBasedonOS();t.autoCompleteTrace&&t.autoCompleteTrace(this,"thirdPartySearchProvider: "+n.thirdPartySearchProvider+", searchProvider: "+n.searchProvider+", addressBarPosition="+n.addressBarPosition+", isPreLoadCapable="+n.isPreLoadCapable)},a.prototype.requestAccessToken=function(i,r,u){var o=this._tokenStores[i],e,s;o&&(e=o.findAccount(i),u&&e?(i=="BAW"&&e.TenantName&&e.Token&&e.UserName&&e.TenantTheme&&(t.isBingAtWorkTokenAvailable=!0),i=="SSUE"&&(t.isOffice365TokenAvailable=!0),this._accessTokenAvailableHandlers.forEach(function(t){return n.safeExecute(function(){return t(e,i)},"accessTokenAvailable")})):(this._accessTokenRequestId++,this._pendingTokenResponses[this._accessTokenRequestId]=i,s={requestId:this._accessTokenRequestId,scope:"",resourceId:r,silentMode:u},f("getTokenAsync",s)))},a.prototype.checkCortanaStatus=function(n,i){var r=t.config.enableCortanaIcon&&n&&i.toLowerCase()!="cn";_d.body.setAttribute("cortana",r?"on":"off")},a.prototype.applyLanguage=function(t){var i={uiCulture:t,name:"OneBox",namespace:"AutoSuggest"};this._locStrings=n.safeExecute(function(){return LocStringManager.getLocString(i)},"applyLanguage",null,t);this._locStrings||(i.uiCulture=t="en-US",this._locStrings=n.safeExecute(function(){return LocStringManager.getLocString(i)},"applyLanguage",null,t));_d.body.setAttribute("lang",t);_d.body.setAttribute("dir",rt.some(function(n){return t=t.toLocaleLowerCase(),t==n||t.startsWith(n+"-")})?"rtl":"ltr")},a.prototype.applyInstrumentation=function(n,t){ClientInstConfig.isInstrumentationEnabled=!n&&t!==!1},a.prototype.getRegion=function(){return this.getMachineState().market},a.prototype.getLanguage=function(){return this.getMachineState().lang},a.prototype.isInPrivate=function(){return this.getMachineState().inPrivate},a.prototype.isThirdPartySearchProvider=function(){var n=this.getMachineState();return n.thirdPartySearchProvider&&n.searchProvider!=t.BingSearchProvider},a.prototype.isBingThirdPartySearchProvider=function(){var n=this.getMachineState();return n.thirdPartySearchProvider&&n.searchProvider==t.BingSearchProvider},a.prototype.isClientLocationAvailable=function(){return!!this._userLocation},a.prototype.dataSourceDependencies=function(n){return t.config.urlProviderWaitForLocal&&n=="UAS"?["TypedUrls","Local"]:[]},a.prototype.getPaneCloseCount=function(){return this._paneCloseCount},a.prototype.hasFallbackHappened=function(){return!1},a.prototype.getMSNRefIg=function(){return this._pageType=="DHP"||this._pageType=="NTP"?this.getMachineState().ntpWebIG:null},a.prototype.getSafeSearchSetting=function(){return undefined},a.prototype.isEducationEnvironment=function(){return this.getMachineState().enableRegulatoryPsm},a.prototype.isWindowsS=function(){return this.getMachineState().enableCPsm},a.prototype.getPartnerSearchCode=function(){return null},a.prototype.getInitialInputType=function(){return this._lastInputType},a.prototype.bindAccessTokenAvailable=function(n){this._accessTokenAvailableHandlers.push(n)},a.prototype.generateAddressBarContentMsg=function(t,i,r,u,f,e,o,s){var h={impressionGuid:t,content:i,actionTarget:r,action:u,doActionNow:f,autocomplete:e,isReformulation:s};return(o&&(h.shouldPreLoad=o),n.objEquals(h,l))?null:(l=h,h)},a.prototype.isOneBoxInMiddleOfPage=function(){return!t.config.alwaysInAddressBar&&this.getMachineState().addressBarPosition!="frame"},a}();t.Host=w;t.bindOneBoxEvent=i;t.getCachedFrameMessage=r;t.postFrameMessage=f;t.isTouchDevice=e,function(n){n[n.NotDismissed=0]="NotDismissed";n[n.OneBoxDismissed=1]="OneBoxDismissed";n[n.MisMatchedActionTarget=2]="MisMatchedActionTarget";n[n.ClientAutoComplete=3]="ClientAutoComplete";n[n.InvalidDevice=4]="InvalidDevice";n[n.PriorAbandonedAttempt=5]="PriorAbandonedAttempt";n[n.InvalidFlight=6]="InvalidFlight";n[n.IncorrectOwnerTab=7]="IncorrectOwnerTab";n[n.MissingHiddenTabTarget=8]="MissingHiddenTabTarget";n[n.RunTimeMemoryPressure=9]="RunTimeMemoryPressure"}(b=t.PreLoadDismissReason||(t.PreLoadDismissReason={}))})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i="pushDown",r="slideIn",u="show",f=function(f){function e(i,r,u,e,o,s){var h=f.call(this,i,r,e,o)||this;return h._host=i,h._autoComplete=u,h._bingAtWorkWebTelemetry=s,h._submitAlreadyDone=!0,h._resultsCounter={numberOfGroups:0,numberOfSuggestions:0,numberOfTopResultAnswers:0,numberOfTopResultSuggestions:0,numberOfTopResult2LinesSuggestions:0},h._isUserKeyboardNavigating=!1,h._host.getMachineState().formFactor=="Xbox"&&(navigator.gamepadInputEmulation="keyboard",t.bindOneBoxEvent("adjustFocus",function(r){return n.safeExecute(function(){var n=r&&r.data?JSON.parse(r.data):null,o,f,u,e;(t.autoCompleteTrace&&t.autoCompleteTrace(i,"*event* adjustFocus - "+JSON.stringify(n)),n.focused&&(h._pointerCoordinates={x:n.x,y:n.y}),o={isfocused:!0,x:h._pointerCoordinates?h._pointerCoordinates.x:0,y:h._pointerCoordinates?h._pointerCoordinates.y:0},t.postFrameMessage("adjustFocus",o),f=h,u=f.getSelectableItems(),u.length!=0)&&n.y>0&&(e=void 0,e=u[u.length-1],f.select(e,!0))},"adjustFocusHandler")})),h._maxHeight=h.getOneBoxMaxHeight(),t.bindOneBoxEvent("maxsizechanged",function(){return h._maxHeight=h.getOneBoxMaxHeight()}),o.setSuggestionClickHandler(function(t,i){return n.safeExecute(function(){h.instrumentSubmission(n.getCurrentTime(),t,t.sequenceNumber,null,n.getInputType(i));h.navigate(t)},"suggestionClickHandler")}),o.setSecondaryActionClickHandler(function(t,i,r){return n.safeExecute(function(){return h.onSecondaryActionClicked(t,i,r)},"queryBuilderClickHandler")}),t.config.enableFeedback&&o.setFeedbackClickHandler(function(t){return n.safeExecute(function(){return h.handleFeedbackButtonClicked(t)},"feedbackClickHandler")}),i.bindKeyDown(function(t){return h._isUserKeyboardNavigating=n.isUpOrDownKey(t)}),i.bindQueryChangedOrInitialized(function(){return h._isUserKeyboardNavigating=!1}),o.bindOnNarratorLaunch(function(t){for(var i,f=n.getCurrentTime(),e=h.getSelectableItems(),r=0,u=e;r<u.length;r++)if(i=u[r],i.id==t){h.instrumentSubmission(f,i,i.sequenceNumber,null,5);h.navigate(i);break}}),h}return __extends(e,f),e.prototype.getSuggestions=function(){var n=this.getCurrentTopResults();return this.groups.forEach(function(t){return n=n.concat(t.suggestions)}),n},e.prototype.getSelectableItems=function(){for(var t,n=this.topResults,i=0,r=this.groups;i<r.length;i++)t=r[i],t.instItem&&(n=n.concat(t)),n=n.concat(t.suggestions);return n},e.prototype.getSelectedItem=function(){return this._selectedItem},e.prototype.select=function(i,r,u){var e,f,o,s,h;u===void 0&&(u=!0);i?(e=this._selectedItem,e&&(e.selected=!1),this._selectedItem=i,i&&(i.selected=!0),(i&&n.contains(this.topResults,i)||e&&n.contains(this.topResults,e))&&this.renderTopResults(),(i&&this.groups.some(function(t){return t==i||n.contains(t.suggestions,i)})||e&&this.groups.some(function(t){return t==e||n.contains(t.suggestions,e)}))&&this.renderGroups(),i&&r&&this.setAddressBarText(i,u)):(f=this.getSelectedItem(),o=f?this.getSelectableItems().indexOf(f):-1,f&&(f.selected=!1,this._selectedItem=undefined),f&&n.contains(this.topResults,f)&&this.renderTopResults(),f&&this.groups.some(function(t){return t==f||n.contains(t.suggestions,f)})&&this.renderGroups(),o>0&&f&&(s=t.SuggestionsParser.createPartialQuery(this._host,this._partialQuery,f.sequenceNumber),this.setAddressBarText(s,!0)),this._host.getMachineState().formFactor=="Xbox"&&(h={isfocused:!1,x:this._pointerCoordinates?this._pointerCoordinates.x:0,y:o==0?0:this.getOneBoxMaxHeight()},t.postFrameMessage("adjustFocus",h)))},e.prototype.onAfterKeyDown=function(i){var r,u,f;n.isDownKey(i)&&this._host.getMachineState().formFactor=="Xbox"&&(r=this.getSelectedItem(),u=r?this.getSelectableItems().indexOf(r):-1,u==0&&(f={isfocused:!0,x:this._pointerCoordinates?this._pointerCoordinates.x:0,y:0},t.postFrameMessage("adjustFocus",f)))},e.prototype.submit=function(n,t,i,r,u){if(!this._submitAlreadyDone){var f=u?6:1;if(this.instrumentSubmission(n,null,i,r,f),this._selectedItem&&this.isSuggestion(this._selectedItem))this.onSuggestionLaunch(this._selectedItem,this._partialQuery);this._submitAlreadyDone=!0}},e.prototype.handleFeedbackButtonClicked=function(){this._host.adjustHeightWithoffset(t.config.feedbackBackgroundMinimumHeight);sj_evt.fire("feedbackformrequested",{formConfig:"Autosuggest_Onebox",service:"AutoSuggest",scenario:"Onebox"})},e.prototype.onSecondaryActionClicked=function(i,r,u){var f=this,e,o;r.type=="QueryBuilder"?this._host.setAddressBarContentAction(i.handoffType==1?i.query:i.query+" ",i.intent,i.url,!1,!1,!1,!0):r.type=="RemoveHistory"?(e=HitHighlightingParser.removeMarkers(i.text),o=t.config.removeSuggUrl.replace("%7b0%7d",encodeURIComponent(e)).replace("%7bSID%7d",sj_cook.get("_SS","SID")),n.fetchUrlJson(o,null,null,function(t){t.success&&(n.contains(f.topResults,i)?f.renderTopResults():f.renderGroups())})):this._host.setAddressBarContentAction(i.query,"directNav",r.url,!0,!1,!1,!1);u.stopPropagation();this._instrumentationHelper.logClientInstEvent("Select",r.type,i.sequenceNumber,{suggestion:i.instItem.getLayoutKValue()})},e.prototype.isSuggestion=function(n){return!n.suggestions},e.prototype.instrumentSubmission=function(i,r,u,f,e){var o;r?o=r.instItem:!this._selectedItem||f&&f.ctrlKey?(o=n.InstrumentedItem.getNonSuggestionInstrumentedItem("N",t.SyntheticQSCodesKValues),this._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,"N",o)):o=this._selectedItem.instItem;this._instrumentationHelper.instrumentItemClick(i,o,u,r?r.instrumentPingBack:null,e,f);this._bingAtWorkWebTelemetry&&r&&this._bingAtWorkWebTelemetry.logClicked(r.id)},e.prototype.onBeforeRenderTopResults=function(n){var t,r,f,e;if(this.topResults.length>0)for(this._partialQuery.queryToFetch&&(this._isUserKeyboardNavigating||(t=0,this.topResults[0].isAnswer&&this._host.isThirdPartySearchProvider()?t=this.topResults.findIndex(function(n){return n.type=="PF"}):this.topResults[0].type=="THH"&&(t=1),this.select(this.topResults[t],!0,!1))),this.topResults[0].htmlContent&&n.length>=1&&n[0].htmlContent&&this.setAnimationClassName(this.topResults[0],i),r=0,f=this.topResults.slice(1);r<f.length;r++)e=f[r],e.htmlContent&&this.setAnimationClassName(e,u);return 1},e.prototype.setupAnimations=function(t){var f=this;this._topResultAnimationTimer&&(sb_ct(this._topResultAnimationTimer),this._topResultAnimationTimer=0);this.topResults.length>=1&&this.topResults[0].htmlContent&&(t.length!=0&&t[0].htmlContent?t[0].query!=this.topResults[0].query?this.setAnimationClassName(this.topResults[0],r):this.setAnimationClassName(this.topResults[0],u):this.setAnimationClassName(this.topResults[0],i,r),this._topResultAnimationTimer=sb_st(function(){f._topResultAnimationTimer=0;n.safeExecute(function(){return f.renderTopResults()},"topResultAnimationTimer")},1))},e.prototype.setAnimationClassName=function(n){for(var f,e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];f=n.classNames.filter(function(n){return n!=i&&n!=r&&n!=u});f.push.apply(f,e);n.classNames=f},e.prototype.navigate=function(n){if(this.setAddressBarContent(n,!0,!1),this.isSuggestion(n))this.onSuggestionLaunch(n,this._partialQuery)},e.prototype.setAddressBarText=function(n,t){this.setAddressBarContent(n,!1,t)},e.prototype.setAddressBarContent=function(n,t,i){this._autoComplete.setAddressBarContent(this._partialQuery,n,t,i,!1,!1)},e.prototype.getOneBoxMaxHeight=function(){var n=t.getCachedFrameMessage("maxSize");return n?n.height:0},e.prototype.onQueryChanged=function(n,t){this._partialQuery&&this._partialQuery.equals(n)||(f.prototype.onQueryChanged.call(this,n,t),this._submitAlreadyDone=!1);this._autoComplete.onQueryChanged(n,t)},e.prototype.onSuggestionsParsed=function(n,t,i,r,u,f){i=="BAW"&&f&&f.rankerExtraInfo&&(this._bingAtWorkWebTelemetry.setContext({tenantId:f.rankerExtraInfo.TenantID,traceId:f.rankerExtraInfo.TraceID,tenantName:f.rankerExtraInfo.TenantName}),this._bingAtWorkWebTelemetry.logPerf())},e.prototype.addGroup=function(n,i,r,u){var f,o,s,h,e;if(this.groups.some(function(t){return t.type==n}))throw new Error("Trying to add repeated group "+n);return f=t.GroupType[n],n==t.GroupType.BingAtWork&&u?(s=u.BAW,h=s.rankerExtraInfo.TenantName,o=this._host.getLocString(f,h||"")):o=this._host.getLocString(f),e={type:n,text:o,suggestions:[],instRegionName:f},this.setSelectableGroupInfo(e,t.GroupHeaderQSCodes[n],i),this.insertGroup(e,r),e},e.prototype.insertGroup=function(n,t){for(var u,f=t.indexOf(n.type),r=!1,i=0;i<this.groups.length;i++)if(u=t.indexOf(this.groups[i].type),u>f){this.groups.splice(i,0,n);r=!0;break}r||this.groups.push(n)},e.prototype.setSelectableGroupInfo=function(i,r,u){if(t.config.enableHistorySettingsLink&&r=="MSH"){var f="https://www.bing.com/profile/history?FORM=EDGEHS";this._host.isSignedInWithMSA()&&(f+="&fsi=1");i.id="gr"+i.type;i.secondaryText=this._host.getLocString("ManageSearchHistory");i.secondaryTextClass="webHistoryGroupHeaderAnnotation";i.intent="directNav";i.handoffType=1;i.query=f;i.url=i.query;i.selected=!1;i.sequenceNumber=u;i.narratorText=t.getSuggestionNarratorText(i);i.instItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,t.SyntheticQSCodesKValues,i.handoffType);this._instrumentationHelper.instrumentSyntheticInstrumentedItem(u,r,i.instItem)}},e.prototype.getTopResultsWhichFitInCanvas=function(n){var u=[],i,r,t;for(this._resultsCounter.numberOfTopResultAnswers=0,this._resultsCounter.numberOfTopResultSuggestions=0,this._resultsCounter.numberOfTopResult2LinesSuggestions=0,i=0,r=n;i<r.length;i++)t=r[i],this.canFitSuggestion(!1,t)&&(t.htmlContent?this._resultsCounter.numberOfTopResultAnswers+=1:t.secondaryIcon||t.additionalInfoText?this._resultsCounter.numberOfTopResult2LinesSuggestions+=1:this._resultsCounter.numberOfTopResultSuggestions+=1,u.push(t));return u},e.prototype.canFitSuggestion=function(n){var i=this._maxHeight-t.GroupHeight*this._resultsCounter.numberOfGroups-t.SuggestionHeight*this._resultsCounter.numberOfSuggestions-t.SuggestionHeight*this._resultsCounter.numberOfTopResultSuggestions-t.Suggestion2LinesHeight*this._resultsCounter.numberOfTopResult2LinesSuggestions-t.AnswerHeight*this._resultsCounter.numberOfTopResultAnswers;return i>(n?t.GroupHeight+t.SuggestionHeight:t.SuggestionHeight)},e.prototype.logBawSuggestionShown=function(n){var t,i;if(n!=null)for(t=0;t<n.length;t++)i=n[t],(i.type=="BFBBKS"||i.type=="BFBPPL")&&this._bingAtWorkWebTelemetry.logShown(i.id)},e.prototype.onGroupsCleared=function(){this._resultsCounter.numberOfGroups=0;this._resultsCounter.numberOfSuggestions=0},e.prototype.mayNeedFlush=function(){return!1},e.prototype.update=function(n,i,r,u,f,e,o,s,h,c){var l=this,v=this.topResults,y=this.groups,a=this.updateTopResults(n,i,r,u,f,h),p=a[0],w=a[1],b=f.length>0||n&&y.length>0;if(w(),e.length)throw new Error("Removing suggestions not supported");return this.setupAnimations(v),b&&(this.renderGroupsAfter(function(){for(var r,e=function(n){var r=t.getGroupType(n),i=l.groups.find(function(n){return n.type==r});l.canFitSuggestion(!i,n)&&(i||(i=l.addGroup(r,u,s,c),l._resultsCounter.numberOfGroups+=1),i.suggestions.push(n),l._resultsCounter.numberOfSuggestions+=1,l.setupIcon(u,n,!1,function(){}),r==t.GroupType.BingAtWork&&l._bingAtWorkWebTelemetry&&l._bingAtWorkWebTelemetry.logShown(n.id))},n=0,i=f;n<i.length;n++)r=i[n],e(r)}),this._instrumentationHelper.instrumentRenderFinished(u,o)),p&&this._bingAtWorkWebTelemetry&&this.logBawSuggestionShown(i),1},e.prototype.setupIcon=function(t,i,r,u){var f=this;i.getIcon?(this._instrumentationHelper.notifyIconPending(t,r,i.instItem.getLayoutKValue(),i.type),i.getIcon(function(e){i.icon=e;f._partialQuery&&t==f._sequenceNumberReader.getSequenceNumber()&&(f._instrumentationHelper.notifyIconReady(t,r,i.instItem.getLayoutKValue(),i.type),r?n.contains(f.topResults,i)&&f.renderTopResults():f.groups.some(function(t){return n.contains(t.suggestions,i)})&&f.renderGroups(),u())})):u()},e}(n.BaseRootViewModel);t.RootViewModel=f})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function f(t,r,u,f,e,o,s){i(t,r,u,function(t){return f(t.status==200&&t.responseText?n.safeExecute(function(){return JSON.parse(t.responseText)},"JSON.parse"):null)},e,o,s)}function i(i,r,u,f,e,o,s,h){var c=sj_gx(),a,l;try{c.open(u?"POST":"GET",i,!0)}catch(v){SharedLogHelper.LogError("fetchUrl",i,v);f&&(n.log("error"),f({responseText:"",contentType:"",status:-1,result:3}));return}if(r)for(a in r)c.setRequestHeader(a,r[a]);e&&(l=e.register(function(){return c.abort()},!1,"xhr abort"));c.onreadystatechange=function(){c.readyState==4&&c.status>0&&t(c,0,f,l,e,o)};c.ontimeout=function(){return t(c,1,f,l,e,o)};c.onabort=function(){return t(c,2,f,l,e,o)};c.onerror=function(){return t(c,3,f,l,e,o)};typeof s!="undefined"?c.withCredentials=s:c.withCredentials!==undefined&&(c.withCredentials=!0);h&&h>0&&(c.timeout=h);c.send(u)}function t(n,t,i,r,u,f){(!f||f())&&(n.readyState==4&&(n.onreadystatechange=function(){}),r&&u.unregister(r),i&&i({responseText:n.responseText,contentType:n.getResponseHeader("content-type")||"",status:n.status,result:t}))}function e(n){var t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}var r,u;n.fetchUrlJson=f;n.fetchUrl=i;r=function(){function t(t){this._dataSource=t;this._delay=n.config.webDataSourcesWithThrottling[t]||0}return t.prototype.getBaseUrl=function(){throw new Error("Not Implemented");},t.prototype.getPostBody=function(){return undefined},t.prototype.onBeforeFetchUrl=function(){},t.prototype.createUrl=function(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")},t.prototype.addParamsToUrl=function(n,t){var i=t?Object.keys(t):[];return i.length>0&&(n+=n.includes("?")?"&":"?",n+=i.map(function(n){return n+"="+t[n]}).join("&")),n},t.prototype.fetch=function(t,i,r,u,f,e,o,s,h){var l=this,c,a;if(n.isDataSourceEnabled(this._dataSource,t))if(c=this.addParamsToUrl(this.createUrl(t),e),a=this.getPostBody(t)||"",this._timer&&(sb_ct(this._timer),this._timer=null),this._delay>0&&!t.isFormulatedQuery)this._timer=sb_st(function(){return n.safeExecute(function(){l._timer=null;l.onBeforeFetchUrl(r,c);l.fetchUrl(c,o,a,i,u,f,s,h)},"fetchDelay")},this._delay);else{this.onBeforeFetchUrl(r,c);this.fetchUrl(c,o,a,i,u,f,s,h)}},t.prototype.fetchUrl=function(t,r,u,f,e,o,s,h){var c=this;i(t,r,u,function(i){var r=i.responseText,o=i.contentType,u=i.status,e;u==200&&(n.config.th&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&o.includes("json")&&(e=n.safeExecute(function(){return JSON.parse(r)},"parseWebProviderResponse",null,t)));f(c._dataSource,e,u==200?null:u.toString())},this._delay>0?e:null,o,h,s)},t}();n.JsonDataProvider=r;u=function(t){function i(i,r,u){var f=t.call(this,n.WebDataSource)||this;return f._instrumentationHelper=i,f._responseCacheManager=r,f._headRankingSignalsManager=u,f}return __extends(i,t),i.prototype.getName=function(){return"AsSuggestionsDataProvider"},i.prototype.getBaseUrl=function(){return n.config.u},i.prototype.onBeforeFetchUrl=function(n,t){this._instrumentationHelper.instrumentSnRProviderFetchUrl(n,t)},i.prototype.fetch=function(i,r,u,f,e,o,s){var a=this,c,l,h;if(n.isDataSourceEnabled(this._dataSource,i)){if(this._headRankingSignalsManager&&(c=this._headRankingSignalsManager.get(i),c)){l=this.addParamsToUrl(this.createUrl(i),o);this.onBeforeFetchUrl(u,l);r(this._dataSource,c,null,2);return}h=r;h=function(t,u,f,e){u&&n.isEmptyUrlPrefix(i)&&(u.Suggestions=[]);a.processResourceResponse(u);r(t,u,f,e)};this._responseCacheManager?this.fetchWithCache(i,h,u,f,e,o,s):t.prototype.fetch.call(this,i,h,u,f,e,o,s)}},i.prototype.fetchWithCache=function(n,i,r,u,f,e,o){var h=this,c=this._responseCacheManager.get(n),l,a,s;if(c){l=this.addParamsToUrl(this.createUrl(n),e);this.onBeforeFetchUrl(r,l);i(this._dataSource,c,null,1)}else a=function(){return!0},s=i,s=function(t,r,u){f()&&i(t,r,u,0);n.queryToFetch&&h.responseIsValidForCaching(u,r)&&(r.ELToken&&(r=Object.assign({},r),delete r.ELToken),h._responseCacheManager.put(n,r))},t.prototype.fetch.call(this,n,s,r,u,a,e,o)},i.prototype.responseIsValidForCaching=function(n,t){var i="HS";return!n&&t&&t.Suggestions.every(function(n){return!n.InstantAnswer&&n.Attributes.stype!=i})},i.prototype.processResourceResponse=function(n){var t,i;n&&(t=n.Resources,t)&&(this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles,i={Styles:t.Styles,Scripts:null},JsonInject.WriteHeadAndBeforeContentResources(i))},i.prototype.updateWithDownloadedResources=function(n){var t,i;for(t in n.Styles)for(i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]},i}(r);n.AsSuggestionsDataProvider=u;n.getIconFromOnlineResponse=e}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){function f(n,t,i,r,f){typeof indexedDB!="undefined"&&new u(n,f,t,i,r)}function e(n,t,i,r,f){typeof indexedDB!="undefined"&&new u(n,f,t,i,r)}function o(n,t,i,r,f,e){typeof indexedDB!="undefined"&&new u(n,e,t,i,r,f)}function s(n,t,i,r,f,e){typeof indexedDB!="undefined"&&new u(n,e,t,i,r,f)}function h(n,t,u){i(n,"deleteDatabase requested");try{var f=indexedDB.deleteDatabase(n);f.onsuccess=function(){i(n,"deleteDatabase completed");t&&t()};f.onerror=r("deleteDatabase.onError",function(t){SharedLogHelper.LogError("deleteDB",n,t);u&&u(t)})}catch(e){u&&u(e)}}function r(n,t){return function(i){var r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}var i,u;t.instanceWithNumberKeys=f;t.instanceWithStringKeys=e;t.instanceWithNumberKeysAndSecondaryKey=o;t.instanceWithStringKeysAndSecondaryKey=s;i=n.config.th&&ClientTestHooks.isTesthookParamSet("dbTrace")?function(t,i){return n.log("["+t+"] "+i)}:function(){};t.deleteDatabase=h;t.handleErrorEvent=r;u=function(){function t(n,u,f,e,o,s){var h=this,c;this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";i(this._databaseName,"open requested");try{c=indexedDB.open(n,u||1)}catch(l){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}c.onsuccess=function(n){h._database=n.target.result;t._allInstances.push(h);i(h._databaseName,"open completed");f(h)};c.onupgradeneeded=function(n){var t,r;i(h._databaseName,"upgrading");t=n.target.result;t.objectStoreNames.contains(h._storeName)&&t.deleteObjectStore(h._storeName);r=t.createObjectStore(h._storeName);h._secondaryIndex&&r.createIndex(h._secondaryIndex,h._secondaryIndex,{unique:!1})};c.onerror=r("open.onError",e);c.onblocked=r("open.onBlocked",e)}return t.prototype.put=function(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,function(i,r,u){var f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)},t.prototype.putMultiple=function(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,function(t,i,r){var u=0,f=function(){if(u<n.length){var e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)},t.prototype.getValue=function(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",function(n){return t(n.target.result)},function(t,i,r){var u=t.get(n);u.onsuccess=i;u.onerror=r},i)},t.prototype.getRange=function(n,t,i,r){var u=this;this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(i.openCursor(e),r,f)},r)},t.prototype.getRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(e.openCursor(o),r,f)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))},t.prototype.removeRange=function(n,t,i,r){var u=this;this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(i.openCursor(e),r,f)},r)},t.prototype.removeRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(e.openCursor(o),r,f)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))},t.prototype.getAll=function(n,t){var i=this;this.safeDbOperation("getAll",null,"readonly",n,function(n,t,r){return i.queryFromCursor(n.openCursor(),t,r)},t)},t.prototype.close=function(){i(this._databaseName,"close requested");this.innerClose()},t.prototype.innerClose=function(){var f,e,r,u,o;if(t._requestsInProgress>0)i(this._databaseName,"delaying close because of "+t._requestsInProgress+" requests in progress"),this._closePending=!0;else for(f=function(t){t._database&&(n.safeExecute(function(){return t._database.close()},e._databaseName+".close"),i(t._databaseName,"close completed"),t._database=null,t.onClosed())},e=this,r=0,u=t._allInstances;r<u.length;r++)o=u[r],f(o)},t.prototype.queryFromCursor=function(t,i,r){var u=[];t.onsuccess=function(t){var r=t.target.result;r&&u.push({key:r.primaryKey,value:r.value});r&&u.length!=n.config.maxIndexedDBCursorIterations?r["continue"]():i(u)};t.onerror=r},t.prototype.removeFromCursor=function(t,i,r){var u=0;t.onsuccess=function(t){var r=t.target.result;r&&(r["delete"](),u+=1);r&&u!=n.config.maxIndexedDBCursorIterations?r["continue"]():i(null)};t.onerror=r},t.prototype.safeDbOperation=function(n,u,f,e,o,s){var h=this,l,c,a;i(this._databaseName,n+" requested"+(u?" "+u:""));t._requestsInProgress+=1;l=function(r){i(h._databaseName,n+" completed "+(u?u+" ":""));t._requestsInProgress-=1;e(r);h._closePending&&t._requestsInProgress==0&&h.innerClose()};c=function(n){t._requestsInProgress-=1;s(n);h._closePending&&t._requestsInProgress==0&&h.innerClose()};try{this._database?(a=this._database.transaction(this._storeName,f).objectStore(this._storeName),o(a,l,r(n+".onError",c))):c(new Error(n+" Database not initialized"))}catch(v){c(v)}},t._requestsInProgress=0,t._allInstances=[],t}()})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function t(n,t,i,r,u,f){var e=this;this._storageFactory=n;this.createResponse=t;this.dataPopulated=i;this.getDataSourceState=r;this._dataSource=u;this._storageOpenInProgress=!1;this._pendingQueries=[];f&&(f.bindAppVisible(function(){return e.initStorage()}),f.bindDismissed(function(){return e._pendingQueries=[]}),f.bindAppHidden(function(){return e.teardownStorage()}))}return t.prototype.teardownStorage=function(){this._storage&&this._storage.close()},t.prototype.initStorage=function(){var n=this;!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(function(t){n._storage=t;n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(t){n.onError(t,"open storage");n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(){return n._storage=null}))},t.prototype.onError=function(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()},t.prototype.reloadStorage=function(){this.teardownStorage();this.initStorage()},t.prototype.isReady=function(){return!!this._storage},t.prototype.getKey=function(n){return n.queryToFetch?n.queryToFetch.toLocaleLowerCase():""},t.prototype.fetch=function(t,i,r,u,f){var o=this,e;n.isDataSourceEnabled(this._dataSource,t)&&(e=function(n,r){var u=r=="R";f()&&i(o._dataSource,o.createResponse(t,n,u),o.getDataSourceState(r))},this.innerQueryStorage(1,this.getKey(t),function(n){return e(n,"R")},function(){return e(null,"E")},function(){return e(null,"X")},function(){return e(null,"T")}))},t.prototype.withStorage=function(n){return this._storage?(n(this._storage),!0):!1},t.prototype.getMaxKey=function(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)},t.prototype.queryStorage=function(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)},t.prototype.innerQueryStorage=function(t,i,r,u,f,e){var h=this,o=null,s=!1,c=!0,a=function(){if(c)if(c=!1,h._storage){var n=function(n){o&&sb_ct(o);h.onError(n,"query");s||(s=!0,u())};t==0?h._storage.getValue(i,function(n){o&&sb_ct(o);s||(s=!0,r(n))},n):i?h._storage.getRange(i,h.getMaxKey(i),function(n){o&&sb_ct(o);s||(s=!0,r(n))},n):h._storage.getAll(function(n){o&&sb_ct(o);s||(s=!0,r(n))},n)}else o&&sb_ct(o),s||(s=!0,u())},l;if(this._storage)a();else if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(a);else{f();return}l=i?n.config.indexedDBTimeout:n.config.latencyTimeoutForZeroInput;l&&(o=sb_st(function(){return n.safeExecute(function(){o=null;c=!1;s||(s=!0,e())},"innerQueryStorage")},l))},t}();t.StorageBasedDataProvider=i})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(AutoSuggest||(AutoSuggest={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var i="LastUpdated",r=function(t){function r(r,u,f,e,o,s,h,c){var l=this;r&&r.bindItemLaunch(function(n,t,i){return l.onLaunch(n,t,i)});var a,v=function(t,r,f){return u(s,function(i){t(i);var r=n.getTimeDiffInDays(a);(r===null||r>=1)&&(a=n.getCurrentDate(),l.prune())},r,f,i)},y=function(t,i,r){return n.safeExecute(function(){return l.createMruResponse(t,i,r)},"createMruResponse")},p=function(){return!0},w=function(n){return n=="R"?undefined:n};return f.bindClearMRURequested(function(t){l.teardownStorage();n.ClientSideStorage.deleteDatabase(s,function(){return t(!0)},function(){return t(!1)})}),l=t.call(this,v,y,p,w,n.MRUDataSource,f)||this,l.candidatesEnabled=h,l.loggingEnabled=c,l.getSuggestionKey=e,l.getGroupType=o,l._pendingWrites=[],l}return __extends(r,t),r.prototype.getName=function(){return"MRUDataProvider"},r.prototype.shouldStoreSuggestions=function(){return n.config.historySettingsPresent&&this.candidatesEnabled()},r.prototype.createMruResponse=function(t,i,r){var c=this,f,s,u,o,h;if(i=i||[],f=this.getKey(t),this._lastKey=r?f:null,s=r?i.find(function(n){return n.key==f}):null,this._valueForLastKey=s?s.value:null,u={},n.config.mruSignalsEnabled&&this._valueForLastKey&&(u.SuggestionEngagementData=this._valueForLastKey.SuggestionEngagementData),u.LookupCompletions=i.map(function(n){return{key:n.key,value:n.value.SuggestionEngagementData}}),this.shouldStoreSuggestions()){var e=[],v=this.getOldestDateToKeep(),y=function(n,t){var u,i,r,f;if(t.Suggestions)for(u=function(i){var r=l.getRankingData(t,i);r&&r.lastLaunchTime&&r.lastLaunchTime>=v&&e.push({rankingData:n==l._lastKey?{prefixLaunchCount:r.prefixLaunchCount,lastLaunchTime:r.lastLaunchTime,previewPaneLaunchCount:r.previewPaneLaunchCount,lastPreviewPaneLaunchTime:r.lastPreviewPaneLaunchTime}:r,suggestionData:i,remove:function(t){return c.remove(n,i,t)}})},i=0,r=t.Suggestions;i<r.length;i++)f=r[i],u(f)},l=this;for(o=0,h=i;o<h.length;o++){var a=h[o],p=a.key,w=a.value;y(p,w)}e.length>0&&(u.Suggestions=[],e.sort(function(n,t){return t.rankingData.lastLaunchTime-n.rankingData.lastLaunchTime}),e.forEach(function(n){return c.addToResponseIfNotPresent(u.Suggestions,n)}),f?f.length<=n.config.mruLengthA?u.Suggestions.splice(n.config.maxMruA):f.length<=n.config.mruLengthB&&u.Suggestions.splice(n.config.maxMruB):u.Suggestions.splice(n.config.maxMruZeroInput))}return u},r.removeRankerSignals=function(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t},r.prototype.addToResponseIfNotPresent=function(n,t){var f=JSON.stringify(t.suggestionData,r.removeRankerSignals),i=n.find(function(n){return JSON.stringify(n.suggestionData,r.removeRankerSignals)==f}),u;i?(u=i.remove,i.remove=function(n){return u(function(){return t.remove(n)})},i.rankingData.lastLaunchTime=Math.max(i.rankingData.lastLaunchTime,t.rankingData.lastLaunchTime),i.rankingData.prefixLaunchCount+=t.rankingData.prefixLaunchCount,t.rankingData.previewPaneLaunchCount&&(i.rankingData.previewPaneLaunchCount=(i.rankingData.previewPaneLaunchCount||0)+t.rankingData.previewPaneLaunchCount),t.rankingData.lastPreviewPaneLaunchTime&&(i.rankingData.lastPreviewPaneLaunchTime=i.rankingData.lastPreviewPaneLaunchTime?Math.max(i.rankingData.lastPreviewPaneLaunchTime,t.rankingData.lastPreviewPaneLaunchTime):t.rankingData.lastPreviewPaneLaunchTime)):n.push(t)},r.prototype.addToDataIfNotPresent=function(n,t){var i=JSON.stringify(t,r.removeRankerSignals),u=n.find(function(n){return JSON.stringify(n,r.removeRankerSignals)==i});u||n.push(t)},r.prototype.onAfterWrite=function(){if(this._writing=!1,this._pendingWrites.length>0){var n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()},r.prototype.teardownStorage=function(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,t.prototype.teardownStorage.call(this))},r.prototype.onLaunch=function(n,t,i){var r=this,u;if(this.loggingEnabled()){if(this._writing){this._pendingWrites.push(function(){return r.onLaunch(n,t,i)});return}this._writing=!0;u=this.getKey(t);this._lastKey==u?this.updateAndSaveLaunchData(u,this._valueForLastKey,n,i):this.queryStorage(u,function(t){return r.updateAndSaveLaunchData(u,t,n,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})}},r.prototype.remove=function(n,t,i){var r=this;if(this._writing){this._pendingWrites.push(function(){return r.remove(n,t,i)});return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,function(u){return r.removeAndSaveLaunchData(n,u,t,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})},r.getUnixTime=function(n){return n||(n=new Date),Math.round(n.getTime()/1e3)},r.prototype.createOrUpdateDbEntry=function(n,t,i,u){var f,e;return t?(t.LastUpdated=r.getUnixTime(),t.SuggestionEngagementData=t.SuggestionEngagementData||{}):t={LastUpdated:r.getUnixTime(),SuggestionEngagementData:{}},f=this.getSuggestionKey(i),t.SuggestionEngagementData[f]=this.updateMRUEntryClicksAndTime(t.SuggestionEngagementData[f],t.LastUpdated,u),this.getGroupType&&(t.SuggestionEngagementData[f].groupType=this.getGroupType(i)),this.shouldStoreSuggestions()&&(e=i.getMruData(),e&&n&&(t.Suggestions||(t.Suggestions=[]),this.addToDataIfNotPresent(t.Suggestions,e))),t},r.prototype.updateMRUEntryClicksAndTime=function(n,t,i){return n?(n.prefixLaunchCount+=1,n.lastLaunchTime=t):n={prefixLaunchCount:1,lastLaunchTime:t},i&&(n.previewPaneLaunchCount=(n.previewPaneLaunchCount||0)+1,n.lastPreviewPaneLaunchTime=t),n},r.prototype.getOldestDateToKeep=function(){var t=n.getCurrentDate();return t.setDate(t.getDate()-n.config.mruMaxAgeInDays),r.getUnixTime(t)},r.prototype.updateAndSaveLaunchData=function(t,i,r,u){var f=this;if(i=n.safeExecute(function(){return f.createOrUpdateDbEntry(t,i,r,u)},"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}n.safeExecute(function(){return f.removeOldLaunches(i,f.getOldestDateToKeep())},"removeOldLaunches");this._lastKey=t;this._valueForLastKey=i;this.withStorage(function(n){return n.put(t,i,function(){return f.onAfterWrite()},function(n){f.onError(n,"updateAndSaveLaunchData");f.onAfterWrite()})})||this.onAfterWrite()},r.prototype.removeAndSaveLaunchData=function(n,t,i,r){var u=this,e,f;if(!t){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}if(e=JSON.stringify(i),f=(t.Suggestions||[]).findIndex(function(n){return JSON.stringify(n)==e}),f==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}t.Suggestions.splice(f,1);this._lastKey=n;this._valueForLastKey=t;this.withStorage(function(i){return i.put(n,t,function(){r&&r();u.onAfterWrite()},function(n){u.onError(n,"removeAndSaveLaunchData");u.onAfterWrite()})})||this.onAfterWrite()},r.prototype.getRankingData=function(n,t){return n.SuggestionEngagementData?n.SuggestionEngagementData[t.suggestionKey]:undefined},r.prototype.removeOldLaunches=function(n,t){var i,r,u;if(n.Suggestions)for(i=n.Suggestions.length-1;i>=0;--i)r=this.getRankingData(n,n.Suggestions[i]),u=r?r.lastLaunchTime:null,(!u||u<t)&&n.Suggestions.splice(i,1);this.removeOldEngagementData(n.SuggestionEngagementData,t)},r.prototype.removeOldEngagementData=function(n,t){var i,r,u;if(n)for(i in n)r=n[i],r&&(u=r.lastLaunchTime,(!u||u<t)&&delete n[i])},r.prototype.prune=function(n){var t=this;if(this._writing){this._pendingWrites.push(function(){return t.prune(n)});return}this._writing=!0;this.withStorage(function(i){return i.removeRangeOnSecondaryKey(0,t.getOldestDateToKeep(),function(){n&&n();t.onAfterWrite()},function(n){t.onError(n,"MRUDataProvider prune");t.onAfterWrite()})})||this.onAfterWrite()},r}(n.ClientSideStorage.StorageBasedDataProvider);t.MRUDataProvider=r})(t=n.MRU||(n.MRU={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t;(function(t){var i=function(){function i(n){var r=this,f,i,u,e;for(n.bindDismissed(function(){return r._localResponses.forEach(function(n){return r.clear(n)})}),this._localResponses=[{event:"localresultsavailable",dataSource:"Local",fetchResults:function(){return t.getCachedFrameMessage("localResults")}},{event:"typedurlsavailable",dataSource:"TypedUrls",fetchResults:function(){return t.getCachedFrameMessage("typedUrls")}}],f=function(n){n.lastResponse=n.fetchResults();t.bindOneBoxEvent(n.event,function(){n.lastResponse=n.fetchResults();n.lastResponse&&n.lastResponse.addressbar&&n.awaitingQuery&&n.lastResponse.addressbar.content===n.awaitingQuery.originalQuery&&r.executeOnResponseReceivedHandler(n.awaitingQuery,n,n.awaitingHandler)})},i=0,u=this._localResponses;i<u.length;i++)e=u[i],f(e)}return i.prototype.getName=function(){return"LocalDataProvider"},i.prototype.clear=function(n){n.lastResponse=n.awaitingHandler=n.awaitingQuery=null},i.prototype.fetch=function(n,t){for(var i,r=0,u=this._localResponses;r<u.length;r++)i=u[r],i.lastResponse&&i.lastResponse.addressbar&&n.originalQuery===i.lastResponse.addressbar.content?this.executeOnResponseReceivedHandler(n,i,t):(i.awaitingQuery=n,i.awaitingHandler=t)},i.prototype.executeOnResponseReceivedHandler=function(t,i,r){n.isDataSourceEnabled(i.dataSource,t)&&r(i.dataSource,i.lastResponse,null);this.clear(i)},i}();t.LocalDataProvider=i})(t=n.OneBox||(n.OneBox={}))}(AutoSuggest||(AutoSuggest={})),function(n){var t=54e5,i=function(){function i(i,r){var u=this;this._host=i;this._appCacheInstrumentationHelper=r;this._isReloadSuppressed=!1;this._pendingReload=!1;r.registerSuperFresh();i.hasFallbackHappened()&&(this._isReloadSuppressed=!0,this._lastReloadAfterFallback=n.getCurrentTime());i.bindAppHidden(function(){(u._isReloadSuppressed=u._lastReloadAfterFallback&&n.getCurrentTime()-u._lastReloadAfterFallback<t,u._isReloadSuppressed)||(!u._pendingReload&&n.config.reloadAfterConversations&&i.getPaneCloseCount()>=n.config.reloadAfterConversations&&(u._pendingReload=!0),u._pendingReload&&(u.logReloadAttempt(),u.reload()))});sj_be(applicationCache,"updateready",function(){return u.onUpdateReady()});i.bindConversationStart(function(){u._isReloadSuppressed=!0;u.shouldCheckForUpdate()&&n.contains([1,4,5],applicationCache.status)&&n.safeExecute(function(){return applicationCache.update()},"probe for manifest update")})}return i.prototype.shouldCheckForUpdate=function(){if(!n.isBingEnabled())return!1;return n.config.th&&ClientTestHooks.isTesthookParamSet("disableAppCache")?!1:!0},i.prototype.onUpdateReady=function(){this.logReloadAttempt();this._isReloadSuppressed?this._pendingReload=!0:this.reload()},i.prototype.reload=function(){this._host.reloadWebView(!1)},i.prototype.logReloadAttempt=function(){this._appCacheInstrumentationHelper.instrumentSuperFreshUpdate(this._isReloadSuppressed)},i}();n.SuperFreshAppCache=i}(AutoSuggest||(AutoSuggest={}))                                                                                     mx#XMJZZQCp>6d"l	4Fh4DA0V& O.r(S=x~ߡwVB7;U-\Ê:34,d98*.ɭ\eOLx{KU֯Z&7<*OY"FDrQ>qOh4FI|I*#Ab,==pe:m޳s{VhE_+,1W@ԭ}QuteO>3r	+lWךt6McQMǗcxzڷǁ>Fh4&Qa} Ag][OqG՚Qeǭc/<I=7q^ {yM84Fh4D)><6Y>yb}1U͙Z$QD7l/"$WnOh4FI|Ij?V7r3ɖa4E[Fh4FpH$,Y/Re+NΔX;	m}Fh4M!j4h4Fh4
YzFh4FhW?i4Fh49{DoF[Fh4F$m}Fh4F<Oh4FhgSZ҄1)yOW.,+<\1N'Fh4FPR3`(em>d+"O	=vf76=iPHN+?ʷ5H0
rk4WӀh4FhJt5qz aZc1𽇰;e<k;xeIb;3̬Nu\,j#kU>dGFzFh4FI&(~ _S?M{;;e<n5qv1*clk#g#Ȣf.crϼtn(»gn.{(Fh4F,'z5G=
_DPGx=4}.{h!Acbnw]ֽP_ܻkE;,0*!:mXgt=5؎vt:Gœ/kx).h4Fh4O)ʟLu*JT`krayEbY!>ۦOQkC/`wm9F3yZa!Mm    IENDB`